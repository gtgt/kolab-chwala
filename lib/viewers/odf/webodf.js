/*
 Copyright (C) 2012 KO GmbH <copyright@kogmbh.com>

 @licstart
 The JavaScript code in this page is free software: you can redistribute it
 and/or modify it under the terms of the GNU Affero General Public License
 (GNU AGPL) as published by the Free Software Foundation, either version 3 of
 the License, or (at your option) any later version.  The code is distributed
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 FITNESS FOR A PARTICULAR PURPOSE.  See the GNU AGPL for more details.

 You should have received a copy of the GNU Affero General Public License
 along with this code.  If not, see <http://www.gnu.org/licenses/>.

 As additional permission under GNU AGPL version 3 section 7, you
 may distribute non-source (e.g., minimized or compacted) forms of
 that code without the copy of the GNU GPL normally required by
 section 4, provided you include this license notice and a URL
 through which recipients can access the Corresponding Source.

 As a special exception to the AGPL, any HTML file which merely makes function
 calls to this code, and for that purpose includes it by reference shall be
 deemed a separate work for copyright law purposes. In addition, the copyright
 holders of this code give you permission to combine this code with free
 software libraries that are released under the GNU LGPL. You may copy and
 distribute such a system following the terms of the GNU AGPL for this code
 and the LGPL for the libraries. If you modify this code, you may extend this
 exception to your version of the code, but you are not obligated to do so.
 If you do not wish to do so, delete this exception statement from your
 version.

 This license applies to this entire compilation.
 @licend
 @source: http://www.webodf.org/
 @source: https://github.com/kogmbh/WebODF/
*/
var core={},gui={},xmldom={},odf={},ops={};
function Runtime(){}Runtime.ByteArray=function(f){};Runtime.prototype.getVariable=function(f){};Runtime.prototype.toJson=function(f){};Runtime.prototype.fromJson=function(f){};Runtime.ByteArray.prototype.slice=function(f,g){};Runtime.ByteArray.prototype.length=0;Runtime.prototype.byteArrayFromArray=function(f){};Runtime.prototype.byteArrayFromString=function(f,g){};Runtime.prototype.byteArrayToString=function(f,g){};Runtime.prototype.concatByteArrays=function(f,g){};
Runtime.prototype.read=function(f,g,c,m){};Runtime.prototype.readFile=function(f,g,c){};Runtime.prototype.readFileSync=function(f,g){};Runtime.prototype.loadXML=function(f,g){};Runtime.prototype.writeFile=function(f,g,c){};Runtime.prototype.isFile=function(f,g){};Runtime.prototype.getFileSize=function(f,g){};Runtime.prototype.deleteFile=function(f,g){};Runtime.prototype.log=function(f,g){};Runtime.prototype.setTimeout=function(f,g){};Runtime.prototype.clearTimeout=function(f){};
Runtime.prototype.libraryPaths=function(){};Runtime.prototype.type=function(){};Runtime.prototype.getDOMImplementation=function(){};Runtime.prototype.parseXML=function(f){};Runtime.prototype.getWindow=function(){};Runtime.prototype.assert=function(f,g,c){};var IS_COMPILED_CODE=!0;
Runtime.byteArrayToString=function(f,g){function c(c){var b="",a,e=c.length;for(a=0;a<e;a+=1)b+=String.fromCharCode(c[a]&255);return b}function m(c){var b="",a,e=c.length,d,r,h,p;for(a=0;a<e;a+=1)d=c[a],128>d?b+=String.fromCharCode(d):(a+=1,r=c[a],194<=d&&224>d?b+=String.fromCharCode((d&31)<<6|r&63):(a+=1,h=c[a],224<=d&&240>d?b+=String.fromCharCode((d&15)<<12|(r&63)<<6|h&63):(a+=1,p=c[a],240<=d&&245>d&&(d=(d&7)<<18|(r&63)<<12|(h&63)<<6|p&63,d-=65536,b+=String.fromCharCode((d>>10)+55296,(d&1023)+56320)))));
return b}var l;"utf8"===g?l=m(f):("binary"!==g&&this.log("Unsupported encoding: "+g),l=c(f));return l};Runtime.getVariable=function(f){try{return eval(f)}catch(g){}};Runtime.toJson=function(f){return JSON.stringify(f)};Runtime.fromJson=function(f){return JSON.parse(f)};Runtime.getFunctionName=function(f){return void 0===f.name?(f=/function\s+(\w+)/.exec(f))&&f[1]:f.name};
function BrowserRuntime(f){function g(b,a){var e,d,r;void 0!==a?r=b:a=b;f?(d=f.ownerDocument,r&&(e=d.createElement("span"),e.className=r,e.appendChild(d.createTextNode(r)),f.appendChild(e),f.appendChild(d.createTextNode(" "))),e=d.createElement("span"),0<a.length&&"<"===a[0]?e.innerHTML=a:e.appendChild(d.createTextNode(a)),f.appendChild(e),f.appendChild(d.createElement("br"))):console&&console.log(a);"alert"===r&&alert(a)}function c(b,a,e){function d(){var d;4===r.readyState&&(0!==r.status||r.responseText?
200===r.status||0===r.status?(d="binary"===a?null!==r.responseBody&&"undefined"!==String(typeof VBArray)?(new VBArray(r.responseBody)).toArray():m.byteArrayFromString(r.responseText,"binary"):r.responseText,l[b]=d,e(null,d)):e(r.responseText||r.statusText):e("File "+b+" is empty."))}if(l.hasOwnProperty(b))e(null,l[b]);else{var r=new XMLHttpRequest;r.open("GET",b,!0);r.onreadystatechange=d;r.overrideMimeType&&("binary"!==a?r.overrideMimeType("text/plain; charset="+a):r.overrideMimeType("text/plain; charset=x-user-defined"));
try{r.send(null)}catch(h){e(h.message)}}}var m=this,l={},q=window.ArrayBuffer&&window.Uint8Array;q&&(Uint8Array.prototype.slice=function(b,a){void 0===a&&(void 0===b&&(b=0),a=this.length);var e=this.subarray(b,a),d,r;a-=b;d=new Uint8Array(new ArrayBuffer(a));for(r=0;r<a;r+=1)d[r]=e[r];return d});this.ByteArray=q?function(b){return new Uint8Array(new ArrayBuffer(b))}:function(b){var a=[];a.length=b;return a};this.concatByteArrays=q?function(b,a){var e,d=b.length,r=a.length,h=new this.ByteArray(d+r);
for(e=0;e<d;e+=1)h[e]=b[e];for(e=0;e<r;e+=1)h[e+d]=a[e];return h}:function(b,a){return b.concat(a)};this.byteArrayFromArray=function(b){return b.slice()};this.byteArrayFromString=function(b,a){var e;if("utf8"===a){e=b.length;var d,r,h,p=0;for(r=0;r<e;r+=1)h=b.charCodeAt(r),p+=1+(128<h)+(2048<h);d=new m.ByteArray(p);for(r=p=0;r<e;r+=1)h=b.charCodeAt(r),128>h?(d[p]=h,p+=1):2048>h?(d[p]=192|h>>>6,d[p+1]=128|h&63,p+=2):(d[p]=224|h>>>12&15,d[p+1]=128|h>>>6&63,d[p+2]=128|h&63,p+=3)}else for("binary"!==
a&&m.log("unknown encoding: "+a),e=b.length,d=new m.ByteArray(e),r=0;r<e;r+=1)d[r]=b.charCodeAt(r)&255;return e=d};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=c;this.read=function(b,a,e,d){function r(){var k;4===h.readyState&&(0!==h.status||h.responseText?200===h.status||0===h.status?(h.response?(k=h.response,k=new Uint8Array(k)):k=null!==h.responseBody&&"undefined"!==String(typeof VBArray)?
(new VBArray(h.responseBody)).toArray():m.byteArrayFromString(h.responseText,"binary"),l[b]=k,d(null,k.slice(a,a+e))):d(h.responseText||h.statusText):d("File "+b+" is empty."))}if(l.hasOwnProperty(b))d(null,l[b].slice(a,a+e));else{var h=new XMLHttpRequest;h.open("GET",b,!0);h.onreadystatechange=r;h.overrideMimeType&&h.overrideMimeType("text/plain; charset=x-user-defined");h.responseType="arraybuffer";try{h.send(null)}catch(p){d(p.message)}}};this.readFileSync=function(b,a){var e=new XMLHttpRequest,
d;e.open("GET",b,!1);e.overrideMimeType&&("binary"!==a?e.overrideMimeType("text/plain; charset="+a):e.overrideMimeType("text/plain; charset=x-user-defined"));try{if(e.send(null),200===e.status||0===e.status)d=e.responseText}catch(r){}return d};this.writeFile=function(b,a,e){l[b]=a;var d=new XMLHttpRequest;d.open("PUT",b,!0);d.onreadystatechange=function(){4===d.readyState&&(0!==d.status||d.responseText?200<=d.status&&300>d.status||0===d.status?e(null):e("Status "+String(d.status)+": "+d.responseText||
d.statusText):e("File "+b+" is empty."))};a=a.buffer&&!d.sendAsBinary?a.buffer:m.byteArrayToString(a,"binary");try{d.sendAsBinary?d.sendAsBinary(a):d.send(a)}catch(r){m.log("HUH? "+r+" "+a),e(r.message)}};this.deleteFile=function(b,a){delete l[b];var e=new XMLHttpRequest;e.open("DELETE",b,!0);e.onreadystatechange=function(){4===e.readyState&&(200>e.status&&300<=e.status?a(e.responseText):a(null))};e.send(null)};this.loadXML=function(b,a){var e=new XMLHttpRequest;e.open("GET",b,!0);e.overrideMimeType&&
e.overrideMimeType("text/xml");e.onreadystatechange=function(){4===e.readyState&&(0!==e.status||e.responseText?200===e.status||0===e.status?a(null,e.responseXML):a(e.responseText):a("File "+b+" is empty."))};try{e.send(null)}catch(d){a(d.message)}};this.isFile=function(b,a){m.getFileSize(b,function(e){a(-1!==e)})};this.getFileSize=function(b,a){var e=new XMLHttpRequest;e.open("HEAD",b,!0);e.onreadystatechange=function(){if(4===e.readyState){var d=e.getResponseHeader("Content-Length");d?a(parseInt(d,
10)):c(b,"binary",function(d,e){d?a(-1):a(e.length)})}};e.send(null)};this.log=g;this.assert=function(b,a,e){if(!b)throw g("alert","ASSERTION FAILED:\n"+a),e&&e(),a;};this.setTimeout=function(b,a){return setTimeout(function(){b()},a)};this.clearTimeout=function(b){clearTimeout(b)};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(){};this.type=function(){return"BrowserRuntime"};this.getDOMImplementation=function(){return window.document.implementation};this.parseXML=function(b){return(new DOMParser).parseFromString(b,
"text/xml")};this.exit=function(b){g("Calling exit with code "+String(b)+", but exit() is not implemented.")};this.getWindow=function(){return window}}
function NodeJSRuntime(){function f(a,e,d){a=m.resolve(l,a);"binary"!==e?c.readFile(a,e,d):c.readFile(a,null,d)}var g=this,c=require("fs"),m=require("path"),l="",q,b;this.ByteArray=function(a){return new Buffer(a)};this.byteArrayFromArray=function(a){var e=new Buffer(a.length),d,b=a.length;for(d=0;d<b;d+=1)e[d]=a[d];return e};this.concatByteArrays=function(a,e){var d=new Buffer(a.length+e.length);a.copy(d,0,0);e.copy(d,a.length,0);return d};this.byteArrayFromString=function(a,e){return new Buffer(a,
e)};this.byteArrayToString=function(a,e){return a.toString(e)};this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=f;this.loadXML=function(a,e){f(a,"utf-8",function(d,a){if(d)return e(d);e(null,g.parseXML(a))})};this.writeFile=function(a,e,d){a=m.resolve(l,a);c.writeFile(a,e,"binary",function(a){d(a||null)})};this.deleteFile=function(a,e){a=m.resolve(l,a);c.unlink(a,e)};this.read=function(a,e,d,b){a=m.resolve(l,a);c.open(a,"r+",666,function(a,
p){if(a)b(a);else{var k=new Buffer(d);c.read(p,k,0,d,e,function(a){c.close(p);b(a,k)})}})};this.readFileSync=function(a,e){return e?"binary"===e?c.readFileSync(a,null):c.readFileSync(a,e):""};this.isFile=function(a,e){a=m.resolve(l,a);c.stat(a,function(a,b){e(!a&&b.isFile())})};this.getFileSize=function(a,e){a=m.resolve(l,a);c.stat(a,function(a,b){a?e(-1):e(b.size)})};this.log=function(a,b){var d;void 0!==b?d=a:b=a;"alert"===d&&process.stderr.write("\n!!!!! ALERT !!!!!\n");process.stderr.write(b+
"\n");"alert"===d&&process.stderr.write("!!!!! ALERT !!!!!\n")};this.assert=function(a,b,d){a||(process.stderr.write("ASSERTION FAILED: "+b),d&&d())};this.setTimeout=function(a,b){return setTimeout(function(){a()},b)};this.clearTimeout=function(a){clearTimeout(a)};this.libraryPaths=function(){return[__dirname]};this.setCurrentDirectory=function(a){l=a};this.currentDirectory=function(){return l};this.type=function(){return"NodeJSRuntime"};this.getDOMImplementation=function(){return b};this.parseXML=
function(a){return q.parseFromString(a,"text/xml")};this.exit=process.exit;this.getWindow=function(){return null};q=new (require("xmldom").DOMParser);b=g.parseXML("<a/>").implementation}
function RhinoRuntime(){function f(b,a){var e;void 0!==a?e=b:a=b;"alert"===e&&print("\n!!!!! ALERT !!!!!");print(a);"alert"===e&&print("!!!!! ALERT !!!!!")}var g=this,c=Packages.javax.xml.parsers.DocumentBuilderFactory.newInstance(),m,l,q="";c.setValidating(!1);c.setNamespaceAware(!0);c.setExpandEntityReferences(!1);c.setSchema(null);l=Packages.org.xml.sax.EntityResolver({resolveEntity:function(b,a){var e=new Packages.java.io.FileReader(a);return new Packages.org.xml.sax.InputSource(e)}});m=c.newDocumentBuilder();
m.setEntityResolver(l);this.ByteArray=function(b){return[b]};this.byteArrayFromArray=function(b){return b};this.byteArrayFromString=function(b,a){var e=[],d,r=b.length;for(d=0;d<r;d+=1)e[d]=b.charCodeAt(d)&255;return e};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.concatByteArrays=function(b,a){return b.concat(a)};this.loadXML=function(b,a){var e=new Packages.java.io.File(b),d;try{d=m.parse(e)}catch(r){print(r);
a(r);return}a(null,d)};this.readFile=function(b,a,e){q&&(b=q+"/"+b);var d=new Packages.java.io.File(b),r="binary"===a?"latin1":a;d.isFile()?(b=readFile(b,r),"binary"===a&&(b=g.byteArrayFromString(b,"binary")),e(null,b)):e(b+" is not a file.")};this.writeFile=function(b,a,e){q&&(b=q+"/"+b);b=new Packages.java.io.FileOutputStream(b);var d,r=a.length;for(d=0;d<r;d+=1)b.write(a[d]);b.close();e(null)};this.deleteFile=function(b,a){q&&(b=q+"/"+b);(new Packages.java.io.File(b))["delete"]()?a(null):a("Could not delete "+
b)};this.read=function(b,a,e,d){q&&(b=q+"/"+b);var r;r=b;var h="binary";(new Packages.java.io.File(r)).isFile()?("binary"===h&&(h="latin1"),r=readFile(r,h)):r=null;r?d(null,this.byteArrayFromString(r.substring(a,a+e),"binary")):d("Cannot read "+b)};this.readFileSync=function(b,a){return a?readFile(b,a):""};this.isFile=function(b,a){q&&(b=q+"/"+b);var e=new Packages.java.io.File(b);a(e.isFile())};this.getFileSize=function(b,a){q&&(b=q+"/"+b);var e=new Packages.java.io.File(b);a(e.length())};this.log=
f;this.assert=function(b,a,e){b||(f("alert","ASSERTION FAILED: "+a),e&&e())};this.setTimeout=function(b){b();return 0};this.clearTimeout=function(){};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(b){q=b};this.currentDirectory=function(){return q};this.type=function(){return"RhinoRuntime"};this.getDOMImplementation=function(){return m.getDOMImplementation()};this.parseXML=function(b){return m.parse(b)};this.exit=quit;this.getWindow=function(){return null}}
var runtime=function(){return"undefined"!==String(typeof window)?new BrowserRuntime(window.document.getElementById("logoutput")):"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime}();
(function(){function f(c){var f=c[0],g;g=eval("if (typeof "+f+" === 'undefined') {eval('"+f+" = {};');}"+f);for(f=1;f<c.length-1;f+=1)g=g.hasOwnProperty(c[f])?g[c[f]]:g[c[f]]={};return g[c[c.length-1]]}var g={},c={};runtime.loadClass=function(m){function l(a){a=a.replace(/\./g,"/")+".js";var d=runtime.libraryPaths(),b,h,p;runtime.currentDirectory&&d.push(runtime.currentDirectory());for(b=0;b<d.length;b+=1){h=d[b];if(!c.hasOwnProperty(h))try{p=runtime.readFileSync(d[b]+"/manifest.js","utf8"),c[h]=
p&&p.length?eval(p):null}catch(k){c[h]=null,runtime.log("Cannot load manifest for "+h+".")}p=null;if((h=c[h])&&h.indexOf&&-1!==h.indexOf(a))return d[b]+"/"+a}return null}function q(a){var d,b;b=l(a);if(!b)throw a+" is not listed in any manifest.js.";try{d=runtime.readFileSync(b,"utf8")}catch(h){throw runtime.log("Error loading "+a+" "+h),h;}if(void 0===d)throw"Cannot load class "+a;d=d+("\n//# sourceURL="+b)+("\n//@ sourceURL="+b);try{d=eval(a+" = eval(code);")}catch(p){throw runtime.log("Error loading "+
a+" "+p),p;}return d}if(!IS_COMPILED_CODE&&!g.hasOwnProperty(m)){var b=m.split("."),a;a=f(b);if(!a&&(a=q(m),!a||Runtime.getFunctionName(a)!==b[b.length-1]))throw runtime.log("Loaded code is not for "+b[b.length-1]),"Loaded code is not for "+b[b.length-1];g[m]=!0}}})();
(function(f){function g(c){if(c.length){var f=c[0];runtime.readFile(f,"utf8",function(g,q){function b(){var a;(a=eval(e))&&runtime.exit(a)}var a="",e=q;-1!==f.indexOf("/")&&(a=f.substring(0,f.indexOf("/")));runtime.setCurrentDirectory(a);g||null===e?(runtime.log(g),runtime.exit(1)):b.apply(null,c)})}}f=f?Array.prototype.slice.call(f):[];"NodeJSRuntime"===runtime.type()?g(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?g(f):g(f.slice(1))})("undefined"!==String(typeof arguments)&&arguments);
core.Base64=function(){function f(a){var b=[],d,e=a.length;for(d=0;d<e;d+=1)b[d]=a.charCodeAt(d)&255;return b}function g(a){var b,d="",e,h=a.length-2;for(e=0;e<h;e+=3)b=a[e]<<16|a[e+1]<<8|a[e+2],d+=n[b>>>18],d+=n[b>>>12&63],d+=n[b>>>6&63],d+=n[b&63];e===h+1?(b=a[e]<<4,d+=n[b>>>6],d+=n[b&63],d+="=="):e===h&&(b=a[e]<<10|a[e+1]<<2,d+=n[b>>>12],d+=n[b>>>6&63],d+=n[b&63],d+="=");return d}function c(a){a=a.replace(/[^A-Za-z0-9+\/]+/g,"");var d=[],b=a.length%4,e,h=a.length,k;for(e=0;e<h;e+=4)k=(t[a.charAt(e)]||
0)<<18|(t[a.charAt(e+1)]||0)<<12|(t[a.charAt(e+2)]||0)<<6|(t[a.charAt(e+3)]||0),d.push(k>>16,k>>8&255,k&255);d.length-=[0,0,2,1][b];return d}function m(a){var d=[],b,e=a.length,h;for(b=0;b<e;b+=1)h=a[b],128>h?d.push(h):2048>h?d.push(192|h>>>6,128|h&63):d.push(224|h>>>12&15,128|h>>>6&63,128|h&63);return d}function l(a){var d=[],b,e=a.length,h,k,p;for(b=0;b<e;b+=1)h=a[b],128>h?d.push(h):(b+=1,k=a[b],224>h?d.push((h&31)<<6|k&63):(b+=1,p=a[b],d.push((h&15)<<12|(k&63)<<6|p&63)));return d}function q(a){return g(f(a))}
function b(a){return String.fromCharCode.apply(String,c(a))}function a(a){return l(f(a))}function e(a){a=l(a);for(var d="",b=0;b<a.length;)d+=String.fromCharCode.apply(String,a.slice(b,b+45E3)),b+=45E3;return d}function d(a,d,b){var e="",h,k,p;for(p=d;p<b;p+=1)d=a.charCodeAt(p)&255,128>d?e+=String.fromCharCode(d):(p+=1,h=a.charCodeAt(p)&255,224>d?e+=String.fromCharCode((d&31)<<6|h&63):(p+=1,k=a.charCodeAt(p)&255,e+=String.fromCharCode((d&15)<<12|(h&63)<<6|k&63)));return e}function r(a,b){function e(){var c=
p+h;c>a.length&&(c=a.length);k+=d(a,p,c);p=c;c=p===a.length;b(k,c)&&!c&&runtime.setTimeout(e,0)}var h=1E5,k="",p=0;a.length<h?b(d(a,0,a.length),!0):("string"!==typeof a&&(a=a.slice()),e())}function h(a){return m(f(a))}function p(a){return String.fromCharCode.apply(String,m(a))}function k(a){return String.fromCharCode.apply(String,m(f(a)))}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=function(a){var d={},b,e;b=0;for(e=a.length;b<e;b+=1)d[a.charAt(b)]=b;return d}(n),w,
v,y=runtime.getWindow(),x,u;y&&y.btoa?(x=function(a){return y.btoa(a)},w=function(a){return x(k(a))}):(x=q,w=function(a){return g(h(a))});y&&y.atob?(u=function(a){return y.atob(a)},v=function(a){a=u(a);return d(a,0,a.length)}):(u=b,v=function(a){return e(c(a))});return function(){this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=g;this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=c;this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=m;this.convertByteArrayToUTF16Array=
this.convertUTF8ArrayToUTF16Array=l;this.convertUTF8StringToBase64=q;this.convertBase64ToUTF8String=b;this.convertUTF8StringToUTF16Array=a;this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=e;this.convertUTF8StringToUTF16String=r;this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=h;this.convertUTF16ArrayToUTF8String=p;this.convertUTF16StringToUTF8String=k;this.convertUTF16StringToBase64=w;this.convertBase64ToUTF16String=v;this.fromBase64=b;this.toBase64=q;this.atob=
u;this.btoa=x;this.utob=k;this.btou=r;this.encode=w;this.encodeURI=function(a){return w(a).replace(/[+\/]/g,function(a){return"+"===a?"-":"_"}).replace(/\\=+$/,"")};this.decode=function(a){return v(a.replace(/[\-_]/g,function(a){return"-"===a?"+":"/"}))}}}();
core.RawDeflate=function(){function f(){this.dl=this.fc=0}function g(){this.extra_bits=this.static_tree=this.dyn_tree=null;this.max_code=this.max_length=this.elems=this.extra_base=0}function c(a,b,d,e){this.good_length=a;this.max_lazy=b;this.nice_length=d;this.max_chain=e}function m(){this.next=null;this.len=0;this.ptr=[];this.ptr.length=l;this.off=0}var l=8192,q,b,a,e,d=null,r,h,p,k,n,t,w,v,y,x,u,s,C,z,E,N,A,M,D,O,$,ja,S,qa,aa,ha,T,Y,V,H,I,K,R,P,ba,ka,da,U,Q,L,ea,la,F,ga,G,fa,W,ia,B,ra,ma,sa=[0,
0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],na=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ya=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ua=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],va;va=[new c(0,0,0,0),new c(4,4,8,4),new c(4,5,16,8),new c(4,6,32,32),new c(4,4,16,16),new c(8,16,32,32),new c(8,16,128,128),new c(8,32,128,256),new c(32,128,258,1024),new c(32,258,258,4096)];var ca=function(e){d[h+r++]=e;if(h+r===l){var k;if(0!==r){null!==q?(e=q,q=q.next):e=
new m;e.next=null;e.len=e.off=0;null===b?b=a=e:a=a.next=e;e.len=r-h;for(k=0;k<e.len;k++)e.ptr[k]=d[h+k];r=h=0}}},X=function(a){a&=65535;h+r<l-2?(d[h+r++]=a&255,d[h+r++]=a>>>8):(ca(a&255),ca(a>>>8))},pa=function(){u=(u<<5^k[A+3-1]&255)&8191;s=w[32768+u];w[A&32767]=s;w[32768+u]=A},Z=function(a,b){y>16-b?(v|=a<<y,X(v),v=a>>16-y,y+=b-16):(v|=a<<y,y+=b)},J=function(a,b){Z(b[a].fc,b[a].dl)},oa=function(a,b,d){return a[b].fc<a[d].fc||a[b].fc===a[d].fc&&da[b]<=da[d]},za=function(a,b,d){var e;for(e=0;e<d&&
ma<ra.length;e++)a[b+e]=ra.charCodeAt(ma++)&255;return e},ta=function(){var a,b,d=65536-O-A;if(-1===d)d--;else if(65274<=A){for(a=0;32768>a;a++)k[a]=k[a+32768];M-=32768;A-=32768;x-=32768;for(a=0;8192>a;a++)b=w[32768+a],w[32768+a]=32768<=b?b-32768:0;for(a=0;32768>a;a++)b=w[a],w[a]=32768<=b?b-32768:0;d+=32768}D||(a=za(k,A+O,d),0>=a?D=!0:O+=a)},wa=function(a){var b=$,d=A,e,h=N,p=32506<A?A-32506:0,c=A+258,r=k[d+h-1],n=k[d+h];N>=qa&&(b>>=2);do if(e=a,k[e+h]===n&&k[e+h-1]===r&&k[e]===k[d]&&k[++e]===k[d+
1]){d+=2;e++;do++d;while(k[d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&d<c);e=258-(c-d);d=c-258;if(e>h){M=a;h=e;if(258<=e)break;r=k[d+h-1];n=k[d+h]}a=w[a&32767]}while(a>p&&0!==--b);return h},xa=function(a,d){t[F++]=d;0===a?aa[d].fc++:(a--,aa[U[d]+256+1].fc++,ha[(256>a?Q[a]:Q[256+(a>>7)])&255].fc++,n[ga++]=a,fa|=W);W<<=1;0===(F&7)&&(la[G++]=fa,fa=0,W=1);if(2<S&&0===(F&4095)){var b=8*F,e=A-x,h;for(h=0;30>h;h++)b+=
ha[h].fc*(5+na[h]);b>>=3;if(ga<parseInt(F/2,10)&&b<parseInt(e/2,10))return!0}return 8191===F||8192===ga},Ba=function(a,d){for(var b=P[d],e=d<<1;e<=ba;){e<ba&&oa(a,P[e+1],P[e])&&e++;if(oa(a,b,P[e]))break;P[d]=P[e];d=e;e<<=1}P[d]=b},Da=function(a,d){var b=0;do b|=a&1,a>>=1,b<<=1;while(0<--d);return b>>1},Ea=function(a,d){var b=[];b.length=16;var e=0,h;for(h=1;15>=h;h++)e=e+R[h-1]<<1,b[h]=e;for(e=0;e<=d;e++)h=a[e].dl,0!==h&&(a[e].fc=Da(b[h]++,h))},Ca=function(a){var d=a.dyn_tree,b=a.static_tree,e=a.elems,
h,k=-1,p=e;ba=0;ka=573;for(h=0;h<e;h++)0!==d[h].fc?(P[++ba]=k=h,da[h]=0):d[h].dl=0;for(;2>ba;)h=P[++ba]=2>k?++k:0,d[h].fc=1,da[h]=0,ia--,null!==b&&(B-=b[h].dl);a.max_code=k;for(h=ba>>1;1<=h;h--)Ba(d,h);do h=P[1],P[1]=P[ba--],Ba(d,1),b=P[1],P[--ka]=h,P[--ka]=b,d[p].fc=d[h].fc+d[b].fc,da[p]=da[h]>da[b]+1?da[h]:da[b]+1,d[h].dl=d[b].dl=p,P[1]=p++,Ba(d,1);while(2<=ba);P[--ka]=P[1];p=a.dyn_tree;h=a.extra_bits;var e=a.extra_base,b=a.max_code,c=a.max_length,r=a.static_tree,n,f,z,s,g=0;for(f=0;15>=f;f++)R[f]=
0;p[P[ka]].dl=0;for(a=ka+1;573>a;a++)n=P[a],f=p[p[n].dl].dl+1,f>c&&(f=c,g++),p[n].dl=f,n>b||(R[f]++,z=0,n>=e&&(z=h[n-e]),s=p[n].fc,ia+=s*(f+z),null!==r&&(B+=s*(r[n].dl+z)));if(0!==g){do{for(f=c-1;0===R[f];)f--;R[f]--;R[f+1]+=2;R[c]--;g-=2}while(0<g);for(f=c;0!==f;f--)for(n=R[f];0!==n;)h=P[--a],h>b||(p[h].dl!==f&&(ia+=(f-p[h].dl)*p[h].fc,p[h].fc=f),n--)}Ea(d,k)},Fa=function(a,d){var b,e=-1,h,k=a[0].dl,p=0,c=7,n=4;0===k&&(c=138,n=3);a[d+1].dl=65535;for(b=0;b<=d;b++)h=k,k=a[b+1].dl,++p<c&&h===k||(p<
n?V[h].fc+=p:0!==h?(h!==e&&V[h].fc++,V[16].fc++):10>=p?V[17].fc++:V[18].fc++,p=0,e=h,0===k?(c=138,n=3):h===k?(c=6,n=3):(c=7,n=4))},Ga=function(){8<y?X(v):0<y&&ca(v);y=v=0},Ha=function(a,d){var b,e=0,h=0,k=0,p=0,c,r;if(0!==F){do 0===(e&7)&&(p=la[k++]),b=t[e++]&255,0===(p&1)?J(b,a):(c=U[b],J(c+256+1,a),r=sa[c],0!==r&&(b-=L[c],Z(b,r)),b=n[h++],c=(256>b?Q[b]:Q[256+(b>>7)])&255,J(c,d),r=na[c],0!==r&&(b-=ea[c],Z(b,r))),p>>=1;while(e<F)}J(256,a)},Ia=function(a,b){var d,e=-1,h,k=a[0].dl,p=0,c=7,n=4;0===k&&
(c=138,n=3);for(d=0;d<=b;d++)if(h=k,k=a[d+1].dl,!(++p<c&&h===k)){if(p<n){do J(h,V);while(0!==--p)}else 0!==h?(h!==e&&(J(h,V),p--),J(16,V),Z(p-3,2)):10>=p?(J(17,V),Z(p-3,3)):(J(18,V),Z(p-11,7));p=0;e=h;0===k?(c=138,n=3):h===k?(c=6,n=3):(c=7,n=4)}},Ja=function(){var a;for(a=0;286>a;a++)aa[a].fc=0;for(a=0;30>a;a++)ha[a].fc=0;for(a=0;19>a;a++)V[a].fc=0;aa[256].fc=1;fa=F=ga=G=ia=B=0;W=1},Aa=function(a){var b,d,e,h;h=A-x;la[G]=fa;Ca(H);Ca(I);Fa(aa,H.max_code);Fa(ha,I.max_code);Ca(K);for(e=18;3<=e&&0===
V[ua[e]].dl;e--);ia+=3*(e+1)+14;b=ia+3+7>>3;d=B+3+7>>3;d<=b&&(b=d);if(h+4<=b&&0<=x)for(Z(0+a,3),Ga(),X(h),X(~h),e=0;e<h;e++)ca(k[x+e]);else if(d===b)Z(2+a,3),Ha(T,Y);else{Z(4+a,3);h=H.max_code+1;b=I.max_code+1;e+=1;Z(h-257,5);Z(b-1,5);Z(e-4,4);for(d=0;d<e;d++)Z(V[ua[d]].dl,3);Ia(aa,h-1);Ia(ha,b-1);Ha(aa,ha)}Ja();0!==a&&Ga()},Ka=function(a,e,k){var p,c,n;for(p=0;null!==b&&p<k;){c=k-p;c>b.len&&(c=b.len);for(n=0;n<c;n++)a[e+p+n]=b.ptr[b.off+n];b.off+=c;b.len-=c;p+=c;0===b.len&&(c=b,b=b.next,c.next=q,
q=c)}if(p===k)return p;if(h<r){c=k-p;c>r-h&&(c=r-h);for(n=0;n<c;n++)a[e+p+n]=d[h+n];h+=c;p+=c;r===h&&(r=h=0)}return p},La=function(a,d,c){var n;if(!e){if(!D){y=v=0;var f,g;if(0===Y[0].dl){H.dyn_tree=aa;H.static_tree=T;H.extra_bits=sa;H.extra_base=257;H.elems=286;H.max_length=15;H.max_code=0;I.dyn_tree=ha;I.static_tree=Y;I.extra_bits=na;I.extra_base=0;I.elems=30;I.max_length=15;I.max_code=0;K.dyn_tree=V;K.static_tree=null;K.extra_bits=ya;K.extra_base=0;K.elems=19;K.max_length=7;for(g=f=K.max_code=
0;28>g;g++)for(L[g]=f,n=0;n<1<<sa[g];n++)U[f++]=g;U[f-1]=g;for(g=f=0;16>g;g++)for(ea[g]=f,n=0;n<1<<na[g];n++)Q[f++]=g;for(f>>=7;30>g;g++)for(ea[g]=f<<7,n=0;n<1<<na[g]-7;n++)Q[256+f++]=g;for(n=0;15>=n;n++)R[n]=0;for(n=0;143>=n;)T[n++].dl=8,R[8]++;for(;255>=n;)T[n++].dl=9,R[9]++;for(;279>=n;)T[n++].dl=7,R[7]++;for(;287>=n;)T[n++].dl=8,R[8]++;Ea(T,287);for(n=0;30>n;n++)Y[n].dl=5,Y[n].fc=Da(n,5);Ja()}for(n=0;8192>n;n++)w[32768+n]=0;ja=va[S].max_lazy;qa=va[S].good_length;$=va[S].max_chain;x=A=0;O=za(k,
0,65536);if(0>=O)D=!0,O=0;else{for(D=!1;262>O&&!D;)ta();for(n=u=0;2>n;n++)u=(u<<5^k[n]&255)&8191}b=null;h=r=0;3>=S?(N=2,E=0):(E=2,z=0);p=!1}e=!0;if(0===O)return p=!0,0}n=Ka(a,d,c);if(n===c)return c;if(p)return n;if(3>=S)for(;0!==O&&null===b;){pa();0!==s&&32506>=A-s&&(E=wa(s),E>O&&(E=O));if(3<=E)if(g=xa(A-M,E-3),O-=E,E<=ja){E--;do A++,pa();while(0!==--E);A++}else A+=E,E=0,u=k[A]&255,u=(u<<5^k[A+1]&255)&8191;else g=xa(0,k[A]&255),O--,A++;g&&(Aa(0),x=A);for(;262>O&&!D;)ta()}else for(;0!==O&&null===b;){pa();
N=E;C=M;E=2;0!==s&&N<ja&&32506>=A-s&&(E=wa(s),E>O&&(E=O),3===E&&4096<A-M&&E--);if(3<=N&&E<=N){g=xa(A-1-C,N-3);O-=N-1;N-=2;do A++,pa();while(0!==--N);z=0;E=2;A++;g&&(Aa(0),x=A)}else 0!==z?xa(0,k[A-1]&255)&&(Aa(0),x=A):z=1,A++,O--;for(;262>O&&!D;)ta()}0===O&&(0!==z&&xa(0,k[A-1]&255),Aa(1),p=!0);return n+Ka(a,n+d,c-n)};this.deflate=function(h,p){var c,r;ra=h;ma=0;"undefined"===String(typeof p)&&(p=6);(c=p)?1>c?c=1:9<c&&(c=9):c=6;S=c;D=e=!1;if(null===d){q=b=a=null;d=[];d.length=l;k=[];k.length=65536;
n=[];n.length=8192;t=[];t.length=32832;w=[];w.length=65536;aa=[];aa.length=573;for(c=0;573>c;c++)aa[c]=new f;ha=[];ha.length=61;for(c=0;61>c;c++)ha[c]=new f;T=[];T.length=288;for(c=0;288>c;c++)T[c]=new f;Y=[];Y.length=30;for(c=0;30>c;c++)Y[c]=new f;V=[];V.length=39;for(c=0;39>c;c++)V[c]=new f;H=new g;I=new g;K=new g;R=[];R.length=16;P=[];P.length=573;da=[];da.length=573;U=[];U.length=256;Q=[];Q.length=512;L=[];L.length=29;ea=[];ea.length=30;la=[];la.length=1024}var z=Array(1024),s=[],m=[];for(c=La(z,
0,z.length);0<c;){m.length=c;for(r=0;r<c;r++)m[r]=String.fromCharCode(z[r]);s[s.length]=m.join("");c=La(z,0,z.length)}ra=null;return s.join("")}};
core.ByteArray=function(f){this.pos=0;this.data=f;this.readUInt32LE=function(){this.pos+=4;var f=this.data,c=this.pos;return f[--c]<<24|f[--c]<<16|f[--c]<<8|f[--c]};this.readUInt16LE=function(){this.pos+=2;var f=this.data,c=this.pos;return f[--c]<<8|f[--c]}};
core.ByteArrayWriter=function(f){var g=this,c=new runtime.ByteArray(0);this.appendByteArrayWriter=function(f){c=runtime.concatByteArrays(c,f.getByteArray())};this.appendByteArray=function(f){c=runtime.concatByteArrays(c,f)};this.appendArray=function(f){c=runtime.concatByteArrays(c,runtime.byteArrayFromArray(f))};this.appendUInt16LE=function(c){g.appendArray([c&255,c>>8&255])};this.appendUInt32LE=function(c){g.appendArray([c&255,c>>8&255,c>>16&255,c>>24&255])};this.appendString=function(g){c=runtime.concatByteArrays(c,
runtime.byteArrayFromString(g,f))};this.getLength=function(){return c.length};this.getByteArray=function(){return c}};
core.RawInflate=function(){var f,g,c=null,m,l,q,b,a,e,d,r,h,p,k,n,t,w,v=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],y=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],s=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C=[16,17,18,
0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=function(){this.list=this.next=null},E=function(){this.n=this.b=this.e=0;this.t=null},N=function(a,b,d,e,h,k){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;var p=Array(this.BMAX+1),c,n,r,f,g,s,t,l=Array(this.BMAX+1),m,A,q,M=new E,w=Array(this.BMAX);f=Array(this.N_MAX);var D,v=Array(this.BMAX+1),u,O,x;x=this.root=null;for(g=0;g<p.length;g++)p[g]=0;for(g=0;g<l.length;g++)l[g]=0;for(g=0;g<w.length;g++)w[g]=null;for(g=0;g<f.length;g++)f[g]=
0;for(g=0;g<v.length;g++)v[g]=0;c=256<b?a[256]:this.BMAX;m=a;A=0;g=b;do p[m[A]]++,A++;while(0<--g);if(p[0]==b)this.root=null,this.status=this.m=0;else{for(s=1;s<=this.BMAX&&0==p[s];s++);t=s;k<s&&(k=s);for(g=this.BMAX;0!=g&&0==p[g];g--);r=g;k>g&&(k=g);for(u=1<<s;s<g;s++,u<<=1)if(0>(u-=p[s])){this.status=2;this.m=k;return}if(0>(u-=p[g]))this.status=2,this.m=k;else{p[g]+=u;v[1]=s=0;m=p;A=1;for(q=2;0<--g;)v[q++]=s+=m[A++];m=a;g=A=0;do 0!=(s=m[A++])&&(f[v[s]++]=g);while(++g<b);b=v[r];v[0]=g=0;m=f;A=0;
f=-1;D=l[0]=0;q=null;for(O=0;t<=r;t++)for(a=p[t];0<a--;){for(;t>D+l[1+f];){D+=l[1+f];f++;O=(O=r-D)>k?k:O;if((n=1<<(s=t-D))>a+1)for(n-=a+1,q=t;++s<O&&!((n<<=1)<=p[++q]);)n-=p[q];D+s>c&&D<c&&(s=c-D);O=1<<s;l[1+f]=s;q=Array(O);for(n=0;n<O;n++)q[n]=new E;x=null==x?this.root=new z:x.next=new z;x.next=null;x.list=q;w[f]=q;0<f&&(v[f]=g,M.b=l[f],M.e=16+s,M.t=q,s=(g&(1<<D)-1)>>D-l[f],w[f-1][s].e=M.e,w[f-1][s].b=M.b,w[f-1][s].n=M.n,w[f-1][s].t=M.t)}M.b=t-D;A>=b?M.e=99:m[A]<d?(M.e=256>m[A]?16:15,M.n=m[A++]):
(M.e=h[m[A]-d],M.n=e[m[A++]-d]);n=1<<t-D;for(s=g>>D;s<O;s+=n)q[s].e=M.e,q[s].b=M.b,q[s].n=M.n,q[s].t=M.t;for(s=1<<t-1;0!=(g&s);s>>=1)g^=s;for(g^=s;(g&(1<<D)-1)!=v[f];)D-=l[f],f--}this.m=l[1];this.status=0!=u&&1!=r?1:0}}},A=function(a){for(;b<a;){var d=q,e;e=t.length==w?-1:t[w++];q=d|e<<b;b+=8}},M=function(a){return q&v[a]},D=function(a){q>>=a;b-=a},O=function(b,e,c){var s,z,t;if(0==c)return 0;for(t=0;;){A(k);z=h.list[M(k)];for(s=z.e;16<s;){if(99==s)return-1;D(z.b);s-=16;A(s);z=z.t[M(s)];s=z.e}D(z.b);
if(16==s)g&=32767,b[e+t++]=f[g++]=z.n;else{if(15==s)break;A(s);d=z.n+M(s);D(s);A(n);z=p.list[M(n)];for(s=z.e;16<s;){if(99==s)return-1;D(z.b);s-=16;A(s);z=z.t[M(s)];s=z.e}D(z.b);A(s);r=g-z.n-M(s);for(D(s);0<d&&t<c;)d--,r&=32767,g&=32767,b[e+t++]=f[g++]=f[r++]}if(t==c)return c}a=-1;return t},$,ja=function(a,b,d){var e,c,f,r,g,z,t,l=Array(316);for(e=0;e<l.length;e++)l[e]=0;A(5);z=257+M(5);D(5);A(5);t=1+M(5);D(5);A(4);e=4+M(4);D(4);if(286<z||30<t)return-1;for(c=0;c<e;c++)A(3),l[C[c]]=M(3),D(3);for(;19>
c;c++)l[C[c]]=0;k=7;c=new N(l,19,19,null,null,k);if(0!=c.status)return-1;h=c.root;k=c.m;r=z+t;for(e=f=0;e<r;)if(A(k),g=h.list[M(k)],c=g.b,D(c),c=g.n,16>c)l[e++]=f=c;else if(16==c){A(2);c=3+M(2);D(2);if(e+c>r)return-1;for(;0<c--;)l[e++]=f}else{17==c?(A(3),c=3+M(3),D(3)):(A(7),c=11+M(7),D(7));if(e+c>r)return-1;for(;0<c--;)l[e++]=0;f=0}k=9;c=new N(l,z,257,y,x,k);0==k&&(c.status=1);if(0!=c.status)return-1;h=c.root;k=c.m;for(e=0;e<t;e++)l[e]=l[e+z];n=6;c=new N(l,t,0,u,s,n);p=c.root;n=c.m;return 0==n&&
257<z||0!=c.status?-1:O(a,b,d)};this.inflate=function(z,E){null==f&&(f=Array(65536));b=q=g=0;a=-1;e=!1;d=r=0;h=null;t=z;w=0;var v=new runtime.ByteArray(E);a:{var C,T;for(C=0;C<E&&(!e||-1!=a);){if(0<d){if(0!=a)for(;0<d&&C<E;)d--,r&=32767,g&=32767,v[0+C++]=f[g++]=f[r++];else{for(;0<d&&C<E;)d--,g&=32767,A(8),v[0+C++]=f[g++]=M(8),D(8);0==d&&(a=-1)}if(C==E)break}if(-1==a){if(e)break;A(1);0!=M(1)&&(e=!0);D(1);A(2);a=M(2);D(2);h=null;d=0}switch(a){case 0:T=v;var Y=0+C,V=E-C,H=void 0,H=b&7;D(H);A(16);H=M(16);
D(16);A(16);if(H!=(~q&65535))T=-1;else{D(16);d=H;for(H=0;0<d&&H<V;)d--,g&=32767,A(8),T[Y+H++]=f[g++]=M(8),D(8);0==d&&(a=-1);T=H}break;case 1:if(null!=h)T=O(v,0+C,E-C);else b:{T=v;Y=0+C;V=E-C;if(null==c){for(var I=void 0,H=Array(288),I=void 0,I=0;144>I;I++)H[I]=8;for(;256>I;I++)H[I]=9;for(;280>I;I++)H[I]=7;for(;288>I;I++)H[I]=8;l=7;I=new N(H,288,257,y,x,l);if(0!=I.status){alert("HufBuild error: "+I.status);T=-1;break b}c=I.root;l=I.m;for(I=0;30>I;I++)H[I]=5;$=5;I=new N(H,30,0,u,s,$);if(1<I.status){c=
null;alert("HufBuild error: "+I.status);T=-1;break b}m=I.root;$=I.m}h=c;p=m;k=l;n=$;T=O(T,Y,V)}break;case 2:T=null!=h?O(v,0+C,E-C):ja(v,0+C,E-C);break;default:T=-1}if(-1==T)break a;C+=T}}t=null;return v}};
core.LoopWatchDog=function(f,g){var c=Date.now(),m=0;this.check=function(){var l;if(f&&(l=Date.now(),l-c>f))throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<g&&(m+=1,m>g))throw runtime.log("alert","watchdog loop overflow"),"loop overflow";}};
core.Utils=function(){function f(g,c){c&&Array.isArray(c)?g=(g||[]).concat(c.map(function(c){return f({},c)})):c&&"object"===typeof c?(g=g||{},Object.keys(c).forEach(function(m){g[m]=f(g[m],c[m])})):g=c;return g}this.hashString=function(f){var c=0,m,l;m=0;for(l=f.length;m<l;m+=1)c=(c<<5)-c+f.charCodeAt(m),c|=0;return c};this.mergeObjects=f};
(function(){function f(c){var f,l,q,b;void 0===g&&(b=c.createElement("div"),b.style.position="absolute",b.style.left="-99999px",b.style.transform="scale(2)",b.style["-webkit-transform"]="scale(2)",q=c.createElement("div"),q.style.width="10px",q.style.height="10px",b.appendChild(q),c.body.appendChild(b),f=q.ownerDocument.createRange(),l=q.getBoundingClientRect(),f.selectNode(q),q=f.getBoundingClientRect(),g=l.height!==q.height,f.detach(),c.body.removeChild(b));return g}var g;core.DomUtils=function(){function c(a,
b){var d=null;a.nodeType===Node.TEXT_NODE&&(0===a.length?(a.parentNode.removeChild(a),b.nodeType===Node.TEXT_NODE&&(d=b)):(b.nodeType===Node.TEXT_NODE&&(a.appendData(b.data),b.parentNode.removeChild(b)),d=a));return d}function g(a){for(var b=a.parentNode;a.firstChild;)b.insertBefore(a.firstChild,a);b.removeChild(a);return b}function l(a,b){for(var d=a.parentNode,c=a.firstChild,h;c;)h=c.nextSibling,l(c,b),c=h;b(a)&&(d=g(a));return d}function q(a,b){for(var d=0,c;a.parentNode!==b;)runtime.assert(null!==
a.parentNode,"parent is null"),a=a.parentNode;for(c=b.firstChild;c!==a;)d+=1,c=c.nextSibling;return d}function b(a,b){return a===b||Boolean(a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_CONTAINED_BY)}this.splitBoundaries=function(a){var b=[],d;if(a.startContainer.nodeType===Node.TEXT_NODE||a.endContainer.nodeType===Node.TEXT_NODE){d=a.endContainer;var c=a.endOffset;if(c<d.childNodes.length)for(d=d.childNodes[c],c=0;d.firstChild;)d=d.firstChild;else for(;d.lastChild;)d=d.lastChild,c=d.nodeType===
Node.TEXT_NODE?d.textContent.length:d.childNodes.length;a.setEnd(d,c);0!==a.endOffset&&a.endContainer.nodeType===Node.TEXT_NODE&&a.endOffset!==a.endContainer.length&&(b.push(a.endContainer.splitText(a.endOffset)),b.push(a.endContainer));0!==a.startOffset&&a.startContainer.nodeType===Node.TEXT_NODE&&a.startOffset!==a.startContainer.length&&(d=a.startContainer.splitText(a.startOffset),b.push(a.startContainer),b.push(d),a.setStart(d,0))}return b};this.containsRange=function(a,b){return 0>=a.compareBoundaryPoints(a.START_TO_START,
b)&&0<=a.compareBoundaryPoints(a.END_TO_END,b)};this.rangesIntersect=function(a,b){return 0>=a.compareBoundaryPoints(a.END_TO_START,b)&&0<=a.compareBoundaryPoints(a.START_TO_END,b)};this.getNodesInRange=function(a,b){var d=[],c,h,p=a.startContainer.ownerDocument.createTreeWalker(a.commonAncestorContainer,NodeFilter.SHOW_ALL,b,!1);for(c=p.currentNode=a.startContainer;c;){h=b(c);if(h===NodeFilter.FILTER_ACCEPT)d.push(c);else if(h===NodeFilter.FILTER_REJECT)break;c=c.parentNode}d.reverse();for(c=p.nextNode();c;)d.push(c),
c=p.nextNode();return d};this.normalizeTextNodes=function(a){a&&a.nextSibling&&(a=c(a,a.nextSibling));a&&a.previousSibling&&c(a.previousSibling,a)};this.rangeContainsNode=function(a,b){var d=b.ownerDocument.createRange(),c=b.nodeType===Node.TEXT_NODE?b.length:b.childNodes.length;d.setStart(a.startContainer,a.startOffset);d.setEnd(a.endContainer,a.endOffset);c=0===d.comparePoint(b,0)&&0===d.comparePoint(b,c);d.detach();return c};this.mergeIntoParent=g;this.removeUnwantedNodes=l;this.getElementsByTagNameNS=
function(a,b,d){return Array.prototype.slice.call(a.getElementsByTagNameNS(b,d))};this.rangeIntersectsNode=function(a,b){var d=b.nodeType===Node.TEXT_NODE?b.length:b.childNodes.length;return 0>=a.comparePoint(b,0)&&0<=a.comparePoint(b,d)};this.containsNode=function(a,b){return a===b||a.contains(b)};this.comparePoints=function(a,b,d,c){if(a===d)return c-b;var h=a.compareDocumentPosition(d);2===h?h=-1:4===h?h=1:10===h?(b=q(a,d),h=b<c?1:-1):(c=q(d,a),h=c<b?-1:1);return h};this.areRangeRectanglesTransformed=
function(a){return!f(a)};this.adaptRangeDifferenceToZoomLevel=function(a,b){var d=runtime.getWindow();return(d=d&&d.document)&&f(d)?a:a/b};(function(a){var e=runtime.getWindow(),d;null!==e&&(d=e.navigator.appVersion.toLowerCase(),e=-1===d.indexOf("chrome")&&(-1!==d.indexOf("applewebkit")||-1!==d.indexOf("safari")),d=d.indexOf("msie"),e||d)&&(a.containsNode=b)})(this)};return core.DomUtils})();
runtime.loadClass("core.DomUtils");
core.Cursor=function(f,g){function c(b){b.parentNode&&(a.push(b.previousSibling),a.push(b.nextSibling),b.parentNode.removeChild(b))}function m(b,d,e){if(d.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(d),"putCursorIntoTextNode: invalid container");var c=d.parentNode;runtime.assert(Boolean(c),"putCursorIntoTextNode: container without parent");runtime.assert(0<=e&&e<=d.length,"putCursorIntoTextNode: offset is out of bounds");0===e?c.insertBefore(b,d):(e!==d.length&&d.splitText(e),c.insertBefore(b,
d.nextSibling))}else if(d.nodeType===Node.ELEMENT_NODE){runtime.assert(Boolean(d),"putCursorIntoContainer: invalid container");for(c=d.firstChild;null!==c&&0<e;)c=c.nextSibling,e-=1;d.insertBefore(b,c)}a.push(b.previousSibling);a.push(b.nextSibling)}var l=f.createElementNS("urn:webodf:names:cursor","cursor"),q=f.createElementNS("urn:webodf:names:cursor","anchor"),b,a=[],e,d,r=new core.DomUtils;this.getNode=function(){return l};this.getAnchorNode=function(){return q.parentNode?q:l};this.getSelectedRange=
function(){d?(e.setStartBefore(l),e.collapse(!0)):(e.setStartAfter(b?q:l),e.setEndBefore(b?l:q));return e};this.setSelectedRange=function(h,p){e&&e!==h&&e.detach();e=h;b=!1!==p;(d=h.collapsed)?(c(q),c(l),m(l,h.startContainer,h.startOffset)):(c(q),c(l),m(b?l:q,h.endContainer,h.endOffset),m(b?q:l,h.startContainer,h.startOffset));a.forEach(r.normalizeTextNodes);a.length=0};this.hasForwardSelection=function(){return b};this.remove=function(){c(l);a.forEach(r.normalizeTextNodes);a.length=0};l.setAttributeNS("urn:webodf:names:cursor",
"memberId",g);q.setAttributeNS("urn:webodf:names:cursor","memberId",g)};
core.EventNotifier=function(f){var g={};this.emit=function(c,f){var l,q;runtime.assert(g.hasOwnProperty(c),'unknown event fired "'+c+'"');q=g[c];for(l=0;l<q.length;l+=1)q[l](f)};this.subscribe=function(c,f){runtime.assert(g.hasOwnProperty(c),'tried to subscribe to unknown event "'+c+'"');g[c].push(f);runtime.log('event "'+c+'" subscribed.')};this.unsubscribe=function(c,f){var l;runtime.assert(g.hasOwnProperty(c),'tried to unsubscribe from unknown event "'+c+'"');l=g[c].indexOf(f);runtime.assert(-1!==
l,'tried to unsubscribe unknown callback from event "'+c+'"');-1!==l&&g[c].splice(l,1);runtime.log('event "'+c+'" unsubscribed.')};(function(){var c;for(c=0;c<f.length;c+=1)g[f[c]]=[]})()};
core.UnitTest=function(){};core.UnitTest.prototype.setUp=function(){};core.UnitTest.prototype.tearDown=function(){};core.UnitTest.prototype.description=function(){};core.UnitTest.prototype.tests=function(){};core.UnitTest.prototype.asyncTests=function(){};
core.UnitTest.provideTestAreaDiv=function(){var f=runtime.getWindow().document,g=f.getElementById("testarea");runtime.assert(!g,'Unclean test environment, found a div with id "testarea".');g=f.createElement("div");g.setAttribute("id","testarea");f.body.appendChild(g);return g};
core.UnitTest.cleanupTestAreaDiv=function(){var f=runtime.getWindow().document,g=f.getElementById("testarea");runtime.assert(!!g&&g.parentNode===f.body,'Test environment broken, found no div with id "testarea" below body.');f.body.removeChild(g)};core.UnitTest.createOdtDocument=function(f,g){var c="<?xml version='1.0' encoding='UTF-8'?>",c=c+"<office:document";Object.keys(g).forEach(function(f){c+=" xmlns:"+f+'="'+g[f]+'"'});c+=">";c+=f;c+="</office:document>";return runtime.parseXML(c)};
core.UnitTestRunner=function(){function f(a){b+=1;runtime.log("fail",a)}function g(a,b){var c;try{if(a.length!==b.length)return f("array of length "+a.length+" should be "+b.length+" long"),!1;for(c=0;c<a.length;c+=1)if(a[c]!==b[c])return f(a[c]+" should be "+b[c]+" at array index "+c),!1}catch(h){return!1}return!0}function c(a,b,g){var h=a.attributes,p=h.length,k,n,t;for(k=0;k<p;k+=1)if(n=h.item(k),"xmlns"!==n.prefix){t=b.getAttributeNS(n.namespaceURI,n.localName);if(!b.hasAttributeNS(n.namespaceURI,
n.localName))return f("Attribute "+n.localName+" with value "+n.value+" was not present"),!1;if(t!==n.value)return f("Attribute "+n.localName+" was "+t+" should be "+n.value),!1}return g?!0:c(b,a,!0)}function m(a,b){if(a.nodeType!==b.nodeType)return f(a.nodeType+" should be "+b.nodeType),!1;if(a.nodeType===Node.TEXT_NODE)return a.data===b.data;runtime.assert(a.nodeType===Node.ELEMENT_NODE,"Only textnodes and elements supported.");if(a.namespaceURI!==b.namespaceURI||a.localName!==b.localName)return f(a.namespaceURI+
" should be "+b.namespaceURI),!1;if(!c(a,b,!1))return!1;for(var g=a.firstChild,h=b.firstChild;g;){if(!h||!m(g,h))return!1;g=g.nextSibling;h=h.nextSibling}return h?!1:!0}function l(b,d){return 0===d?b===d&&1/b===1/d:b===d?!0:"number"===typeof d&&isNaN(d)?"number"===typeof b&&isNaN(b):Object.prototype.toString.call(d)===Object.prototype.toString.call([])?g(b,d):"object"===typeof d&&"object"===typeof b?d.constructor===Element||d.constructor===Node?m(d,b):a(d,b):!1}function q(a,b,c){"string"===typeof b&&
"string"===typeof c||runtime.log("WARN: shouldBe() expects string arguments");var h,p;try{p=eval(b)}catch(k){h=k}a=eval(c);h?f(b+" should be "+a+". Threw exception "+h):l(p,a)?runtime.log("pass",b+" is "+c):String(typeof p)===String(typeof a)?(c=0===p&&0>1/p?"-0":String(p),f(b+" should be "+a+". Was "+c+".")):f(b+" should be "+a+" (of type "+typeof a+"). Was "+p+" (of type "+typeof p+").")}var b=0,a;a=function(a,b){var c=Object.keys(a),h=Object.keys(b);c.sort();h.sort();return g(c,h)&&Object.keys(a).every(function(h){var c=
a[h],n=b[h];return l(c,n)?!0:(f(c+" should be "+n+" for key "+h),!1)})};this.areNodesEqual=m;this.shouldBeNull=function(a,b){q(a,b,"null")};this.shouldBeNonNull=function(a,b){var c,h;try{h=eval(b)}catch(p){c=p}c?f(b+" should be non-null. Threw exception "+c):null!==h?runtime.log("pass",b+" is non-null."):f(b+" should be non-null. Was "+h)};this.shouldBe=q;this.countFailedTests=function(){return b}};
core.UnitTester=function(){function f(c,f){return"<span style='color:blue;cursor:pointer' onclick='"+f+"'>"+c+"</span>"}var g=0,c={};this.runTests=function(m,l,q){function b(h){if(0===h.length)c[a]=r,g+=e.countFailedTests(),l();else{p=h[0];var k=Runtime.getFunctionName(p);runtime.log("Running "+k);n=e.countFailedTests();d.setUp();p(function(){d.tearDown();r[k]=n===e.countFailedTests();b(h.slice(1))})}}var a=Runtime.getFunctionName(m),e=new core.UnitTestRunner,d=new m(e),r={},h,p,k,n,t="BrowserRuntime"===
runtime.type();if(c.hasOwnProperty(a))runtime.log("Test "+a+" has already run.");else{t?runtime.log("<span>Running "+f(a,'runSuite("'+a+'");')+": "+d.description()+"</span>"):runtime.log("Running "+a+": "+d.description);k=d.tests();for(h=0;h<k.length;h+=1)p=k[h],m=Runtime.getFunctionName(p)||p.testName,q.length&&-1===q.indexOf(m)||(t?runtime.log("<span>Running "+f(m,'runTest("'+a+'","'+m+'")')+"</span>"):runtime.log("Running "+m),n=e.countFailedTests(),d.setUp(),p(),d.tearDown(),r[m]=n===e.countFailedTests());
b(d.asyncTests())}};this.countFailedTests=function(){return g};this.results=function(){return c}};
core.PositionIterator=function(f,g,c,m){function l(){this.acceptNode=function(a){return a.nodeType===Node.TEXT_NODE&&0===a.length?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}function q(a){this.acceptNode=function(b){return b.nodeType===Node.TEXT_NODE&&0===b.length?NodeFilter.FILTER_REJECT:a.acceptNode(b)}}function b(){var a=e.currentNode.nodeType;d=a===Node.TEXT_NODE?e.currentNode.length-1:a===Node.ELEMENT_NODE?1:0}var a=this,e,d,r;this.nextPosition=function(){if(e.currentNode===f)return!1;
if(0===d&&e.currentNode.nodeType===Node.ELEMENT_NODE)null===e.firstChild()&&(d=1);else if(e.currentNode.nodeType===Node.TEXT_NODE&&d+1<e.currentNode.length)d+=1;else if(null!==e.nextSibling())d=0;else if(e.parentNode())d=1;else return!1;return!0};this.previousPosition=function(){var a=!0;if(0===d)if(null===e.previousSibling()){if(!e.parentNode()||e.currentNode===f)return e.firstChild(),!1;d=0}else b();else e.currentNode.nodeType===Node.TEXT_NODE?d-=1:null!==e.lastChild()?b():e.currentNode===f?a=!1:
d=0;return a};this.container=function(){var a=e.currentNode,b=a.nodeType;return 0===d&&b!==Node.TEXT_NODE?a.parentNode:a};this.rightNode=function(){var a=e.currentNode,b=a.nodeType;if(b===Node.TEXT_NODE&&d===a.length)for(a=a.nextSibling;a&&1!==r(a);)a=a.nextSibling;else b===Node.ELEMENT_NODE&&1===d&&(a=null);return a};this.leftNode=function(){var a=e.currentNode;if(0===d)for(a=a.previousSibling;a&&1!==r(a);)a=a.previousSibling;else if(a.nodeType===Node.ELEMENT_NODE)for(a=a.lastChild;a&&1!==r(a);)a=
a.previousSibling;return a};this.getCurrentNode=function(){return e.currentNode};this.unfilteredDomOffset=function(){if(e.currentNode.nodeType===Node.TEXT_NODE)return d;for(var a=0,b=e.currentNode,b=1===d?b.lastChild:b.previousSibling;b;)a+=1,b=b.previousSibling;return a};this.getPreviousSibling=function(){var a=e.currentNode,b=e.previousSibling();e.currentNode=a;return b};this.getNextSibling=function(){var a=e.currentNode,b=e.nextSibling();e.currentNode=a;return b};this.setUnfilteredPosition=function(b,
c){var k,n;runtime.assert(null!==b&&void 0!==b,"PositionIterator.setUnfilteredPosition called without container");e.currentNode=b;if(b.nodeType===Node.TEXT_NODE)return d=c,runtime.assert(c<=b.length,"Error in setPosition: "+c+" > "+b.length),runtime.assert(0<=c,"Error in setPosition: "+c+" < 0"),c===b.length&&(d=void 0,e.nextSibling()?d=0:e.parentNode()&&(d=1),runtime.assert(void 0!==d,"Error in setPosition: position not valid.")),!0;k=r(b);for(n=b.parentNode;n&&n!==f&&k===NodeFilter.FILTER_ACCEPT;)k=
r(n),k!==NodeFilter.FILTER_ACCEPT&&(e.currentNode=n),n=n.parentNode;c<b.childNodes.length&&k!==NodeFilter.FILTER_REJECT?(e.currentNode=b.childNodes[c],k=r(e.currentNode),d=0):d=1;k===NodeFilter.FILTER_REJECT&&(d=1);if(k!==NodeFilter.FILTER_ACCEPT)return a.nextPosition();runtime.assert(r(e.currentNode)===NodeFilter.FILTER_ACCEPT,"PositionIterater.setUnfilteredPosition call resulted in an non-visible node being set");return!0};this.moveToEnd=function(){e.currentNode=f;d=1};this.moveToEndOfNode=function(b){b.nodeType===
Node.TEXT_NODE?a.setUnfilteredPosition(b,b.length):(e.currentNode=b,d=1)};this.getNodeFilter=function(){return r};r=(c?new q(c):new l).acceptNode;r.acceptNode=r;e=f.ownerDocument.createTreeWalker(f,g||4294967295,r,m);d=0;null===e.firstChild()&&(d=1)};
runtime.loadClass("core.PositionIterator");core.PositionFilter=function(){};core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};core.PositionFilter.prototype.acceptPosition=function(f){};(function(){return core.PositionFilter})();
runtime.loadClass("core.PositionFilter");core.PositionFilterChain=function(){var f={},g=core.PositionFilter.FilterResult.FILTER_ACCEPT,c=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(m){for(var l in f)if(f.hasOwnProperty(l)&&f[l].acceptPosition(m)===c)return c;return g};this.addFilter=function(c,g){f[c]=g};this.removeFilter=function(c){delete f[c]}};
core.Async=function(){this.forEach=function(f,g,c){function m(a){b!==q&&(a?(b=q,c(a)):(b+=1,b===q&&c(null)))}var l,q=f.length,b=0;for(l=0;l<q;l+=1)g(f[l],m)}};
runtime.loadClass("core.RawInflate");runtime.loadClass("core.ByteArray");runtime.loadClass("core.ByteArrayWriter");runtime.loadClass("core.Base64");
core.Zip=function(f,g){function c(a){var b=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,
853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,
4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,
225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,
2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,
2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],d,c,e=a.length,h=0,h=0;d=-1;for(c=0;c<e;c+=1)h=(d^a[c])&255,h=b[h],d=d>>>8^h;return d^-1}function m(a){return new Date((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&15,a>>5&63,(a&31)<<1)}function l(a){var b=a.getFullYear();return 1980>b?0:b-1980<<
25|a.getMonth()+1<<21|a.getDate()<<16|a.getHours()<<11|a.getMinutes()<<5|a.getSeconds()>>1}function q(a,b){var d,c,e,h,k,p,f,g=this;this.load=function(b){if(void 0!==g.data)b(null,g.data);else{var d=k+34+c+e+256;d+f>n&&(d=n-f);runtime.read(a,f,d,function(d,c){if(d||null===c)b(d,c);else a:{var e=c,n=new core.ByteArray(e),f=n.readUInt32LE(),s;if(67324752!==f)b("File entry signature is wrong."+f.toString()+" "+e.length.toString(),null);else{n.pos+=22;f=n.readUInt16LE();s=n.readUInt16LE();n.pos+=f+s;
if(h){e=e.slice(n.pos,n.pos+k);if(k!==e.length){b("The amount of compressed bytes read was "+e.length.toString()+" instead of "+k.toString()+" for "+g.filename+" in "+a+".",null);break a}e=w(e,p)}else e=e.slice(n.pos,n.pos+p);p!==e.length?b("The amount of bytes read was "+e.length.toString()+" instead of "+p.toString()+" for "+g.filename+" in "+a+".",null):(g.data=e,b(null,e))}}})}};this.set=function(a,b,d,c){g.filename=a;g.data=b;g.compressed=d;g.date=c};this.error=null;b&&(d=b.readUInt32LE(),33639248!==
d?this.error="Central directory entry has wrong signature at position "+(b.pos-4).toString()+' for file "'+a+'": '+b.data.length.toString():(b.pos+=6,h=b.readUInt16LE(),this.date=m(b.readUInt32LE()),b.readUInt32LE(),k=b.readUInt32LE(),p=b.readUInt32LE(),c=b.readUInt16LE(),e=b.readUInt16LE(),d=b.readUInt16LE(),b.pos+=8,f=b.readUInt32LE(),this.filename=runtime.byteArrayToString(b.data.slice(b.pos,b.pos+c),"utf8"),b.pos+=c+e+d))}function b(a,b){if(22!==a.length)b("Central directory length should be 22.",
v);else{var d=new core.ByteArray(a),c;c=d.readUInt32LE();101010256!==c?b("Central directory signature is wrong: "+c.toString(),v):(c=d.readUInt16LE(),0!==c?b("Zip files with non-zero disk numbers are not supported.",v):(c=d.readUInt16LE(),0!==c?b("Zip files with non-zero disk numbers are not supported.",v):(c=d.readUInt16LE(),t=d.readUInt16LE(),c!==t?b("Number of entries is inconsistent.",v):(c=d.readUInt32LE(),d=d.readUInt16LE(),d=n-22-c,runtime.read(f,d,n-d,function(a,d){if(a||null===d)b(a,v);else a:{var c=
new core.ByteArray(d),e,h;k=[];for(e=0;e<t;e+=1){h=new q(f,c);if(h.error){b(h.error,v);break a}k[k.length]=h}b(null,v)}})))))}}function a(a,b){var d=null,c,e;for(e=0;e<k.length;e+=1)if(c=k[e],c.filename===a){d=c;break}d?d.data?b(null,d.data):d.load(b):b(a+" not found.",null)}function e(a){var b=new core.ByteArrayWriter("utf8"),d=0;b.appendArray([80,75,3,4,20,0,0,0,0,0]);a.data&&(d=a.data.length);b.appendUInt32LE(l(a.date));b.appendUInt32LE(c(a.data));b.appendUInt32LE(d);b.appendUInt32LE(d);b.appendUInt16LE(a.filename.length);
b.appendUInt16LE(0);b.appendString(a.filename);a.data&&b.appendByteArray(a.data);return b}function d(a,b){var d=new core.ByteArrayWriter("utf8"),e=0;d.appendArray([80,75,1,2,20,0,20,0,0,0,0,0]);a.data&&(e=a.data.length);d.appendUInt32LE(l(a.date));d.appendUInt32LE(c(a.data));d.appendUInt32LE(e);d.appendUInt32LE(e);d.appendUInt16LE(a.filename.length);d.appendArray([0,0,0,0,0,0,0,0,0,0,0,0]);d.appendUInt32LE(b);d.appendString(a.filename);return d}function r(a,b){if(a===k.length)b(null);else{var d=k[a];
void 0!==d.data?r(a+1,b):d.load(function(d){d?b(d):r(a+1,b)})}}function h(a,b){r(0,function(c){if(c)b(c);else{c=new core.ByteArrayWriter("utf8");var h,p,n,f=[0];for(h=0;h<k.length;h+=1)c.appendByteArrayWriter(e(k[h])),f.push(c.getLength());n=c.getLength();for(h=0;h<k.length;h+=1)p=k[h],c.appendByteArrayWriter(d(p,f[h]));h=c.getLength()-n;c.appendArray([80,75,5,6,0,0,0,0]);c.appendUInt16LE(k.length);c.appendUInt16LE(k.length);c.appendUInt32LE(h);c.appendUInt32LE(n);c.appendArray([0,0]);a(c.getByteArray())}})}
function p(a,b){h(function(d){runtime.writeFile(a,d,b)},b)}var k,n,t,w=(new core.RawInflate).inflate,v=this,y=new core.Base64;this.load=a;this.save=function(a,b,d,c){var e,h;for(e=0;e<k.length;e+=1)if(h=k[e],h.filename===a){h.set(a,b,d,c);return}h=new q(f);h.set(a,b,d,c);k.push(h)};this.remove=function(a){var b,d;for(b=0;b<k.length;b+=1)if(d=k[b],d.filename===a)return k.splice(b,1),!0;return!1};this.write=function(a){p(f,a)};this.writeAs=p;this.createByteArray=h;this.loadContentXmlAsFragments=function(a,
b){v.loadAsString(a,function(a,d){if(a)return b.rootElementReady(a);b.rootElementReady(null,d,!0)})};this.loadAsString=function(b,d){a(b,function(a,b){if(a||null===b)return d(a,null);var c=runtime.byteArrayToString(b,"utf8");d(null,c)})};this.loadAsDOM=function(a,b){v.loadAsString(a,function(a,d){if(a||null===d)b(a,null);else{var c=(new DOMParser).parseFromString(d,"text/xml");b(null,c)}})};this.loadAsDataURL=function(b,d,c){a(b,function(a,b){if(a)return c(a,null);var e=0,h;d||(d=80===b[1]&&78===
b[2]&&71===b[3]?"image/png":255===b[0]&&216===b[1]&&255===b[2]?"image/jpeg":71===b[0]&&73===b[1]&&70===b[2]?"image/gif":"");for(h="data:"+d+";base64,";e<b.length;)h+=y.convertUTF8ArrayToBase64(b.slice(e,Math.min(e+45E3,b.length))),e+=45E3;c(null,h)})};this.getEntries=function(){return k.slice()};n=-1;null===g?k=[]:runtime.getFileSize(f,function(a){n=a;0>n?g("File '"+f+"' cannot be read.",v):runtime.read(f,n-22,22,function(a,d){a||null===g||null===d?g(a,v):b(d,g)})})};
core.CSSUnits=function(){var f={"in":1,cm:2.54,mm:25.4,pt:72,pc:12};this.convert=function(g,c,m){return g*f[m]/f[c]};this.convertMeasure=function(f,c){var m,l;f&&c?(m=parseFloat(f),l=f.replace(m.toString(),""),m=this.convert(m,l,c)):m="";return m.toString()};this.getUnits=function(f){return f.substr(f.length-2,f.length)}};
xmldom.LSSerializerFilter=function(){};
"function"!==typeof Object.create&&(Object.create=function(f){var g=function(){};g.prototype=f;return new g});
xmldom.LSSerializer=function(){function f(c){var f=c||{},b=function(a){var b={},d;for(d in a)a.hasOwnProperty(d)&&(b[a[d]]=d);return b}(c),a=[f],e=[b],d=0;this.push=function(){d+=1;f=a[d]=Object.create(f);b=e[d]=Object.create(b)};this.pop=function(){a[d]=void 0;e[d]=void 0;d-=1;f=a[d];b=e[d]};this.getLocalNamespaceDefinitions=function(){return b};this.getQName=function(a){var d=a.namespaceURI,c=0,e;if(!d)return a.localName;if(e=b[d])return e+":"+a.localName;do{e||!a.prefix?(e="ns"+c,c+=1):e=a.prefix;
if(f[e]===d)break;if(!f[e]){f[e]=d;b[d]=e;break}e=null}while(null===e);return e+":"+a.localName}}function g(c){return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function c(f,q){var b="",a=m.filter?m.filter.acceptNode(q):NodeFilter.FILTER_ACCEPT,e;if(a===NodeFilter.FILTER_ACCEPT&&q.nodeType===Node.ELEMENT_NODE){f.push();e=f.getQName(q);var d,r=q.attributes,h,p,k,n="",t;d="<"+e;h=r.length;for(p=0;p<h;p+=1)k=r.item(p),"http://www.w3.org/2000/xmlns/"!==
k.namespaceURI&&(t=m.filter?m.filter.acceptNode(k):NodeFilter.FILTER_ACCEPT,t===NodeFilter.FILTER_ACCEPT&&(t=f.getQName(k),k="string"===typeof k.value?g(k.value):k.value,n+=" "+(t+'="'+k+'"')));h=f.getLocalNamespaceDefinitions();for(p in h)h.hasOwnProperty(p)&&((r=h[p])?"xmlns"!==r&&(d+=" xmlns:"+h[p]+'="'+p+'"'):d+=' xmlns="'+p+'"');b+=d+(n+">")}if(a===NodeFilter.FILTER_ACCEPT||a===NodeFilter.FILTER_SKIP){for(a=q.firstChild;a;)b+=c(f,a),a=a.nextSibling;q.nodeValue&&(b+=g(q.nodeValue))}e&&(b+="</"+
e+">",f.pop());return b}var m=this;this.filter=null;this.writeToString=function(g,q){if(!g)return"";var b=new f(q);return c(b,g)}};
xmldom.RelaxNGParser=function(){function f(a,b){this.message=function(){b&&(a+=1===b.nodeType?" Element ":" Node ",a+=b.nodeName,b.nodeValue&&(a+=" with value '"+b.nodeValue+"'"),a+=".");return a}}function g(a){if(2>=a.e.length)return a;var b={name:a.name,e:a.e.slice(0,2)};return g({name:a.name,e:[b].concat(a.e.slice(2))})}function c(b){b=b.split(":",2);var c="",e;1===b.length?b=["",b[0]]:c=b[0];for(e in a)a[e]===c&&(b[0]=e);return b}function m(a,b){for(var e=0,f,k,n=a.name;a.e&&e<a.e.length;)if(f=
a.e[e],"ref"===f.name){k=b[f.a.name];if(!k)throw f.a.name+" was not defined.";f=a.e.slice(e+1);a.e=a.e.slice(0,e);a.e=a.e.concat(k.e);a.e=a.e.concat(f)}else e+=1,m(f,b);f=a.e;"choice"!==n||f&&f[1]&&"empty"!==f[1].name||(f&&f[0]&&"empty"!==f[0].name?(f[1]=f[0],f[0]={name:"empty"}):(delete a.e,a.name="empty"));if("group"===n||"interleave"===n)"empty"===f[0].name?"empty"===f[1].name?(delete a.e,a.name="empty"):(n=a.name=f[1].name,a.names=f[1].names,f=a.e=f[1].e):"empty"===f[1].name&&(n=a.name=f[0].name,
a.names=f[0].names,f=a.e=f[0].e);"oneOrMore"===n&&"empty"===f[0].name&&(delete a.e,a.name="empty");if("attribute"===n){k=a.names?a.names.length:0;for(var g,l=[],q=[],e=0;e<k;e+=1)g=c(a.names[e]),q[e]=g[0],l[e]=g[1];a.localnames=l;a.namespaces=q}"interleave"===n&&("interleave"===f[0].name?a.e="interleave"===f[1].name?f[0].e.concat(f[1].e):[f[1]].concat(f[0].e):"interleave"===f[1].name&&(a.e=[f[0]].concat(f[1].e)))}function l(a,b){for(var c=0,e;a.e&&c<a.e.length;)e=a.e[c],"elementref"===e.name?(e.id=
e.id||0,a.e[c]=b[e.id]):"element"!==e.name&&l(e,b),c+=1}var q=this,b,a={"http://www.w3.org/XML/1998/namespace":"xml"},e;e=function(b,f,h){var p=[],k,n,t=b.localName,l=[];k=b.attributes;var q=t,m=l,x={},u,s;for(u=0;u<k.length;u+=1)if(s=k.item(u),s.namespaceURI)"http://www.w3.org/2000/xmlns/"===s.namespaceURI&&(a[s.value]=s.localName);else{"name"!==s.localName||"element"!==q&&"attribute"!==q||m.push(s.value);if("name"===s.localName||"combine"===s.localName||"type"===s.localName){var C=s,z;z=s.value;
z=z.replace(/^\s\s*/,"");for(var E=/\s/,N=z.length-1;E.test(z.charAt(N));)N-=1;z=z.slice(0,N+1);C.value=z}x[s.localName]=s.value}k=x;k.combine=k.combine||void 0;b=b.firstChild;q=p;m=l;for(x="";b;){if(b.nodeType===Node.ELEMENT_NODE&&"http://relaxng.org/ns/structure/1.0"===b.namespaceURI){if(u=e(b,f,q))"name"===u.name?m.push(a[u.a.ns]+":"+u.text):"choice"===u.name&&u.names&&u.names.length&&(m=m.concat(u.names),delete u.names),q.push(u)}else b.nodeType===Node.TEXT_NODE&&(x+=b.nodeValue);b=b.nextSibling}b=
x;"value"!==t&&"param"!==t&&(b=/^\s*([\s\S]*\S)?\s*$/.exec(b)[1]);"value"===t&&void 0===k.type&&(k.type="token",k.datatypeLibrary="");"attribute"!==t&&"element"!==t||void 0===k.name||(n=c(k.name),p=[{name:"name",text:n[1],a:{ns:n[0]}}].concat(p),delete k.name);"name"===t||"nsName"===t||"value"===t?void 0===k.ns&&(k.ns=""):delete k.ns;"name"===t&&(n=c(b),k.ns=n[0],b=n[1]);1<p.length&&("define"===t||"oneOrMore"===t||"zeroOrMore"===t||"optional"===t||"list"===t||"mixed"===t)&&(p=[{name:"group",e:g({name:"group",
e:p}).e}]);2<p.length&&"element"===t&&(p=[p[0]].concat({name:"group",e:g({name:"group",e:p.slice(1)}).e}));1===p.length&&"attribute"===t&&p.push({name:"text",text:b});1!==p.length||"choice"!==t&&"group"!==t&&"interleave"!==t?2<p.length&&("choice"===t||"group"===t||"interleave"===t)&&(p=g({name:t,e:p}).e):(t=p[0].name,l=p[0].names,k=p[0].a,b=p[0].text,p=p[0].e);"mixed"===t&&(t="interleave",p=[p[0],{name:"text"}]);"optional"===t&&(t="choice",p=[p[0],{name:"empty"}]);"zeroOrMore"===t&&(t="choice",p=
[{name:"oneOrMore",e:[p[0]]},{name:"empty"}]);if("define"===t&&k.combine){a:{q=k.combine;m=k.name;x=p;for(u=0;h&&u<h.length;u+=1)if(s=h[u],"define"===s.name&&s.a&&s.a.name===m){s.e=[{name:q,e:s.e.concat(x)}];h=s;break a}h=null}if(h)return}h={name:t};p&&0<p.length&&(h.e=p);for(n in k)if(k.hasOwnProperty(n)){h.a=k;break}void 0!==b&&(h.text=b);l&&0<l.length&&(h.names=l);"element"===t&&(h.id=f.length,f.push(h),h={name:"elementref",id:h.id});return h};this.parseRelaxNGDOM=function(c,g){var h=[],p=e(c&&
c.documentElement,h,void 0),k,n,t={};for(k=0;k<p.e.length;k+=1)n=p.e[k],"define"===n.name?t[n.a.name]=n:"start"===n.name&&(b=n);if(!b)return[new f("No Relax NG start element was found.")];m(b,t);for(k in t)t.hasOwnProperty(k)&&m(t[k],t);for(k=0;k<h.length;k+=1)m(h[k],t);g&&(q.rootPattern=g(b.e[0],h));l(b,h);for(k=0;k<h.length;k+=1)l(h[k],h);q.start=b;q.elements=h;q.nsmap=a;return null}};
runtime.loadClass("xmldom.RelaxNGParser");
xmldom.RelaxNG=function(){function f(a){return function(){var b;return function(){void 0===b&&(b=a());return b}}()}function g(a,b){return function(){var c={},d=0;return function(e){var h=e.hash||e.toString(),f;f=c[h];if(void 0!==f)return f;c[h]=f=b(e);f.hash=a+d.toString();d+=1;return f}}()}function c(a){return function(){var b={};return function(c){var d,e;e=b[c.localName];if(void 0===e)b[c.localName]=e={};else if(d=e[c.namespaceURI],void 0!==d)return d;return e[c.namespaceURI]=d=a(c)}}()}function m(a,
b,c){return function(){var d={},e=0;return function(h,f){var k=b&&b(h,f),n,p;if(void 0!==k)return k;k=h.hash||h.toString();n=f.hash||f.toString();p=d[k];if(void 0===p)d[k]=p={};else if(k=p[n],void 0!==k)return k;p[n]=k=c(h,f);k.hash=a+e.toString();e+=1;return k}}()}function l(a,b){"choice"===b.p1.type?l(a,b.p1):a[b.p1.hash]=b.p1;"choice"===b.p2.type?l(a,b.p2):a[b.p2.hash]=b.p2}function q(a,b){return{type:"element",nc:a,nullable:!1,textDeriv:function(){return u},startTagOpenDeriv:function(c){return a.contains(c)?
k(b,s):u},attDeriv:function(){return u},startTagCloseDeriv:function(){return this}}}function b(){return{type:"list",nullable:!1,hash:"list",textDeriv:function(){return s}}}function a(b,c,e,h){if(c===u)return u;if(h>=e.length)return c;0===h&&(h=0);for(var f=e.item(h);f.namespaceURI===d;){h+=1;if(h>=e.length)return c;f=e.item(h)}return f=a(b,c.attDeriv(b,e.item(h)),e,h+1)}function e(a,b,c){c.e[0].a?(a.push(c.e[0].text),b.push(c.e[0].a.ns)):e(a,b,c.e[0]);c.e[1].a?(a.push(c.e[1].text),b.push(c.e[1].a.ns)):
e(a,b,c.e[1])}var d="http://www.w3.org/2000/xmlns/",r,h,p,k,n,t,w,v,y,x,u={type:"notAllowed",nullable:!1,hash:"notAllowed",textDeriv:function(){return u},startTagOpenDeriv:function(){return u},attDeriv:function(){return u},startTagCloseDeriv:function(){return u},endTagDeriv:function(){return u}},s={type:"empty",nullable:!0,hash:"empty",textDeriv:function(){return u},startTagOpenDeriv:function(){return u},attDeriv:function(){return u},startTagCloseDeriv:function(){return s},endTagDeriv:function(){return u}},
C={type:"text",nullable:!0,hash:"text",textDeriv:function(){return C},startTagOpenDeriv:function(){return u},attDeriv:function(){return u},startTagCloseDeriv:function(){return C},endTagDeriv:function(){return u}},z,E,N;r=m("choice",function(a,b){if(a===u)return b;if(b===u||a===b)return a},function(a,b){var d={},e;l(d,{p1:a,p2:b});b=a=void 0;for(e in d)d.hasOwnProperty(e)&&(void 0===a?a=d[e]:b=void 0===b?d[e]:r(b,d[e]));return function(a,b){return{type:"choice",p1:a,p2:b,nullable:a.nullable||b.nullable,
textDeriv:function(c,d){return r(a.textDeriv(c,d),b.textDeriv(c,d))},startTagOpenDeriv:c(function(c){return r(a.startTagOpenDeriv(c),b.startTagOpenDeriv(c))}),attDeriv:function(c,d){return r(a.attDeriv(c,d),b.attDeriv(c,d))},startTagCloseDeriv:f(function(){return r(a.startTagCloseDeriv(),b.startTagCloseDeriv())}),endTagDeriv:f(function(){return r(a.endTagDeriv(),b.endTagDeriv())})}}(a,b)});h=function(a,b,c){return function(){var d={},e=0;return function(h,f){var k=b&&b(h,f),n,p;if(void 0!==k)return k;
k=h.hash||h.toString();n=f.hash||f.toString();k<n&&(p=k,k=n,n=p,p=h,h=f,f=p);p=d[k];if(void 0===p)d[k]=p={};else if(k=p[n],void 0!==k)return k;p[n]=k=c(h,f);k.hash=a+e.toString();e+=1;return k}}()}("interleave",function(a,b){if(a===u||b===u)return u;if(a===s)return b;if(b===s)return a},function(a,b){return{type:"interleave",p1:a,p2:b,nullable:a.nullable&&b.nullable,textDeriv:function(c,d){return r(h(a.textDeriv(c,d),b),h(a,b.textDeriv(c,d)))},startTagOpenDeriv:c(function(c){return r(z(function(a){return h(a,
b)},a.startTagOpenDeriv(c)),z(function(b){return h(a,b)},b.startTagOpenDeriv(c)))}),attDeriv:function(c,d){return r(h(a.attDeriv(c,d),b),h(a,b.attDeriv(c,d)))},startTagCloseDeriv:f(function(){return h(a.startTagCloseDeriv(),b.startTagCloseDeriv())})}});p=m("group",function(a,b){if(a===u||b===u)return u;if(a===s)return b;if(b===s)return a},function(a,b){return{type:"group",p1:a,p2:b,nullable:a.nullable&&b.nullable,textDeriv:function(c,d){var e=p(a.textDeriv(c,d),b);return a.nullable?r(e,b.textDeriv(c,
d)):e},startTagOpenDeriv:function(c){var d=z(function(a){return p(a,b)},a.startTagOpenDeriv(c));return a.nullable?r(d,b.startTagOpenDeriv(c)):d},attDeriv:function(c,d){return r(p(a.attDeriv(c,d),b),p(a,b.attDeriv(c,d)))},startTagCloseDeriv:f(function(){return p(a.startTagCloseDeriv(),b.startTagCloseDeriv())})}});k=m("after",function(a,b){if(a===u||b===u)return u},function(a,b){return{type:"after",p1:a,p2:b,nullable:!1,textDeriv:function(c,d){return k(a.textDeriv(c,d),b)},startTagOpenDeriv:c(function(c){return z(function(a){return k(a,
b)},a.startTagOpenDeriv(c))}),attDeriv:function(c,d){return k(a.attDeriv(c,d),b)},startTagCloseDeriv:f(function(){return k(a.startTagCloseDeriv(),b)}),endTagDeriv:f(function(){return a.nullable?b:u})}});n=g("oneormore",function(a){return a===u?u:{type:"oneOrMore",p:a,nullable:a.nullable,textDeriv:function(b,c){return p(a.textDeriv(b,c),r(this,s))},startTagOpenDeriv:function(b){var c=this;return z(function(a){return p(a,r(c,s))},a.startTagOpenDeriv(b))},attDeriv:function(b,c){return p(a.attDeriv(b,
c),r(this,s))},startTagCloseDeriv:f(function(){return n(a.startTagCloseDeriv())})}});w=m("attribute",void 0,function(a,b){return{type:"attribute",nullable:!1,nc:a,p:b,attDeriv:function(c,d){return a.contains(d)&&(b.nullable&&/^\s+$/.test(d.nodeValue)||b.textDeriv(c,d.nodeValue).nullable)?s:u},startTagCloseDeriv:function(){return u}}});t=g("value",function(a){return{type:"value",nullable:!1,value:a,textDeriv:function(b,c){return c===a?s:u},attDeriv:function(){return u},startTagCloseDeriv:function(){return this}}});
y=g("data",function(a){return{type:"data",nullable:!1,dataType:a,textDeriv:function(){return s},attDeriv:function(){return u},startTagCloseDeriv:function(){return this}}});z=function M(a,b){return"after"===b.type?k(b.p1,a(b.p2)):"choice"===b.type?r(M(a,b.p1),M(a,b.p2)):b};E=function(b,c,d){var e=d.currentNode;c=c.startTagOpenDeriv(e);c=a(b,c,e.attributes,0);var h=c=c.startTagCloseDeriv(),e=d.currentNode;c=d.firstChild();for(var f=[],k;c;)c.nodeType===Node.ELEMENT_NODE?f.push(c):c.nodeType!==Node.TEXT_NODE||
/^\s*$/.test(c.nodeValue)||f.push(c.nodeValue),c=d.nextSibling();0===f.length&&(f=[""]);k=h;for(h=0;k!==u&&h<f.length;h+=1)c=f[h],"string"===typeof c?k=/^\s*$/.test(c)?r(k,k.textDeriv(b,c)):k.textDeriv(b,c):(d.currentNode=c,k=E(b,k,d));d.currentNode=e;return c=k.endTagDeriv()};v=function(a){var b,c,d;if("name"===a.name)b=a.text,c=a.a.ns,a={name:b,ns:c,hash:"{"+c+"}"+b,contains:function(a){return a.namespaceURI===c&&a.localName===b}};else if("choice"===a.name){b=[];c=[];e(b,c,a);a="";for(d=0;d<b.length;d+=
1)a+="{"+c[d]+"}"+b[d]+",";a={hash:a,contains:function(a){var d;for(d=0;d<b.length;d+=1)if(b[d]===a.localName&&c[d]===a.namespaceURI)return!0;return!1}}}else a={hash:"anyName",contains:function(){return!0}};return a};x=function D(a,c){var d,e;if("elementref"===a.name){d=a.id||0;a=c[d];if(void 0!==a.name){var f=a;d=c[f.id]={hash:"element"+f.id.toString()};f=q(v(f.e[0]),x(f.e[1],c));for(e in f)f.hasOwnProperty(e)&&(d[e]=f[e]);return d}return a}switch(a.name){case "empty":return s;case "notAllowed":return u;
case "text":return C;case "choice":return r(D(a.e[0],c),D(a.e[1],c));case "interleave":d=D(a.e[0],c);for(e=1;e<a.e.length;e+=1)d=h(d,D(a.e[e],c));return d;case "group":return p(D(a.e[0],c),D(a.e[1],c));case "oneOrMore":return n(D(a.e[0],c));case "attribute":return w(v(a.e[0]),D(a.e[1],c));case "value":return t(a.text);case "data":return d=a.a&&a.a.type,void 0===d&&(d=""),y(d);case "list":return b()}throw"No support for "+a.name;};this.makePattern=function(a,b){var c={},d;for(d in b)b.hasOwnProperty(d)&&
(c[d]=b[d]);return d=x(a,c)};this.validate=function(a,b){var c;a.currentNode=a.root;c=E(null,N,a);c.nullable?b(null):(runtime.log("Error in Relax NG validation: "+c),b(["Error in Relax NG validation: "+c]))};this.init=function(a){N=a}};
runtime.loadClass("xmldom.RelaxNGParser");
xmldom.RelaxNG2=function(){function f(b,a){this.message=function(){a&&(b+=a.nodeType===Node.ELEMENT_NODE?" Element ":" Node ",b+=a.nodeName,a.nodeValue&&(b+=" with value '"+a.nodeValue+"'"),b+=".");return b}}function g(b,a,c,d){return"empty"===b.name?null:l(b,a,c,d)}function c(b,a){if(2!==b.e.length)throw"Element with wrong # of elements: "+b.e.length;for(var c=a.currentNode,d=c?c.nodeType:0,r=null;d>Node.ELEMENT_NODE;){if(d!==Node.COMMENT_NODE&&(d!==Node.TEXT_NODE||!/^\s+$/.test(a.currentNode.nodeValue)))return[new f("Not allowed node of type "+
d+".")];d=(c=a.nextSibling())?c.nodeType:0}if(!c)return[new f("Missing element "+b.names)];if(b.names&&-1===b.names.indexOf(q[c.namespaceURI]+":"+c.localName))return[new f("Found "+c.nodeName+" instead of "+b.names+".",c)];if(a.firstChild()){for(r=g(b.e[1],a,c);a.nextSibling();)if(d=a.currentNode.nodeType,!(a.currentNode&&a.currentNode.nodeType===Node.TEXT_NODE&&/^\s+$/.test(a.currentNode.nodeValue)||d===Node.COMMENT_NODE))return[new f("Spurious content.",a.currentNode)];if(a.parentNode()!==c)return[new f("Implementation error.")]}else r=
g(b.e[1],a,c);a.nextSibling();return r}var m,l,q;l=function(b,a,e,d){var r=b.name,h=null;if("text"===r)a:{for(var p=(b=a.currentNode)?b.nodeType:0;b!==e&&3!==p;){if(1===p){h=[new f("Element not allowed here.",b)];break a}p=(b=a.nextSibling())?b.nodeType:0}a.nextSibling();h=null}else if("data"===r)h=null;else if("value"===r)d!==b.text&&(h=[new f("Wrong value, should be '"+b.text+"', not '"+d+"'",e)]);else if("list"===r)h=null;else if("attribute"===r)a:{if(2!==b.e.length)throw"Attribute with wrong # of elements: "+
b.e.length;r=b.localnames.length;for(h=0;h<r;h+=1){d=e.getAttributeNS(b.namespaces[h],b.localnames[h]);""!==d||e.hasAttributeNS(b.namespaces[h],b.localnames[h])||(d=void 0);if(void 0!==p&&void 0!==d){h=[new f("Attribute defined too often.",e)];break a}p=d}h=void 0===p?[new f("Attribute not found: "+b.names,e)]:g(b.e[1],a,e,p)}else if("element"===r)h=c(b,a);else if("oneOrMore"===r){d=0;do p=a.currentNode,r=l(b.e[0],a,e),d+=1;while(!r&&p!==a.currentNode);1<d?(a.currentNode=p,h=null):h=r}else if("choice"===
r){if(2!==b.e.length)throw"Choice with wrong # of options: "+b.e.length;p=a.currentNode;if("empty"===b.e[0].name){if(r=l(b.e[1],a,e,d))a.currentNode=p;h=null}else{if(r=g(b.e[0],a,e,d))a.currentNode=p,r=l(b.e[1],a,e,d);h=r}}else if("group"===r){if(2!==b.e.length)throw"Group with wrong # of members: "+b.e.length;h=l(b.e[0],a,e)||l(b.e[1],a,e)}else if("interleave"===r)a:{p=b.e.length;d=[p];for(var k=p,n,t,q,m;0<k;){n=0;t=a.currentNode;for(h=0;h<p;h+=1)q=a.currentNode,!0!==d[h]&&d[h]!==q&&(m=b.e[h],(r=
l(m,a,e))?(a.currentNode=q,void 0===d[h]&&(d[h]=!1)):q===a.currentNode||"oneOrMore"===m.name||"choice"===m.name&&("oneOrMore"===m.e[0].name||"oneOrMore"===m.e[1].name)?(n+=1,d[h]=q):(n+=1,d[h]=!0));if(t===a.currentNode&&n===k){h=null;break a}if(0===n){for(h=0;h<p;h+=1)if(!1===d[h]){h=[new f("Interleave does not match.",e)];break a}h=null;break a}for(h=k=0;h<p;h+=1)!0!==d[h]&&(k+=1)}h=null}else throw r+" not allowed in nonEmptyPattern.";return h};this.validate=function(b,a){b.currentNode=b.root;var c=
g(m.e[0],b,b.root);a(c)};this.init=function(b,a){m=b;q=a}};
xmldom.XPathIterator=function(){};
xmldom.XPath=function(){function f(a,b,c){return-1!==a&&(a<b||-1===b)&&(a<c||-1===c)}function g(a){for(var b=[],c=0,d=a.length,e;c<d;){var g=a,l=d,q=b,m="",u=[],s=g.indexOf("[",c),C=g.indexOf("/",c),z=g.indexOf("=",c);f(C,s,z)?(m=g.substring(c,C),c=C+1):f(s,C,z)?(m=g.substring(c,s),c=r(g,s,u)):f(z,C,s)?(m=g.substring(c,z),c=z):(m=g.substring(c,l),c=l);q.push({location:m,predicates:u});if(c<d&&"="===a[c]){e=a.substring(c+1,d);if(2<e.length&&("'"===e[0]||'"'===e[0]))e=e.slice(1,e.length-1);else try{e=
parseInt(e,10)}catch(E){}c=d}}return{steps:b,value:e}}function c(){var a,b=!1;this.setNode=function(b){a=b};this.reset=function(){b=!1};this.next=function(){var c=b?null:a;b=!0;return c}}function m(a,b,c){this.reset=function(){a.reset()};this.next=function(){for(var d=a.next();d&&!(d=d.getAttributeNodeNS(b,c));)d=a.next();return d}}function l(a,b){var c=a.next(),d=null;this.reset=function(){a.reset();c=a.next();d=null};this.next=function(){for(;c;){if(d)if(b&&d.firstChild)d=d.firstChild;else{for(;!d.nextSibling&&
d!==c;)d=d.parentNode;d===c?c=a.next():d=d.nextSibling}else{do(d=c.firstChild)||(c=a.next());while(c&&!d)}if(d&&d.nodeType===Node.ELEMENT_NODE)return d}return null}}function q(a,b){this.reset=function(){a.reset()};this.next=function(){for(var c=a.next();c&&!b(c);)c=a.next();return c}}function b(a,b,c){b=b.split(":",2);var d=c(b[0]),e=b[1];return new q(a,function(a){return a.localName===e&&a.namespaceURI===d})}function a(a,b,e){var f=new c,g=d(f,b,e),r=b.value;return void 0===r?new q(a,function(a){f.setNode(a);
g.reset();return g.next()}):new q(a,function(a){f.setNode(a);g.reset();return(a=g.next())&&a.nodeValue===r})}function e(a,b,e){var f=a.ownerDocument,r=[],l=null;if(f&&f.evaluate)for(e=f.evaluate(b,a,e,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),l=e.iterateNext();null!==l;)l.nodeType===Node.ELEMENT_NODE&&r.push(l),l=e.iterateNext();else{r=new c;r.setNode(a);a=g(b);r=d(r,a,e);a=[];for(e=r.next();e;)a.push(e),e=r.next();r=a}return r}var d,r;r=function(a,b,c){for(var d=b,e=a.length,f=0;d<e;)"]"===
a[d]?(f-=1,0>=f&&c.push(g(a.substring(b,d)))):"["===a[d]&&(0>=f&&(b=d+1),f+=1),d+=1;return d};xmldom.XPathIterator.prototype.next=function(){};xmldom.XPathIterator.prototype.reset=function(){};d=function(c,d,e){var f,g,r,q;for(f=0;f<d.steps.length;f+=1)for(r=d.steps[f],g=r.location,""===g?c=new l(c,!1):"@"===g[0]?(q=g.slice(1).split(":",2),c=new m(c,e(q[0]),q[1])):"."!==g&&(c=new l(c,!1),-1!==g.indexOf(":")&&(c=b(c,g,e))),g=0;g<r.predicates.length;g+=1)q=r.predicates[g],c=a(c,q,e);return c};xmldom.XPath=
function(){this.getODFElementsWithXPath=e};return xmldom.XPath}();
gui.AnnotationViewManager=function(f,g,c){function m(a){var b=a.node,c=a.end;a=e.createRange();c&&(a.setStart(b,b.childNodes.length),a.setEnd(c,0),c=d.getTextNodes(a,!1),c.forEach(function(a){var c=e.createElement("span");c.className="annotationHighlight";c.setAttribute("annotation",b.getAttributeNS(odf.Namespaces.officens,"name"));a.parentNode.insertBefore(c,a);c.appendChild(a)}));a.detach()}function l(a){var b=f.getSizer();a?(c.style.display="inline-block",b.style.paddingRight=r.getComputedStyle(c).width):
(c.style.display="none",b.style.paddingRight=0);f.refreshSize()}function q(){a.sort(function(a,b){return a.node.compareDocumentPosition(b.node)===Node.DOCUMENT_POSITION_FOLLOWING?-1:1})}function b(){var b;for(b=0;b<a.length;b+=1){var d=a[b],k=d.node.parentNode,g=k.nextSibling,l=g.nextSibling,q=k.parentNode,m=0,y=a[a.indexOf(d)-1],x=void 0,d=d.node.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0],m=void 0,m=f.getZoomLevel();k.style.left=(c.getBoundingClientRect().left-q.getBoundingClientRect().left)/
m+"px";k.style.width=c.getBoundingClientRect().width/m+"px";g.style.width=parseFloat(k.style.left)-30+"px";y&&(x=y.node.parentNode.getBoundingClientRect(),20>=(q.getBoundingClientRect().top-x.bottom)/m?k.style.top=Math.abs(q.getBoundingClientRect().top-x.bottom)/m+20+"px":k.style.top="0px");l.style.left=g.getBoundingClientRect().width/m+"px";var g=l.style,q=l.getBoundingClientRect().left/m,y=l.getBoundingClientRect().top/m,x=k.getBoundingClientRect().left/m,u=k.getBoundingClientRect().top/m,s=0,C=
0,s=x-q,s=s*s,C=u-y,C=C*C,q=Math.sqrt(s+C);g.width=q+"px";m=Math.asin((k.getBoundingClientRect().top-l.getBoundingClientRect().top)/(m*parseFloat(l.style.width)));l.style.transform="rotate("+m+"rad)";l.style.MozTransform="rotate("+m+"rad)";l.style.WebkitTransform="rotate("+m+"rad)";l.style.msTransform="rotate("+m+"rad)";d&&(m=r.getComputedStyle(d,":before").content)&&"none"!==m&&(/^["'].*["']$/.test(m)&&(m=m.substring(1,m.length-1)),d.firstChild?d.firstChild.nodeValue=m:d.appendChild(e.createTextNode(m)))}}
var a=[],e=g.ownerDocument,d=new odf.OdfUtils,r=runtime.getWindow();runtime.assert(Boolean(r),"Expected to be run in an environment which has a global window, like a browser.");this.rerenderAnnotations=b;this.addAnnotation=function(c){l(!0);a.push({node:c.node,end:c.end});q();var d=e.createElement("div"),f=e.createElement("div"),g=e.createElement("div"),r=e.createElement("div"),w=e.createElement("div"),v=c.node;d.className="annotationWrapper";v.parentNode.insertBefore(d,v);f.className="annotationNote";
f.appendChild(v);w.className="annotationRemoveButton";f.appendChild(w);g.className="annotationConnector horizontal";r.className="annotationConnector angular";d.appendChild(f);d.appendChild(g);d.appendChild(r);c.end&&m(c);b()};this.forgetAnnotations=function(){for(;a.length;){var b=a[0],c=a.indexOf(b),d=b.node,f=d.parentNode.parentNode;"div"===f.localName&&(f.parentNode.insertBefore(d,f),f.parentNode.removeChild(f));b=b.node.getAttributeNS(odf.Namespaces.officens,"name");b=e.querySelectorAll('span.annotationHighlight[annotation="'+
b+'"]');f=d=void 0;for(d=0;d<b.length;d+=1){for(f=b[d];f.firstChild;)f.parentNode.insertBefore(f.firstChild,f);f.parentNode.removeChild(f)}-1!==c&&a.splice(c,1);0===a.length&&l(!1)}}};
odf.OdfNodeFilter=function(){this.acceptNode=function(f){return"http://www.w3.org/1999/xhtml"===f.namespaceURI?NodeFilter.FILTER_SKIP:f.namespaceURI&&f.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};
odf.Namespaces=function(){function f(c){return g[c]||null}var g={db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",
office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},c;f.lookupNamespaceURI=f;c=function(){};c.forEachPrefix=function(c){for(var f in g)g.hasOwnProperty(f)&&
c(f,g[f])};c.resolvePrefix=f;c.namespaceMap=g;c.dbns="urn:oasis:names:tc:opendocument:xmlns:database:1.0";c.dcns="http://purl.org/dc/elements/1.1/";c.dr3dns="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0";c.drawns="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0";c.chartns="urn:oasis:names:tc:opendocument:xmlns:chart:1.0";c.fons="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0";c.formns="urn:oasis:names:tc:opendocument:xmlns:form:1.0";c.numberns="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0";
c.officens="urn:oasis:names:tc:opendocument:xmlns:office:1.0";c.presentationns="urn:oasis:names:tc:opendocument:xmlns:presentation:1.0";c.stylens="urn:oasis:names:tc:opendocument:xmlns:style:1.0";c.svgns="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0";c.tablens="urn:oasis:names:tc:opendocument:xmlns:table:1.0";c.textns="urn:oasis:names:tc:opendocument:xmlns:text:1.0";c.xlinkns="http://www.w3.org/1999/xlink";c.xmlns="http://www.w3.org/XML/1998/namespace";return c}();
runtime.loadClass("xmldom.XPath");runtime.loadClass("odf.Namespaces");
odf.StyleInfo=function(){function f(a,b){for(var c=z[a.localName],d=c&&c[a.namespaceURI],e=d?d.length:0,h,c=0;c<e;c+=1)(h=a.getAttributeNS(d[c].ns,d[c].localname))&&a.setAttributeNS(d[c].ns,C[d[c].ns]+d[c].localname,b+h);for(c=a.firstChild;c;)c.nodeType===Node.ELEMENT_NODE&&(d=c,f(d,b)),c=c.nextSibling}function g(a,b){for(var c=z[a.localName],d=c&&c[a.namespaceURI],e=d?d.length:0,f,c=0;c<e;c+=1)if(f=a.getAttributeNS(d[c].ns,d[c].localname))f=f.replace(b,""),a.setAttributeNS(d[c].ns,C[d[c].ns]+d[c].localname,
f);for(c=a.firstChild;c;)c.nodeType===Node.ELEMENT_NODE&&(d=c,g(d,b)),c=c.nextSibling}function c(a,b){var c=z[a.localName],d=(c=c&&c[a.namespaceURI])?c.length:0,e,f,h;for(h=0;h<d;h+=1)if(e=a.getAttributeNS(c[h].ns,c[h].localname))b=b||{},f=c[h].keyname,f=b[f]=b[f]||{},f[e]=1;return b}function m(a,b){var d,e;c(a,b);for(d=a.firstChild;d;)d.nodeType===Node.ELEMENT_NODE&&(e=d,m(e,b)),d=d.nextSibling}function l(a,b,c){this.key=a;this.name=b;this.family=c;this.requires={}}function q(a,b,c){var d=a+'"'+
b,e=c[d];e||(e=c[d]=new l(d,a,b));return e}function b(a,c,d){var e=z[a.localName],f=(e=e&&e[a.namespaceURI])?e.length:0,h=a.getAttributeNS(x,"name"),k=a.getAttributeNS(x,"family"),g;h&&k&&(c=q(h,k,d));if(c)for(h=0;h<f;h+=1)if(k=a.getAttributeNS(e[h].ns,e[h].localname))g=e[h].keyname,k=q(k,g,d),c.requires[k.key]=k;for(h=a.firstChild;h;)h.nodeType===Node.ELEMENT_NODE&&(a=h,b(a,c,d)),h=h.nextSibling;return d}function a(b,c){var d=c[b.family];d||(d=c[b.family]={});d[b.name]=1;Object.keys(b.requires).forEach(function(d){a(b.requires[d],
c)})}function e(c,d){var e=b(c,null,{});Object.keys(e).forEach(function(b){b=e[b];var c=d[b.family];c&&c.hasOwnProperty(b.name)&&a(b,d)})}function d(a,b){function c(b){(b=f.getAttributeNS(x,b))&&(a[b]=!0)}var e=["font-name","font-name-asian","font-name-complex"],f;if(b)for(f=b.firstChild;f;)f.nodeType===Node.ELEMENT_NODE&&(e.forEach(c),d(a,f)),f=f.nextSibling}function r(a,b){function c(a){var d=e.getAttributeNS(x,a);d&&b.hasOwnProperty(d)&&e.setAttributeNS(x,"style:"+a,b[d])}var d=["font-name","font-name-asian",
"font-name-complex"],e;if(a)for(e=a.firstChild;e;)e.nodeType===Node.ELEMENT_NODE&&(d.forEach(c),r(e,b)),e=e.nextSibling}var h=odf.Namespaces.chartns,p=odf.Namespaces.dbns,k=odf.Namespaces.dr3dns,n=odf.Namespaces.drawns,t=odf.Namespaces.formns,w=odf.Namespaces.numberns,v=odf.Namespaces.officens,y=odf.Namespaces.presentationns,x=odf.Namespaces.stylens,u=odf.Namespaces.tablens,s=odf.Namespaces.textns,C={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:",
"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:",
"urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},h={text:[{ens:x,en:"tab-stop",ans:x,a:"leader-text-style"},{ens:x,en:"drop-cap",ans:x,a:"style-name"},{ens:s,en:"notes-configuration",ans:s,a:"citation-body-style-name"},{ens:s,en:"notes-configuration",ans:s,a:"citation-style-name"},{ens:s,en:"a",ans:s,a:"style-name"},{ens:s,en:"alphabetical-index",ans:s,a:"style-name"},{ens:s,en:"linenumbering-configuration",
ans:s,a:"style-name"},{ens:s,en:"list-level-style-number",ans:s,a:"style-name"},{ens:s,en:"ruby-text",ans:s,a:"style-name"},{ens:s,en:"span",ans:s,a:"style-name"},{ens:s,en:"a",ans:s,a:"visited-style-name"},{ens:x,en:"text-properties",ans:x,a:"text-line-through-text-style"},{ens:s,en:"alphabetical-index-source",ans:s,a:"main-entry-style-name"},{ens:s,en:"index-entry-bibliography",ans:s,a:"style-name"},{ens:s,en:"index-entry-chapter",ans:s,a:"style-name"},{ens:s,en:"index-entry-link-end",ans:s,a:"style-name"},
{ens:s,en:"index-entry-link-start",ans:s,a:"style-name"},{ens:s,en:"index-entry-page-number",ans:s,a:"style-name"},{ens:s,en:"index-entry-span",ans:s,a:"style-name"},{ens:s,en:"index-entry-tab-stop",ans:s,a:"style-name"},{ens:s,en:"index-entry-text",ans:s,a:"style-name"},{ens:s,en:"index-title-template",ans:s,a:"style-name"},{ens:s,en:"list-level-style-bullet",ans:s,a:"style-name"},{ens:s,en:"outline-level-style",ans:s,a:"style-name"}],paragraph:[{ens:n,en:"caption",ans:n,a:"text-style-name"},{ens:n,
en:"circle",ans:n,a:"text-style-name"},{ens:n,en:"connector",ans:n,a:"text-style-name"},{ens:n,en:"control",ans:n,a:"text-style-name"},{ens:n,en:"custom-shape",ans:n,a:"text-style-name"},{ens:n,en:"ellipse",ans:n,a:"text-style-name"},{ens:n,en:"frame",ans:n,a:"text-style-name"},{ens:n,en:"line",ans:n,a:"text-style-name"},{ens:n,en:"measure",ans:n,a:"text-style-name"},{ens:n,en:"path",ans:n,a:"text-style-name"},{ens:n,en:"polygon",ans:n,a:"text-style-name"},{ens:n,en:"polyline",ans:n,a:"text-style-name"},
{ens:n,en:"rect",ans:n,a:"text-style-name"},{ens:n,en:"regular-polygon",ans:n,a:"text-style-name"},{ens:v,en:"annotation",ans:n,a:"text-style-name"},{ens:t,en:"column",ans:t,a:"text-style-name"},{ens:x,en:"style",ans:x,a:"next-style-name"},{ens:u,en:"body",ans:u,a:"paragraph-style-name"},{ens:u,en:"even-columns",ans:u,a:"paragraph-style-name"},{ens:u,en:"even-rows",ans:u,a:"paragraph-style-name"},{ens:u,en:"first-column",ans:u,a:"paragraph-style-name"},{ens:u,en:"first-row",ans:u,a:"paragraph-style-name"},
{ens:u,en:"last-column",ans:u,a:"paragraph-style-name"},{ens:u,en:"last-row",ans:u,a:"paragraph-style-name"},{ens:u,en:"odd-columns",ans:u,a:"paragraph-style-name"},{ens:u,en:"odd-rows",ans:u,a:"paragraph-style-name"},{ens:s,en:"notes-configuration",ans:s,a:"default-style-name"},{ens:s,en:"alphabetical-index-entry-template",ans:s,a:"style-name"},{ens:s,en:"bibliography-entry-template",ans:s,a:"style-name"},{ens:s,en:"h",ans:s,a:"style-name"},{ens:s,en:"illustration-index-entry-template",ans:s,a:"style-name"},
{ens:s,en:"index-source-style",ans:s,a:"style-name"},{ens:s,en:"object-index-entry-template",ans:s,a:"style-name"},{ens:s,en:"p",ans:s,a:"style-name"},{ens:s,en:"table-index-entry-template",ans:s,a:"style-name"},{ens:s,en:"table-of-content-entry-template",ans:s,a:"style-name"},{ens:s,en:"table-index-entry-template",ans:s,a:"style-name"},{ens:s,en:"user-index-entry-template",ans:s,a:"style-name"},{ens:x,en:"page-layout-properties",ans:x,a:"register-truth-ref-style-name"}],chart:[{ens:h,en:"axis",ans:h,
a:"style-name"},{ens:h,en:"chart",ans:h,a:"style-name"},{ens:h,en:"data-label",ans:h,a:"style-name"},{ens:h,en:"data-point",ans:h,a:"style-name"},{ens:h,en:"equation",ans:h,a:"style-name"},{ens:h,en:"error-indicator",ans:h,a:"style-name"},{ens:h,en:"floor",ans:h,a:"style-name"},{ens:h,en:"footer",ans:h,a:"style-name"},{ens:h,en:"grid",ans:h,a:"style-name"},{ens:h,en:"legend",ans:h,a:"style-name"},{ens:h,en:"mean-value",ans:h,a:"style-name"},{ens:h,en:"plot-area",ans:h,a:"style-name"},{ens:h,en:"regression-curve",
ans:h,a:"style-name"},{ens:h,en:"series",ans:h,a:"style-name"},{ens:h,en:"stock-gain-marker",ans:h,a:"style-name"},{ens:h,en:"stock-loss-marker",ans:h,a:"style-name"},{ens:h,en:"stock-range-line",ans:h,a:"style-name"},{ens:h,en:"subtitle",ans:h,a:"style-name"},{ens:h,en:"title",ans:h,a:"style-name"},{ens:h,en:"wall",ans:h,a:"style-name"}],section:[{ens:s,en:"alphabetical-index",ans:s,a:"style-name"},{ens:s,en:"bibliography",ans:s,a:"style-name"},{ens:s,en:"illustration-index",ans:s,a:"style-name"},
{ens:s,en:"index-title",ans:s,a:"style-name"},{ens:s,en:"object-index",ans:s,a:"style-name"},{ens:s,en:"section",ans:s,a:"style-name"},{ens:s,en:"table-of-content",ans:s,a:"style-name"},{ens:s,en:"table-index",ans:s,a:"style-name"},{ens:s,en:"user-index",ans:s,a:"style-name"}],ruby:[{ens:s,en:"ruby",ans:s,a:"style-name"}],table:[{ens:p,en:"query",ans:p,a:"style-name"},{ens:p,en:"table-representation",ans:p,a:"style-name"},{ens:u,en:"background",ans:u,a:"style-name"},{ens:u,en:"table",ans:u,a:"style-name"}],
"table-column":[{ens:p,en:"column",ans:p,a:"style-name"},{ens:u,en:"table-column",ans:u,a:"style-name"}],"table-row":[{ens:p,en:"query",ans:p,a:"default-row-style-name"},{ens:p,en:"table-representation",ans:p,a:"default-row-style-name"},{ens:u,en:"table-row",ans:u,a:"style-name"}],"table-cell":[{ens:p,en:"column",ans:p,a:"default-cell-style-name"},{ens:u,en:"table-column",ans:u,a:"default-cell-style-name"},{ens:u,en:"table-row",ans:u,a:"default-cell-style-name"},{ens:u,en:"body",ans:u,a:"style-name"},
{ens:u,en:"covered-table-cell",ans:u,a:"style-name"},{ens:u,en:"even-columns",ans:u,a:"style-name"},{ens:u,en:"covered-table-cell",ans:u,a:"style-name"},{ens:u,en:"even-columns",ans:u,a:"style-name"},{ens:u,en:"even-rows",ans:u,a:"style-name"},{ens:u,en:"first-column",ans:u,a:"style-name"},{ens:u,en:"first-row",ans:u,a:"style-name"},{ens:u,en:"last-column",ans:u,a:"style-name"},{ens:u,en:"last-row",ans:u,a:"style-name"},{ens:u,en:"odd-columns",ans:u,a:"style-name"},{ens:u,en:"odd-rows",ans:u,a:"style-name"},
{ens:u,en:"table-cell",ans:u,a:"style-name"}],graphic:[{ens:k,en:"cube",ans:n,a:"style-name"},{ens:k,en:"extrude",ans:n,a:"style-name"},{ens:k,en:"rotate",ans:n,a:"style-name"},{ens:k,en:"scene",ans:n,a:"style-name"},{ens:k,en:"sphere",ans:n,a:"style-name"},{ens:n,en:"caption",ans:n,a:"style-name"},{ens:n,en:"circle",ans:n,a:"style-name"},{ens:n,en:"connector",ans:n,a:"style-name"},{ens:n,en:"control",ans:n,a:"style-name"},{ens:n,en:"custom-shape",ans:n,a:"style-name"},{ens:n,en:"ellipse",ans:n,a:"style-name"},
{ens:n,en:"frame",ans:n,a:"style-name"},{ens:n,en:"g",ans:n,a:"style-name"},{ens:n,en:"line",ans:n,a:"style-name"},{ens:n,en:"measure",ans:n,a:"style-name"},{ens:n,en:"page-thumbnail",ans:n,a:"style-name"},{ens:n,en:"path",ans:n,a:"style-name"},{ens:n,en:"polygon",ans:n,a:"style-name"},{ens:n,en:"polyline",ans:n,a:"style-name"},{ens:n,en:"rect",ans:n,a:"style-name"},{ens:n,en:"regular-polygon",ans:n,a:"style-name"},{ens:v,en:"annotation",ans:n,a:"style-name"}],presentation:[{ens:k,en:"cube",ans:y,
a:"style-name"},{ens:k,en:"extrude",ans:y,a:"style-name"},{ens:k,en:"rotate",ans:y,a:"style-name"},{ens:k,en:"scene",ans:y,a:"style-name"},{ens:k,en:"sphere",ans:y,a:"style-name"},{ens:n,en:"caption",ans:y,a:"style-name"},{ens:n,en:"circle",ans:y,a:"style-name"},{ens:n,en:"connector",ans:y,a:"style-name"},{ens:n,en:"control",ans:y,a:"style-name"},{ens:n,en:"custom-shape",ans:y,a:"style-name"},{ens:n,en:"ellipse",ans:y,a:"style-name"},{ens:n,en:"frame",ans:y,a:"style-name"},{ens:n,en:"g",ans:y,a:"style-name"},
{ens:n,en:"line",ans:y,a:"style-name"},{ens:n,en:"measure",ans:y,a:"style-name"},{ens:n,en:"page-thumbnail",ans:y,a:"style-name"},{ens:n,en:"path",ans:y,a:"style-name"},{ens:n,en:"polygon",ans:y,a:"style-name"},{ens:n,en:"polyline",ans:y,a:"style-name"},{ens:n,en:"rect",ans:y,a:"style-name"},{ens:n,en:"regular-polygon",ans:y,a:"style-name"},{ens:v,en:"annotation",ans:y,a:"style-name"}],"drawing-page":[{ens:n,en:"page",ans:n,a:"style-name"},{ens:y,en:"notes",ans:n,a:"style-name"},{ens:x,en:"handout-master",
ans:n,a:"style-name"},{ens:x,en:"master-page",ans:n,a:"style-name"}],"list-style":[{ens:s,en:"list",ans:s,a:"style-name"},{ens:s,en:"numbered-paragraph",ans:s,a:"style-name"},{ens:s,en:"list-item",ans:s,a:"style-override"},{ens:x,en:"style",ans:x,a:"list-style-name"}],data:[{ens:x,en:"style",ans:x,a:"data-style-name"},{ens:x,en:"style",ans:x,a:"percentage-data-style-name"},{ens:y,en:"date-time-decl",ans:x,a:"data-style-name"},{ens:s,en:"creation-date",ans:x,a:"data-style-name"},{ens:s,en:"creation-time",
ans:x,a:"data-style-name"},{ens:s,en:"database-display",ans:x,a:"data-style-name"},{ens:s,en:"date",ans:x,a:"data-style-name"},{ens:s,en:"editing-duration",ans:x,a:"data-style-name"},{ens:s,en:"expression",ans:x,a:"data-style-name"},{ens:s,en:"meta-field",ans:x,a:"data-style-name"},{ens:s,en:"modification-date",ans:x,a:"data-style-name"},{ens:s,en:"modification-time",ans:x,a:"data-style-name"},{ens:s,en:"print-date",ans:x,a:"data-style-name"},{ens:s,en:"print-time",ans:x,a:"data-style-name"},{ens:s,
en:"table-formula",ans:x,a:"data-style-name"},{ens:s,en:"time",ans:x,a:"data-style-name"},{ens:s,en:"user-defined",ans:x,a:"data-style-name"},{ens:s,en:"user-field-get",ans:x,a:"data-style-name"},{ens:s,en:"user-field-input",ans:x,a:"data-style-name"},{ens:s,en:"variable-get",ans:x,a:"data-style-name"},{ens:s,en:"variable-input",ans:x,a:"data-style-name"},{ens:s,en:"variable-set",ans:x,a:"data-style-name"}],"page-layout":[{ens:y,en:"notes",ans:x,a:"page-layout-name"},{ens:x,en:"handout-master",ans:x,
a:"page-layout-name"},{ens:x,en:"master-page",ans:x,a:"page-layout-name"}]},z,E=new xmldom.XPath;this.collectUsedFontFaces=d;this.changeFontFaceNames=r;this.UsedStyleList=function(a,b){var c={};this.uses=function(a){var b=a.localName,d=a.getAttributeNS(n,"name")||a.getAttributeNS(x,"name");a="style"===b?a.getAttributeNS(x,"family"):a.namespaceURI===w?"data":b;return(a=c[a])?0<a[d]:!1};m(a,c);b&&e(b,c)};this.hasDerivedStyles=function(a,b,c){var d=b("style"),e=c.getAttributeNS(d,"name");c=c.getAttributeNS(d,
"family");return E.getODFElementsWithXPath(a,"//style:*[@style:parent-style-name='"+e+"'][@style:family='"+c+"']",b).length?!0:!1};this.prefixStyleNames=function(a,b,c){var d;if(a){for(d=a.firstChild;d;){if(d.nodeType===Node.ELEMENT_NODE){var e=d,h=b,k=e.getAttributeNS(n,"name"),g=void 0;k?g=n:(k=e.getAttributeNS(x,"name"))&&(g=x);g&&e.setAttributeNS(g,C[g]+"name",h+k)}d=d.nextSibling}f(a,b);c&&f(c,b)}};this.removePrefixFromStyleNames=function(a,b,c){var d=RegExp("^"+b);if(a){for(b=a.firstChild;b;){if(b.nodeType===
Node.ELEMENT_NODE){var e=b,f=d,h=e.getAttributeNS(n,"name"),k=void 0;h?k=n:(h=e.getAttributeNS(x,"name"))&&(k=x);k&&(h=h.replace(f,""),e.setAttributeNS(k,C[k]+"name",h))}b=b.nextSibling}g(a,d);c&&g(c,d)}};this.determineStylesForNode=c;z=function(a){var b,c,d,e,f,h={},k;for(b in a)if(a.hasOwnProperty(b))for(e=a[b],d=e.length,c=0;c<d;c+=1)f=e[c],k=h[f.en]=h[f.en]||{},k=k[f.ens]=k[f.ens]||[],k.push({ns:f.ans,localname:f.a,keyname:b});return h}(h)};
runtime.loadClass("core.DomUtils");runtime.loadClass("odf.Namespaces");
odf.OdfUtils=function(){function f(a){return"image"===(a&&a.localName)&&a.namespaceURI===u}function g(a){return"frame"===(a&&a.localName)&&a.namespaceURI===u&&"as-char"===a.getAttributeNS(x,"anchor-type")}function c(a){var b=a&&a.localName;return("p"===b||"h"===b)&&a.namespaceURI===x}function m(a){for(;a&&!c(a);)a=a.parentNode;return a}function l(a){return/^[ \t\r\n]+$/.test(a)}function q(a){var b=a&&a.localName;return/^(span|p|h|a|meta)$/.test(b)&&a.namespaceURI===x||"span"===b&&"annotationHighlight"===
a.className?!0:!1}function b(a){var b=a&&a.localName,c;c=!1;b&&(c=a.namespaceURI,c=c===x?"s"===b||"tab"===b||"line-break"===b:g(a));return c}function a(a){for(;null!==a.firstChild&&q(a);)a=a.firstChild;return a}function e(a){for(;null!==a.lastChild&&q(a);)a=a.lastChild;return a}function d(a){for(;!c(a)&&null===a.previousSibling;)a=a.parentNode;return c(a)?null:e(a.previousSibling)}function r(b){for(;!c(b)&&null===b.nextSibling;)b=b.parentNode;return c(b)?null:a(b.nextSibling)}function h(a){for(var c=
!1;a;)if(a.nodeType===Node.TEXT_NODE)if(0===a.length)a=d(a);else return!l(a.data.substr(a.length-1,1));else b(a)?(c=!0,a=null):a=d(a);return c}function p(c){var d=!1;for(c=c&&a(c);c;){if(c.nodeType===Node.TEXT_NODE&&0<c.length&&!l(c.data)){d=!0;break}if(b(c)){d=!0;break}c=r(c)}return d}function k(a,b){return l(a.data.substr(b))?!p(r(a)):!1}function n(a,c){var e=a.data,f;if(!l(e[c])||b(a.parentNode))return!1;0<c?l(e[c-1])||(f=!0):h(d(a))&&(f=!0);return!0===f?k(a,c)?!1:!0:!1}function t(a){return(a=
/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(a))?{value:parseFloat(a[1]),unit:a[3]}:null}function w(a){return(a=t(a))&&(0>a.value||"%"===a.unit)?null:a}function v(a){return(a=t(a))&&"%"!==a.unit?null:a}function y(a){switch(a.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(a.localName){case "note-body":case "ruby-text":return!1}break;case odf.Namespaces.officens:switch(a.localName){case "annotation":case "binary-data":case "event-listeners":return!1}break;
default:switch(a.localName){case "editinfo":return!1}}return!0}var x=odf.Namespaces.textns,u=odf.Namespaces.drawns,s=/^\s*$/,C=new core.DomUtils;this.isImage=f;this.isCharacterFrame=g;this.isTextSpan=function(a){return"span"===(a&&a.localName)&&a.namespaceURI===x};this.isParagraph=c;this.getParagraphElement=m;this.isWithinTrackedChanges=function(a,b){for(;a&&a!==b;){if(a.namespaceURI===x&&"tracked-changes"===a.localName)return!0;a=a.parentNode}return!1};this.isListItem=function(a){return"list-item"===
(a&&a.localName)&&a.namespaceURI===x};this.isLineBreak=function(a){return"line-break"===(a&&a.localName)&&a.namespaceURI===x};this.isODFWhitespace=l;this.isGroupingElement=q;this.isCharacterElement=b;this.firstChild=a;this.lastChild=e;this.previousNode=d;this.nextNode=r;this.scanLeftForNonWhitespace=h;this.lookLeftForCharacter=function(a){var c;c=0;a.nodeType===Node.TEXT_NODE&&0<a.length?(c=a.data,c=l(c.substr(c.length-1,1))?1===c.length?h(d(a))?2:0:l(c.substr(c.length-2,1))?0:2:1):b(a)&&(c=1);return c};
this.lookRightForCharacter=function(a){var c=!1;a&&a.nodeType===Node.TEXT_NODE&&0<a.length?c=!l(a.data.substr(0,1)):b(a)&&(c=!0);return c};this.scanLeftForAnyCharacter=function(a){var c=!1;for(a=a&&e(a);a;){if(a.nodeType===Node.TEXT_NODE&&0<a.length&&!l(a.data)){c=!0;break}if(b(a)){c=!0;break}a=d(a)}return c};this.scanRightForAnyCharacter=p;this.isTrailingWhitespace=k;this.isSignificantWhitespace=n;this.isDowngradableSpaceElement=function(a){return a.namespaceURI===x&&"s"===a.localName?h(d(a))&&p(r(a)):
!1};this.getFirstNonWhitespaceChild=function(a){for(a=a&&a.firstChild;a&&a.nodeType===Node.TEXT_NODE&&s.test(a.nodeValue);)a=a.nextSibling;return a};this.parseLength=t;this.parseNonNegativeLength=w;this.parseFoFontSize=function(a){var b;b=(b=t(a))&&(0>=b.value||"%"===b.unit)?null:b;return b||v(a)};this.parseFoLineHeight=function(a){return w(a)||v(a)};this.getImpactedParagraphs=function(a){var b=a.commonAncestorContainer,d=[];for(b.nodeType===Node.ELEMENT_NODE&&(d=C.getElementsByTagNameNS(b,x,"p").concat(C.getElementsByTagNameNS(b,
x,"h")));b&&!c(b);)b=b.parentNode;b&&d.push(b);return d.filter(function(b){return C.rangeIntersectsNode(a,b)})};this.getTextNodes=function(a,b){var c=a.startContainer.ownerDocument.createRange(),d;d=C.getNodesInRange(a,function(d){c.selectNodeContents(d);if(d.nodeType===Node.TEXT_NODE){if(b&&C.rangesIntersect(a,c)||C.containsRange(a,c))return Boolean(m(d)&&(!l(d.textContent)||n(d,0)))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}else if(C.rangesIntersect(a,c)&&y(d))return NodeFilter.FILTER_SKIP;
return NodeFilter.FILTER_REJECT});c.detach();return d};this.getTextElements=function(a,c){var d=a.startContainer.ownerDocument.createRange(),e;e=C.getNodesInRange(a,function(e){d.selectNodeContents(e);if(b(e.parentNode))return NodeFilter.FILTER_REJECT;if(e.nodeType===Node.TEXT_NODE){if(C.containsRange(a,d)&&(c||Boolean(m(e)&&(!l(e.textContent)||n(e,0)))))return NodeFilter.FILTER_ACCEPT}else if(b(e)){if(C.containsRange(a,d))return NodeFilter.FILTER_ACCEPT}else if(y(e)||q(e))return NodeFilter.FILTER_SKIP;
return NodeFilter.FILTER_REJECT});d.detach();return e};this.getParagraphElements=function(a){var b=a.startContainer.ownerDocument.createRange(),d;d=C.getNodesInRange(a,function(d){b.selectNodeContents(d);if(c(d)){if(C.rangesIntersect(a,b))return NodeFilter.FILTER_ACCEPT}else if(y(d)||q(d))return NodeFilter.FILTER_SKIP;return NodeFilter.FILTER_REJECT});b.detach();return d};this.getImageElements=function(a){var b=a.startContainer.ownerDocument.createRange(),c;c=C.getNodesInRange(a,function(c){b.selectNodeContents(c);
return f(c)&&C.containsRange(a,b)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});b.detach();return c}};
runtime.loadClass("odf.OdfUtils");
odf.TextSerializer=function(){function f(m){var l="",q=g.filter?g.filter.acceptNode(m):NodeFilter.FILTER_ACCEPT,b=m.nodeType,a;if(q===NodeFilter.FILTER_ACCEPT||q===NodeFilter.FILTER_SKIP)for(a=m.firstChild;a;)l+=f(a),a=a.nextSibling;q===NodeFilter.FILTER_ACCEPT&&(b===Node.ELEMENT_NODE&&c.isParagraph(m)?l+="\n":b===Node.TEXT_NODE&&m.textContent&&(l+=m.textContent));return l}var g=this,c=new odf.OdfUtils;this.filter=null;this.writeToString=function(c){return c?f(c):""}};
runtime.loadClass("core.DomUtils");runtime.loadClass("core.LoopWatchDog");runtime.loadClass("odf.Namespaces");
odf.TextStyleApplicator=function(f,g,c){function m(a){function b(a,c){return"object"===typeof a&&"object"===typeof c?Object.keys(a).every(function(d){return b(a[d],c[d])}):a===c}this.isStyleApplied=function(c){c=g.getAppliedStylesForElement(c);return b(a,c)}}function l(b){var r={};this.applyStyleToContainer=function(h){var p;p=h.getAttributeNS(a,"style-name");var k=h.ownerDocument;p=p||"";if(!r.hasOwnProperty(p)){var n=p,l;l=p?g.createDerivedStyleObject(p,"text",b):b;k=k.createElementNS(e,"style:style");
g.updateStyle(k,l);k.setAttributeNS(e,"style:name",f.generateStyleName());k.setAttributeNS(e,"style:family","text");k.setAttributeNS("urn:webodf:names:scope","scope","document-content");c.appendChild(k);r[n]=k}p=r[p].getAttributeNS(e,"name");h.setAttributeNS(a,"text:style-name",p)}}function q(c,e){var f=c.ownerDocument,g=c.parentNode,k,n,l=new core.LoopWatchDog(1E3);n=[];"span"!==g.localName||g.namespaceURI!==a?(k=f.createElementNS(a,"text:span"),g.insertBefore(k,c),g=!1):(c.previousSibling&&!b.rangeContainsNode(e,
g.firstChild)?(k=g.cloneNode(!1),g.parentNode.insertBefore(k,g.nextSibling)):k=g,g=!0);n.push(c);for(f=c.nextSibling;f&&b.rangeContainsNode(e,f);)l.check(),n.push(f),f=f.nextSibling;n.forEach(function(a){a.parentNode!==k&&k.appendChild(a)});if(f&&g)for(n=k.cloneNode(!1),k.parentNode.insertBefore(n,k.nextSibling);f;)l.check(),g=f.nextSibling,n.appendChild(f),f=g;return k}var b=new core.DomUtils,a=odf.Namespaces.textns,e=odf.Namespaces.stylens;this.applyStyle=function(a,b,c){var e={},f,g,t,w;runtime.assert(c&&
c["style:text-properties"],"applyStyle without any text properties");e["style:text-properties"]=c["style:text-properties"];t=new l(e);w=new m(e);a.forEach(function(a){f=w.isStyleApplied(a);!1===f&&(g=q(a,b),t.applyStyleToContainer(g))})}};
runtime.loadClass("odf.Namespaces");runtime.loadClass("odf.OdfUtils");runtime.loadClass("xmldom.XPath");runtime.loadClass("core.CSSUnits");
odf.Style2CSS=function(){function f(a){var b={},c,d;if(!a)return b;for(a=a.firstChild;a;){if(d=a.namespaceURI!==n||"style"!==a.localName&&"default-style"!==a.localName?a.namespaceURI===v&&"list-style"===a.localName?"list":a.namespaceURI!==n||"page-layout"!==a.localName&&"default-page-layout"!==a.localName?void 0:"page":a.getAttributeNS(n,"family"))(c=a.getAttributeNS&&a.getAttributeNS(n,"name"))||(c=""),d=b[d]=b[d]||{},d[c]=a;a=a.nextSibling}return b}function g(a,b){if(!b||!a)return null;if(a[b])return a[b];
var c,d;for(c in a)if(a.hasOwnProperty(c)&&(d=g(a[c].derivedStyles,b)))return d;return null}function c(a,b,d){var e=b[a],f,h;e&&(f=e.getAttributeNS(n,"parent-style-name"),h=null,f&&(h=g(d,f),!h&&b[f]&&(c(f,b,d),h=b[f],b[f]=null)),h?(h.derivedStyles||(h.derivedStyles={}),h.derivedStyles[a]=e):d[a]=e)}function m(a,b){for(var d in a)a.hasOwnProperty(d)&&(c(d,a,b),a[d]=null)}function l(a,b){var c=u[a],d;if(null===c)return null;d=b?"["+c+'|style-name="'+b+'"]':"";"presentation"===c&&(c="draw",d=b?'[presentation|style-name="'+
b+'"]':"");return c+"|"+s[a].join(d+","+c+"|")+d}function q(a,b,c){var d=[],e,f;d.push(l(a,b));for(e in c.derivedStyles)if(c.derivedStyles.hasOwnProperty(e))for(f in b=q(a,e,c.derivedStyles[e]),b)b.hasOwnProperty(f)&&d.push(b[f]);return d}function b(a,b,c){if(!a)return null;for(a=a.firstChild;a;){if(a.namespaceURI===b&&a.localName===c)return b=a;a=a.nextSibling}return null}function a(a,b){var c="",d,e;for(d in b)if(b.hasOwnProperty(d)&&(d=b[d],e=a.getAttributeNS(d[0],d[1]))){e=e.trim();if(S.hasOwnProperty(d[1])){var f=
e.indexOf(" "),h=void 0,g=void 0;-1!==f?(h=e.substring(0,f),g=e.substring(f)):(h=e,g="");(h=aa.parseLength(h))&&"pt"===h.unit&&0.75>h.value&&(e="0.75pt"+g)}d[2]&&(c+=d[2]+":"+e+";")}return c}function e(a){return(a=b(a,n,"text-properties"))?aa.parseFoFontSize(a.getAttributeNS(k,"font-size")):null}function d(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,c,d){return b+b+c+c+d+d});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],
16)}:null}function r(a,b,c,d){b='text|list[text|style-name="'+b+'"]';var e=c.getAttributeNS(v,"level"),f;c=aa.getFirstNonWhitespaceChild(c);c=aa.getFirstNonWhitespaceChild(c);var h;c&&(f=c.attributes,h=f["fo:text-indent"]?f["fo:text-indent"].value:void 0,f=f["fo:margin-left"]?f["fo:margin-left"].value:void 0);h||(h="-0.6cm");c="-"===h.charAt(0)?h.substring(1):"-"+h;for(e=e&&parseInt(e,10);1<e;)b+=" > text|list-item > text|list",e-=1;e=b+" > text|list-item > *:not(text|list):first-child";void 0!==
f&&(f=e+"{margin-left:"+f+";}",a.insertRule(f,a.cssRules.length));d=b+" > text|list-item > *:not(text|list):first-child:before{"+d+";";d+="counter-increment:list;";d+="margin-left:"+h+";";d+="width:"+c+";";d+="display:inline-block}";try{a.insertRule(d,a.cssRules.length)}catch(g){throw g;}}function h(c,f,g,s){if("list"===f)for(var l=s.firstChild,m,t;l;){if(l.namespaceURI===v)if(m=l,"list-level-style-number"===l.localName){var u=m;t=u.getAttributeNS(n,"num-format");var Q=u.getAttributeNS(n,"num-suffix"),
L={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"},u=u.getAttributeNS(n,"num-prefix")||"",u=L.hasOwnProperty(t)?u+(" counter(list, "+L[t]+")"):t?u+("'"+t+"';"):u+" ''";Q&&(u+=" '"+Q+"'");t="content: "+u+";";r(c,g,m,t)}else"list-level-style-image"===l.localName?(t="content: none;",r(c,g,m,t)):"list-level-style-bullet"===l.localName&&(t="content: '"+m.getAttributeNS(v,"bullet-char")+"';",r(c,g,m,t));l=l.nextSibling}else if("page"===f)if(Q=m=g="",l=s.getElementsByTagNameNS(n,
"page-layout-properties")[0],m=l.parentNode.parentNode.parentNode.masterStyles,Q="",g+=a(l,$),t=l.getElementsByTagNameNS(n,"background-image"),0<t.length&&(Q=t.item(0).getAttributeNS(y,"href"))&&(g+="background-image: url('odfkit:"+Q+"');",t=t.item(0),g+=a(t,z)),"presentation"===ha){if(m)for(t=m.getElementsByTagNameNS(n,"master-page"),L=0;L<t.length;L+=1)if(t[L].getAttributeNS(n,"page-layout-name")===l.parentNode.getAttributeNS(n,"name")){Q=t[L].getAttributeNS(n,"name");m="draw|page[draw|master-page-name="+
Q+"] {"+g+"}";Q="office|body, draw|page[draw|master-page-name="+Q+"] {"+a(l,ja)+" }";try{c.insertRule(m,c.cssRules.length),c.insertRule(Q,c.cssRules.length)}catch(S){throw S;}}}else{if("text"===ha){m="office|text {"+g+"}";Q="office|body {width: "+l.getAttributeNS(k,"page-width")+";}";try{c.insertRule(m,c.cssRules.length),c.insertRule(Q,c.cssRules.length)}catch(la){throw la;}}}else{g=q(f,g,s).join(",");l="";if(m=b(s,n,"text-properties")){var L=m,F;t=F="";Q=1;m=""+a(L,C);u=L.getAttributeNS(n,"text-underline-style");
"solid"===u&&(F+=" underline");u=L.getAttributeNS(n,"text-line-through-style");"solid"===u&&(F+=" line-through");F.length&&(m+="text-decoration:"+F+";");if(F=L.getAttributeNS(n,"font-name")||L.getAttributeNS(k,"font-family"))u=qa[F],m+="font-family: "+(u||F)+";";u=L.parentNode;if(L=e(u)){for(;u;){if(L=e(u)){if("%"!==L.unit){t="font-size: "+L.value*Q+L.unit+";";break}Q*=L.value/100}L=u;F=u="";u=null;"default-style"===L.localName?u=null:(u=L.getAttributeNS(n,"parent-style-name"),F=L.getAttributeNS(n,
"family"),u=V.getODFElementsWithXPath(T,u?"//style:*[@style:name='"+u+"'][@style:family='"+F+"']":"//style:default-style[@style:family='"+F+"']",odf.Namespaces.resolvePrefix)[0])}t||(t="font-size: "+parseFloat(Y)*Q+H.getUnits(Y)+";");m+=t}l+=m}if(m=b(s,n,"paragraph-properties"))t=m,m=""+a(t,E),Q=t.getElementsByTagNameNS(n,"background-image"),0<Q.length&&(L=Q.item(0).getAttributeNS(y,"href"))&&(m+="background-image: url('odfkit:"+L+"');",Q=Q.item(0),m+=a(Q,z)),(t=t.getAttributeNS(k,"line-height"))&&
"normal"!==t&&(t=aa.parseFoLineHeight(t),m="%"!==t.unit?m+("line-height: "+t.value+t.unit+";"):m+("line-height: "+t.value/100+";")),l+=m;if(m=b(s,n,"graphic-properties"))L=m,m=""+a(L,N),t=L.getAttributeNS(p,"opacity"),Q=L.getAttributeNS(p,"fill"),L=L.getAttributeNS(p,"fill-color"),"solid"===Q||"hatch"===Q?L&&"none"!==L?(t=isNaN(parseFloat(t))?1:parseFloat(t)/100,(L=d(L))&&(m+="background-color: rgba("+L.r+","+L.g+","+L.b+","+t+");")):m+="background: none;":"none"===Q&&(m+="background: none;"),l+=
m;if(m=b(s,n,"drawing-page-properties"))t=""+a(m,N),"true"===m.getAttributeNS(x,"background-visible")&&(t+="background: none;"),l+=t;if(m=b(s,n,"table-cell-properties"))m=""+a(m,A),l+=m;if(m=b(s,n,"table-row-properties"))m=""+a(m,D),l+=m;if(m=b(s,n,"table-column-properties"))m=""+a(m,M),l+=m;if(m=b(s,n,"table-properties"))t=m,m=""+a(t,O),t=t.getAttributeNS(w,"border-model"),"collapsing"===t?m+="border-collapse:collapse;":"separating"===t&&(m+="border-collapse:separate;"),l+=m;if(0!==l.length)try{c.insertRule(g+
"{"+l+"}",c.cssRules.length)}catch(ga){throw ga;}}for(var G in s.derivedStyles)s.derivedStyles.hasOwnProperty(G)&&h(c,f,G,s.derivedStyles[G])}var p=odf.Namespaces.drawns,k=odf.Namespaces.fons,n=odf.Namespaces.stylens,t=odf.Namespaces.svgns,w=odf.Namespaces.tablens,v=odf.Namespaces.textns,y=odf.Namespaces.xlinkns,x=odf.Namespaces.presentationns,u={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table",
"table-row":"table",text:"text",list:"text",page:"office"},s={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),
"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background","table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),
"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),list:["list-item"]},C=[[k,"color","color"],[k,"background-color","background-color"],[k,"font-weight","font-weight"],[k,"font-style","font-style"]],z=[[n,"repeat",
"background-repeat"]],E=[[k,"background-color","background-color"],[k,"text-align","text-align"],[k,"text-indent","text-indent"],[k,"padding","padding"],[k,"padding-left","padding-left"],[k,"padding-right","padding-right"],[k,"padding-top","padding-top"],[k,"padding-bottom","padding-bottom"],[k,"border-left","border-left"],[k,"border-right","border-right"],[k,"border-top","border-top"],[k,"border-bottom","border-bottom"],[k,"margin","margin"],[k,"margin-left","margin-left"],[k,"margin-right","margin-right"],
[k,"margin-top","margin-top"],[k,"margin-bottom","margin-bottom"],[k,"border","border"]],N=[[k,"background-color","background-color"],[k,"min-height","min-height"],[p,"stroke","border"],[t,"stroke-color","border-color"],[t,"stroke-width","border-width"],[k,"border","border"],[k,"border-left","border-left"],[k,"border-right","border-right"],[k,"border-top","border-top"],[k,"border-bottom","border-bottom"]],A=[[k,"background-color","background-color"],[k,"border-left","border-left"],[k,"border-right",
"border-right"],[k,"border-top","border-top"],[k,"border-bottom","border-bottom"],[k,"border","border"]],M=[[n,"column-width","width"]],D=[[n,"row-height","height"],[k,"keep-together",null]],O=[[n,"width","width"],[k,"margin-left","margin-left"],[k,"margin-right","margin-right"],[k,"margin-top","margin-top"],[k,"margin-bottom","margin-bottom"]],$=[[k,"background-color","background-color"],[k,"padding","padding"],[k,"padding-left","padding-left"],[k,"padding-right","padding-right"],[k,"padding-top",
"padding-top"],[k,"padding-bottom","padding-bottom"],[k,"border","border"],[k,"border-left","border-left"],[k,"border-right","border-right"],[k,"border-top","border-top"],[k,"border-bottom","border-bottom"],[k,"margin","margin"],[k,"margin-left","margin-left"],[k,"margin-right","margin-right"],[k,"margin-top","margin-top"],[k,"margin-bottom","margin-bottom"]],ja=[[k,"page-width","width"],[k,"page-height","height"]],S={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,
"stroke-width":!0},qa={},aa=new odf.OdfUtils,ha,T,Y,V=new xmldom.XPath,H=new core.CSSUnits;this.style2css=function(a,b,c,d,e){for(var g,k,n,l;b.cssRules.length;)b.deleteRule(b.cssRules.length-1);g=null;d&&(g=d.ownerDocument,T=d.parentNode);e&&(g=e.ownerDocument,T=e.parentNode);if(g)for(l in odf.Namespaces.forEachPrefix(function(a,c){n="@namespace "+a+" url("+c+");";try{b.insertRule(n,b.cssRules.length)}catch(d){}}),qa=c,ha=a,Y=runtime.getWindow().getComputedStyle(document.body,null).getPropertyValue("font-size")||
"12pt",a=f(d),d=f(e),e={},u)if(u.hasOwnProperty(l))for(k in c=e[l]={},m(a[l],c),m(d[l],c),c)c.hasOwnProperty(k)&&h(b,l,k,c[k])}};
runtime.loadClass("core.Base64");runtime.loadClass("core.Zip");runtime.loadClass("xmldom.LSSerializer");runtime.loadClass("odf.StyleInfo");runtime.loadClass("odf.Namespaces");runtime.loadClass("odf.OdfNodeFilter");
odf.OdfContainer=function(){function f(a,b,c){for(a=a?a.firstChild:null;a;){if(a.localName===c&&a.namespaceURI===b)return a;a=a.nextSibling}return null}function g(a){var b,c=d.length;for(b=0;b<c;b+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&a.localName===d[b])return b;return-1}function c(b,c){var d=new a.UsedStyleList(b,c),e=new odf.OdfNodeFilter;this.acceptNode=function(a){var b=e.acceptNode(a);b===NodeFilter.FILTER_ACCEPT&&a.parentNode===c&&a.nodeType===Node.ELEMENT_NODE&&
(b=d.uses(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);return b}}function m(a,b){var d=new c(a,b);this.acceptNode=function(a){var b=d.acceptNode(a);b!==NodeFilter.FILTER_ACCEPT||!a.parentNode||a.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==a.parentNode.localName&&"tab"!==a.parentNode.localName||(b=NodeFilter.FILTER_REJECT);return b}}function l(a,b){if(b){var c=g(b),d,e=a.firstChild;if(-1!==c){for(;e;){d=g(e);if(-1!==d&&d>c)break;e=e.nextSibling}a.insertBefore(b,e)}}}function q(a){this.OdfContainer=
a}function b(a,b,c,d){var e=this;this.size=0;this.type=null;this.name=a;this.container=c;this.onchange=this.onreadystatechange=this.document=this.mimetype=this.url=null;this.EMPTY=0;this.LOADING=1;this.DONE=2;this.state=this.EMPTY;this.load=function(){null!==d&&(this.mimetype=b,d.loadAsDataURL(a,b,function(a,b){a&&runtime.log(a);e.url=b;if(e.onchange)e.onchange(e);if(e.onstatereadychange)e.onstatereadychange(e)}))}}var a=new odf.StyleInfo,e=odf.Namespaces.stylens,d="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),
r=(new Date).getTime()+"_webodf_",h=new core.Base64;q.prototype=new function(){};q.prototype.constructor=q;q.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0";q.localName="document";b.prototype.load=function(){};b.prototype.getUrl=function(){return this.data?"data:;base64,"+h.toBase64(this.data):null};odf.OdfContainer=function k(d,g){function w(a){for(var b=a.firstChild,c;b;)c=b.nextSibling,b.nodeType===Node.ELEMENT_NODE?w(b):b.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&a.removeChild(b),
b=c}function v(a,b){for(var c=a&&a.firstChild;c;)c.nodeType===Node.ELEMENT_NODE&&c.setAttributeNS("urn:webodf:names:scope","scope",b),c=c.nextSibling}function y(a,b){function c(a,b,d){var e=0,f;for(f=a=a.replace(/\d+$/,"");b.hasOwnProperty(f)||d.hasOwnProperty(f);)e+=1,f=a+e;return f}function d(a){var b={};for(a=a.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&a.namespaceURI===e&&"font-face"===a.localName&&(g=a.getAttributeNS(e,"name"),b[g]=a),a=a.nextSibling;return b}var f,h,g,k,n,l,m={};n=d(a);l=
d(b);for(f=b.firstChild;f;)h=f.nextSibling,f.nodeType===Node.ELEMENT_NODE&&f.namespaceURI===e&&"font-face"===f.localName&&(g=f.getAttributeNS(e,"name"),n.hasOwnProperty(g)?f.isEqualNode(n[g])||(k=c(g,n,l),f.setAttributeNS(e,"style:name",k),a.appendChild(f),n[k]=f,delete l[g],m[g]=k):(a.appendChild(f),n[g]=f,delete l[g])),f=h;return m}function x(a,b){var c=null,d,e,f;if(a)for(c=a.cloneNode(!0),d=c.firstChild;d;)e=d.nextSibling,d.nodeType===Node.ELEMENT_NODE&&(f=d.getAttributeNS("urn:webodf:names:scope",
"scope"))&&f!==b&&c.removeChild(d),d=e;return c}function u(b,c){var d=null,f,h,g,k={};if(b)for(c.forEach(function(b){a.collectUsedFontFaces(k,b)}),d=b.cloneNode(!0),f=d.firstChild;f;)h=f.nextSibling,f.nodeType===Node.ELEMENT_NODE&&(g=f.getAttributeNS(e,"name"),k[g]||d.removeChild(f)),f=h;return d}function s(a){var b=K.rootElement.ownerDocument,c;if(a){w(a.documentElement);try{c=b.importNode(a.documentElement,!0)}catch(d){}}return c}function C(a){K.state=a;if(K.onchange)K.onchange(K);if(K.onstatereadychange)K.onstatereadychange(K)}
function z(a){ba=null;K.rootElement=a;a.fontFaceDecls=f(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");a.styles=f(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles");a.automaticStyles=f(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");a.masterStyles=f(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles");a.body=f(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");a.meta=f(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"meta")}function E(b){b=s(b);var c=K.rootElement;b&&"document-styles"===b.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===b.namespaceURI?(c.fontFaceDecls=f(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),l(c,c.fontFaceDecls),c.styles=f(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),l(c,c.styles),c.automaticStyles=f(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),v(c.automaticStyles,"document-styles"),l(c,c.automaticStyles),
c.masterStyles=f(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),l(c,c.masterStyles),a.prefixStyleNames(c.automaticStyles,r,c.masterStyles)):C(k.INVALID)}function N(b){b=s(b);var c,d,e;if(b&&"document-content"===b.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===b.namespaceURI){c=K.rootElement;d=f(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");c.fontFaceDecls&&d?e=y(c.fontFaceDecls,d):d&&(c.fontFaceDecls=d,l(c,d));d=f(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"automatic-styles");v(d,"document-content");e&&a.changeFontFaceNames(d,e);if(c.automaticStyles&&d)for(e=d.firstChild;e;)c.automaticStyles.appendChild(e),e=d.firstChild;else d&&(c.automaticStyles=d,l(c,d));c.body=f(b,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");l(c,c.body)}else C(k.INVALID)}function A(a){a=s(a);var b;a&&"document-meta"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(b=K.rootElement,b.meta=f(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"meta"),l(b,b.meta))}function M(a){a=s(a);var b;a&&"document-settings"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(b=K.rootElement,b.settings=f(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),l(b,b.settings))}function D(a){a=s(a);var b;if(a&&"manifest"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI)for(b=K.rootElement,b.manifest=a,a=b.manifest.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&"file-entry"===
a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI&&(P[a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),a=a.nextSibling}function O(a){var b=a.shift(),c,d;b?(c=b[0],d=b[1],R.loadAsDOM(c,function(b,c){d(c);b||K.state===k.INVALID||O(a)})):C(k.DONE)}function $(a){var b="";odf.Namespaces.forEachPrefix(function(a,c){b+=" xmlns:"+a+'="'+c+'"'});return'<?xml version="1.0" encoding="UTF-8"?><office:'+
a+" "+b+' office:version="1.2">'}function ja(){var a=new xmldom.LSSerializer,b=$("document-meta");a.filter=new odf.OdfNodeFilter;b+=a.writeToString(K.rootElement.meta,odf.Namespaces.namespaceMap);return b+"</office:document-meta>"}function S(a,b){var c=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");c.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",a);c.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0",
"manifest:media-type",b);return c}function qa(){var a=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),b=f(a,"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest"),c=new xmldom.LSSerializer,d;for(d in P)P.hasOwnProperty(d)&&b.appendChild(S(d,P[d]));c.filter=new odf.OdfNodeFilter;return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+c.writeToString(a,odf.Namespaces.namespaceMap)}
function aa(){var a=new xmldom.LSSerializer,b=$("document-settings");a.filter=new odf.OdfNodeFilter;b+=a.writeToString(K.rootElement.settings,odf.Namespaces.namespaceMap);return b+"</office:document-settings>"}function ha(){var b=odf.Namespaces.namespaceMap,d=new xmldom.LSSerializer,e,f,h,g=$("document-styles");f=x(K.rootElement.automaticStyles,"document-styles");h=K.rootElement.masterStyles&&K.rootElement.masterStyles.cloneNode(!0);e=u(K.rootElement.fontFaceDecls,[h,K.rootElement.styles,f]);a.removePrefixFromStyleNames(f,
r,h);d.filter=new c(h,f);g+=d.writeToString(e,b);g+=d.writeToString(K.rootElement.styles,b);g+=d.writeToString(f,b);g+=d.writeToString(h,b);return g+"</office:document-styles>"}function T(){var a=odf.Namespaces.namespaceMap,b=new xmldom.LSSerializer,c,d,e=$("document-content");d=x(K.rootElement.automaticStyles,"document-content");c=u(K.rootElement.fontFaceDecls,[d]);b.filter=new m(K.rootElement.body,d);e+=b.writeToString(c,a);e+=b.writeToString(d,a);e+=b.writeToString(K.rootElement.body,a);return e+
"</office:document-content>"}function Y(a,b){runtime.loadXML(a,function(a,c){if(a)b(a);else{var d=s(c);d&&"document"===d.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===d.namespaceURI?(z(d),C(k.DONE)):C(k.INVALID)}})}function V(){function a(b,c){var e;c||(c=b);e=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",c);d[b]=e;d.appendChild(e)}var b=new core.Zip("",null),c=runtime.byteArrayFromString("application/vnd.oasis.opendocument.text","utf8"),d=K.rootElement,
e=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","text");b.save("mimetype",c,!1,new Date);a("meta");a("settings");a("scripts");a("fontFaceDecls","font-face-decls");a("styles");a("automaticStyles","automatic-styles");a("masterStyles","master-styles");a("body");d.body.appendChild(e);C(k.DONE);return b}function H(){var a,b=new Date;a=runtime.byteArrayFromString(aa(),"utf8");R.save("settings.xml",a,!0,b);a=runtime.byteArrayFromString(ja(),"utf8");R.save("meta.xml",a,!0,b);
a=runtime.byteArrayFromString(ha(),"utf8");R.save("styles.xml",a,!0,b);a=runtime.byteArrayFromString(T(),"utf8");R.save("content.xml",a,!0,b);a=runtime.byteArrayFromString(qa(),"utf8");R.save("META-INF/manifest.xml",a,!0,b)}function I(a,b){H();R.writeAs(a,function(a){b(a)})}var K=this,R,P={},ba;this.onstatereadychange=g;this.rootElement=this.state=this.onchange=null;this.setRootElement=z;this.getContentElement=function(){var a;ba||(a=K.rootElement.body,ba=a.getElementsByTagNameNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"text")[0]||a.getElementsByTagNameNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")[0]||a.getElementsByTagNameNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet")[0]);return ba};this.getDocumentType=function(){var a=K.getContentElement();return a&&a.localName};this.getPart=function(a){return new b(a,P[a],K,R)};this.getPartData=function(a,b){R.load(a,b)};this.createByteArray=function(a,b){H();R.createByteArray(a,b)};this.saveAs=I;this.save=function(a){I(d,a)};this.getUrl=
function(){return d};this.setBlob=function(a,b,c){c=h.convertBase64ToByteArray(c);R.save(a,c,!1,new Date);P.hasOwnProperty(a)&&runtime.log(a+" has been overwritten.");P[a]=b};this.removeBlob=function(a){var b=R.remove(a);runtime.assert(b,"file is not found: "+a);delete P[a]};this.state=k.LOADING;this.rootElement=function(a){var b=document.createElementNS(a.namespaceURI,a.localName),c;a=new a;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}(q);R=d?new core.Zip(d,function(a,b){R=b;a?Y(d,function(b){a&&
(R.error=a+"\n"+b,C(k.INVALID))}):O([["styles.xml",E],["content.xml",N],["meta.xml",A],["settings.xml",M],["META-INF/manifest.xml",D]])}):V()};odf.OdfContainer.EMPTY=0;odf.OdfContainer.LOADING=1;odf.OdfContainer.DONE=2;odf.OdfContainer.INVALID=3;odf.OdfContainer.SAVING=4;odf.OdfContainer.MODIFIED=5;odf.OdfContainer.getContainer=function(a){return new odf.OdfContainer(a,null)};return odf.OdfContainer}();
runtime.loadClass("core.Base64");runtime.loadClass("xmldom.XPath");runtime.loadClass("odf.OdfContainer");
odf.FontLoader=function(){function f(g,l,q,b,a){var e,d=0,r;for(r in g)if(g.hasOwnProperty(r)){if(d===q){e=r;break}d+=1}e?l.getPartData(g[e].href,function(d,p){if(d)runtime.log(d);else{var k="@font-face { font-family: '"+(g[e].family||e)+"'; src: url(data:application/x-font-ttf;charset=binary;base64,"+c.convertUTF8ArrayToBase64(p)+') format("truetype"); }';try{b.insertRule(k,b.cssRules.length)}catch(n){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(n)+"\nRule: "+k)}}f(g,l,q+1,b,a)}):
a&&a()}var g=new xmldom.XPath,c=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(c,l){for(var q=c.rootElement.fontFaceDecls;l.cssRules.length;)l.deleteRule(l.cssRules.length-1);if(q){var b={},a,e,d,r;if(q)for(q=g.getODFElementsWithXPath(q,"style:font-face[svg:font-face-src]",odf.Namespaces.resolvePrefix),a=0;a<q.length;a+=1)e=q[a],d=e.getAttributeNS(odf.Namespaces.stylens,"name"),r=e.getAttributeNS(odf.Namespaces.svgns,"font-family"),e=g.getODFElementsWithXPath(e,"svg:font-face-src/svg:font-face-uri",
odf.Namespaces.resolvePrefix),0<e.length&&(e=e[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),b[d]={href:e,family:r});f(b,c,0,l)}}};return odf.FontLoader}();
runtime.loadClass("core.DomUtils");runtime.loadClass("core.Utils");
odf.ObjectNameGenerator=function(f,g){function c(a,b){var c={};this.generateName=function(){var d=b(),e=0,f;do f=a+e,e+=1;while(c[f]||d[f]);c[f]=!0;return f}}function m(){var a,b={};[f.rootElement.automaticStyles,f.rootElement.styles].forEach(function(c){for(a=c.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&a.namespaceURI===l&&"style"===a.localName&&(b[a.getAttributeNS(l,"name")]=!0),a=a.nextSibling});return b}var l=odf.Namespaces.stylens,q=odf.Namespaces.drawns,b=odf.Namespaces.xlinkns,a=new core.DomUtils,
e=(new core.Utils).hashString(g),d=null,r=null,h=null,p={},k={};this.generateStyleName=function(){null===d&&(d=new c("auto"+e+"_",function(){return m()}));return d.generateName()};this.generateFrameName=function(){null===r&&(a.getElementsByTagNameNS(f.rootElement.body,q,"frame").forEach(function(a){p[a.getAttributeNS(q,"name")]=!0}),r=new c("fr"+e+"_",function(){return p}));return r.generateName()};this.generateImageName=function(){null===h&&(a.getElementsByTagNameNS(f.rootElement.body,q,"image").forEach(function(a){a=
a.getAttributeNS(b,"href");a=a.substring(9,a.lastIndexOf("."));k[a]=!0}),h=new c("img"+e+"_",function(){return k}));return h.generateName()}};
runtime.loadClass("core.Utils");runtime.loadClass("odf.ObjectNameGenerator");runtime.loadClass("odf.Namespaces");runtime.loadClass("odf.OdfContainer");runtime.loadClass("odf.StyleInfo");runtime.loadClass("odf.OdfUtils");runtime.loadClass("odf.TextStyleApplicator");
odf.Formatting=function(){function f(){for(var a=r.rootElement.fontFaceDecls,b={},c,d,a=a&&a.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&(c=a.getAttributeNS(k,"name"))&&((d=a.getAttributeNS(p,"font-family"))||a.getElementsByTagNameNS(p,"font-face-uri")[0])&&(b[c]=d),a=a.nextSibling;return b}function g(a){for(var b=r.rootElement.styles.firstChild;b;){if(b.nodeType===Node.ELEMENT_NODE&&b.namespaceURI===k&&"default-style"===b.localName&&b.getAttributeNS(k,"family")===a)return b;b=b.nextSibling}return null}
function c(a,b,c){var d,e;c=c||[r.rootElement.automaticStyles,r.rootElement.styles];for(d=c.shift();d;){for(d=d.firstChild;d;){if(d.nodeType===Node.ELEMENT_NODE&&(e=d.getAttributeNS(k,"name"),d.namespaceURI===k&&"style"===d.localName&&d.getAttributeNS(k,"family")===b&&e===a||"list-style"===b&&d.namespaceURI===n&&"list-style"===d.localName&&e===a||"data"===b&&d.namespaceURI===t&&e===a))return d;d=d.nextSibling}d=c.shift()}return null}function m(a){for(var b,c={},d=a.firstChild;d;){if(d.nodeType===
Node.ELEMENT_NODE&&d.namespaceURI===k)for(c[d.nodeName]={},b=0;b<d.attributes.length;b+=1)c[d.nodeName][d.attributes[b].name]=d.attributes[b].value;d=d.nextSibling}for(b=0;b<a.attributes.length;b+=1)c[a.attributes[b].name]=a.attributes[b].value;return c}function l(a,b){Object.keys(b).forEach(function(c){var d=c.split(":"),e=d[1],f=odf.Namespaces.resolvePrefix(d[0]),d=b[c];"object"===typeof d&&Object.keys(d).length?(c=a.getElementsByTagNameNS(f,e)[0]||a.ownerDocument.createElementNS(f,c),a.appendChild(c),
l(c,d)):f&&a.setAttributeNS(f,c,d)})}function q(a,b){for(var d=r.rootElement.styles,e,f={},h=a.getAttributeNS(k,"family"),n=a;n;)e=m(n),f=x.mergeObjects(e,f),n=(e=n.getAttributeNS(k,"parent-style-name"))?c(e,h,[d]):null;if(n=g(h))e=m(n),f=x.mergeObjects(e,f);b&&(e=(d=u[h])?x.mergeObjects({},d):null)&&(f=x.mergeObjects(e,f));return f}function b(a,b){for(var c=a.nodeType===Node.TEXT_NODE?a.parentNode:a,d,e=[],f="",g=!1;c;)!g&&v.isGroupingElement(c)&&(g=!0),(d=h.determineStylesForNode(c))&&e.push(d),
c=c.parentNode;g&&(e.forEach(function(a){Object.keys(a).forEach(function(b){Object.keys(a[b]).forEach(function(a){f+="|"+b+":"+a+"|"})})}),b&&(b[f]=e));return g?e:void 0}function a(a){var b={orderedStyles:[]};a.forEach(function(a){Object.keys(a).forEach(function(d){var e=Object.keys(a[d])[0],f,h;(f=c(e,d))?(h=q(f),b=x.mergeObjects(h,b),h=f.getAttributeNS(k,"display-name")):runtime.log("No style element found for '"+e+"' of family '"+d+"'");b.orderedStyles.push({name:e,family:d,displayName:h})})});
return b}function e(a,b){var c=v.parseLength(a),d=b;if(c)switch(c.unit){case "cm":d=c.value;break;case "mm":d=0.1*c.value;break;case "in":d=2.54*c.value;break;case "pt":d=0.035277778*c.value;break;case "pc":case "px":case "em":break;default:runtime.log("Unit identifier: "+c.unit+" is not supported.")}return d}var d=this,r,h=new odf.StyleInfo,p=odf.Namespaces.svgns,k=odf.Namespaces.stylens,n=odf.Namespaces.textns,t=odf.Namespaces.numberns,w=odf.Namespaces.fons,v=new odf.OdfUtils,y=new core.DomUtils,
x=new core.Utils,u={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.setOdfContainer=function(a){r=a};this.getFontMap=f;this.getAvailableParagraphStyles=function(){for(var a=r.rootElement.styles&&r.rootElement.styles.firstChild,b,c,d=[];a;)a.nodeType===Node.ELEMENT_NODE&&"style"===a.localName&&a.namespaceURI===k&&(c=a,b=c.getAttributeNS(k,"family"),"paragraph"===b&&(b=c.getAttributeNS(k,"name"),c=c.getAttributeNS(k,"display-name")||b,b&&c&&d.push({name:b,displayName:c}))),a=
a.nextSibling;return d};this.isStyleUsed=function(a){var b;b=h.hasDerivedStyles(r.rootElement,odf.Namespaces.resolvePrefix,a);a=(new h.UsedStyleList(r.rootElement.styles)).uses(a)||(new h.UsedStyleList(r.rootElement.automaticStyles)).uses(a)||(new h.UsedStyleList(r.rootElement.body)).uses(a);return b||a};this.getDefaultStyleElement=g;this.getStyleElement=c;this.getStyleAttributes=m;this.getInheritedStyleAttributes=q;this.getFirstCommonParentStyleNameOrSelf=function(a){var b=r.rootElement.automaticStyles,
d=r.rootElement.styles,e;for(e=c(a,"paragraph",[b]);e;)a=e.getAttributeNS(k,"parent-style-name"),e=c(a,"paragraph",[b]);return(e=c(a,"paragraph",[d]))?a:null};this.hasParagraphStyle=function(a){return Boolean(c(a,"paragraph"))};this.getAppliedStyles=function(c){var d={},e=[];c.forEach(function(a){b(a,d)});Object.keys(d).forEach(function(b){e.push(a(d[b]))});return e};this.getAppliedStylesForElement=function(c){return(c=b(c))?a(c):void 0};this.applyStyle=function(a,b,c,e){(new odf.TextStyleApplicator(new odf.ObjectNameGenerator(r,
a),d,r.rootElement.automaticStyles)).applyStyle(b,c,e)};this.updateStyle=function(a,b){var c,d;l(a,b);(c=b["style:text-properties"]&&b["style:text-properties"]["style:font-name"])&&!f().hasOwnProperty(c)&&(d=a.ownerDocument.createElementNS(k,"style:font-face"),d.setAttributeNS(k,"style:name",c),d.setAttributeNS(p,"svg:font-family",c),r.rootElement.fontFaceDecls.appendChild(d))};this.createDerivedStyleObject=function(a,b,d){var e=c(a,b);runtime.assert(Boolean(e),"No style element found for '"+a+"' of family '"+
b+"'");a=e.parentNode===r.rootElement.automaticStyles?m(e):{"style:parent-style-name":a};a["style:family"]=b;x.mergeObjects(a,d);return a};this.getDefaultTabStopDistance=function(){var a=g("paragraph");(a=(a=a&&a.getAttributeNS(k,"paragraph-properties"))&&a.getAttributeNS(k,"tab-stop-distance"))||(a="1.25cm");return v.parseNonNegativeLength(a)};this.getContentSize=function(a,b){var d,f,h,g,n,l,m,p,q,t,v,u;a:{d=c(a,b);var x,T,Y;runtime.assert("paragraph"===b||"table"===b,"styleFamily has to be either paragraph or table");
if(d){x=d.getAttributeNS(k,"master-page-name")||"Standard";for(d=r.rootElement.masterStyles.lastChild;d&&d.previousSibling&&d.getAttributeNS(k,"name")!==x;)d=d.previousSibling;x=d.getAttributeNS(k,"page-layout-name");T=y.getElementsByTagNameNS(r.rootElement.automaticStyles,k,"page-layout");for(Y=0;Y<T.length;Y+=1)if(d=T[Y],d.getAttributeNS(k,"name")===x)break a}d=null}d||(d=r.rootElement.styles.getElementsByTagNameNS(k,"default-page-layout")[0]);d&&(f=d.getElementsByTagNameNS(k,"page-layout-properties")[0]);
f&&(h=f.getAttributeNS(k,"print-orientation")||"portrait","portrait"===h?(h=21.001,g=29.7):(h=29.7,g=21.001),h=e(f.getAttributeNS(w,"page-width"),h),g=e(f.getAttributeNS(w,"page-height"),g),n=e(f.getAttributeNS(w,"margin"),null),null===n?(n=e(f.getAttributeNS(w,"margin-left"),2),l=e(f.getAttributeNS(w,"margin-right"),2),m=e(f.getAttributeNS(w,"margin-top"),2),p=e(f.getAttributeNS(w,"margin-bottom"),2)):n=l=m=p=n,q=e(f.getAttributeNS(w,"padding"),null),null===q?(q=e(f.getAttributeNS(w,"padding-left"),
0),t=e(f.getAttributeNS(w,"padding-right"),0),v=e(f.getAttributeNS(w,"padding-top"),0),u=e(f.getAttributeNS(w,"padding-bottom"),0)):q=t=v=u=q);return{width:h-n-l-q-t,height:g-m-p-v-u}}};
runtime.loadClass("core.DomUtils");runtime.loadClass("odf.OdfContainer");runtime.loadClass("odf.Formatting");runtime.loadClass("xmldom.XPath");runtime.loadClass("odf.FontLoader");runtime.loadClass("odf.Style2CSS");runtime.loadClass("odf.OdfUtils");runtime.loadClass("gui.AnnotationViewManager");
odf.OdfCanvas=function(){function f(){function a(d){c=!0;runtime.setTimeout(function(){try{d()}catch(e){runtime.log(e)}c=!1;0<b.length&&a(b.pop())},10)}var b=[],c=!1;this.clearQueue=function(){b.length=0};this.addToQueue=function(d){if(0===b.length&&!c)return a(d);b.push(d)}}function g(a){function b(){for(;0<c.cssRules.length;)c.deleteRule(0);c.insertRule("#shadowContent draw|page {display:none;}",0);c.insertRule("office|presentation draw|page {display:none;}",1);c.insertRule("#shadowContent draw|page:nth-of-type("+
d+") {display:block;}",2);c.insertRule("office|presentation draw|page:nth-of-type("+d+") {display:block;}",3)}var c=a.sheet,d=1;this.showFirstPage=function(){d=1;b()};this.showNextPage=function(){d+=1;b()};this.showPreviousPage=function(){1<d&&(d-=1,b())};this.showPage=function(a){0<a&&(d=a,b())};this.css=a;this.destroy=function(b){a.parentNode.removeChild(a);b()}}function c(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}function m(a,b,c){var d=
"on"+b;a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent(d,c):a[d]===c&&(a[d]=null)}function l(a){function b(a,c){for(;c;){if(c===a)return!0;c=c.parentNode}return!1}function d(){var c=[],h=runtime.getWindow().getSelection(),g,k;for(g=0;g<h.rangeCount;g+=1)k=h.getRangeAt(g),null!==k&&b(a,k.startContainer)&&b(a,k.endContainer)&&c.push(k);if(c.length===e.length){for(h=0;h<c.length&&(g=c[h],k=e[h],g=g===k?!1:null===g||null===k?!0:g.startContainer!==k.startContainer||g.startOffset!==
k.startOffset||g.endContainer!==k.endContainer||g.endOffset!==k.endOffset,!g);h+=1);if(h===c.length)return}e=c;var h=[c.length],n,l=a.ownerDocument;for(g=0;g<c.length;g+=1)k=c[g],n=l.createRange(),n.setStart(k.startContainer,k.startOffset),n.setEnd(k.endContainer,k.endOffset),h[g]=n;e=h;h=f.length;for(c=0;c<h;c+=1)f[c](a,e)}var e=[],f=[];this.addListener=function(a,b){var c,d=f.length;for(c=0;c<d;c+=1)if(f[c]===b)return;f.push(b)};this.destroy=function(b){m(a,"mouseup",d);m(a,"keyup",d);m(a,"keydown",
d);b()};c(a,"mouseup",d);c(a,"keyup",d);c(a,"keydown",d)}function q(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function b(a,b,c){(new odf.Style2CSS).style2css(a.getDocumentType(),c.sheet,b.getFontMap(),a.rootElement.styles,a.rootElement.automaticStyles)}function a(a,b,c){var d=null;a=a.rootElement.body.getElementsByTagNameNS(D,c+"-decl");if((c=b.getAttributeNS(D,"use-"+c+"-name"))&&0<a.length)for(b=0;b<a.length;b+=1)if(a[b].getAttributeNS(D,"name")===c){d=a[b].textContent;break}return d}function e(a,
b,c,d){var e=a.ownerDocument;b=a.getElementsByTagNameNS(b,c);for(a=0;a<b.length;a+=1)q(b[a]),d&&b[a].appendChild(e.createTextNode(d))}function d(a,b,c){b.setAttributeNS("urn:webodf:names:helper","styleid",a);var d,e=b.getAttributeNS(N,"anchor-type"),f=b.getAttributeNS(z,"x"),h=b.getAttributeNS(z,"y"),g=b.getAttributeNS(z,"width"),k=b.getAttributeNS(z,"height"),n=b.getAttributeNS(u,"min-height"),l=b.getAttributeNS(u,"min-width");if("as-char"===e)d="display: inline-block;";else if(e||f||h)d="position: absolute;";
else if(g||k||n||l)d="display: block;";f&&(d+="left: "+f+";");h&&(d+="top: "+h+";");g&&(d+="width: "+g+";");k&&(d+="height: "+k+";");n&&(d+="min-height: "+n+";");l&&(d+="min-width: "+l+";");d&&(d="draw|"+b.localName+'[webodfhelper|styleid="'+a+'"] {'+d+"}",c.insertRule(d,c.cssRules.length))}function r(a){for(a=a.firstChild;a;){if(a.namespaceURI===s&&"binary-data"===a.localName)return"data:image/png;base64,"+a.textContent.replace(/[\r\n\s]/g,"");a=a.nextSibling}return""}function h(a,b,c,d){function e(b){b&&
(b='draw|image[webodfhelper|styleid="'+a+'"] {'+("background-image: url("+b+");")+"}",d.insertRule(b,d.cssRules.length))}c.setAttributeNS("urn:webodf:names:helper","styleid",a);var f=c.getAttributeNS(A,"href"),h;if(f)try{h=b.getPart(f),h.onchange=function(a){e(a.url)},h.load()}catch(g){runtime.log("slight problem: "+g)}else f=r(c),e(f)}function p(a){function b(c){var d,e;c.hasAttributeNS(A,"href")&&(d=c.getAttributeNS(A,"href"),"#"===d[0]?(d=d.substring(1),e=function(){var b=$.getODFElementsWithXPath(a,
"//text:bookmark-start[@text:name='"+d+"']",odf.Namespaces.resolvePrefix);0===b.length&&(b=$.getODFElementsWithXPath(a,"//text:bookmark[@text:name='"+d+"']",odf.Namespaces.resolvePrefix));0<b.length&&b[0].scrollIntoView(!0);return!1}):e=function(){O.open(d)},c.onclick=e)}var c,d,e;d=a.getElementsByTagNameNS(N,"a");for(c=0;c<d.length;c+=1)e=d.item(c),b(e)}function k(a){var b=a.ownerDocument;S.getElementsByTagNameNS(a,N,"line-break").forEach(function(a){a.hasChildNodes()||a.appendChild(b.createElement("br"))})}
function n(a){var b=a.ownerDocument;S.getElementsByTagNameNS(a,N,"s").forEach(function(a){for(var c,d;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b.createTextNode(" "));d=parseInt(a.getAttributeNS(N,"c"),10);if(1<d)for(a.removeAttributeNS(N,"c"),c=1;c<d;c+=1)a.parentNode.insertBefore(a.cloneNode(!0),a)})}function t(a){S.getElementsByTagNameNS(a,N,"tab").forEach(function(a){a.textContent="\t"})}function w(a,b){function c(a,f){var g=h.documentElement.namespaceURI;"video/"===f.substr(0,6)?
(d=h.createElementNS(g,"video"),d.setAttribute("controls","controls"),e=h.createElementNS(g,"source"),e.setAttribute("src",a),e.setAttribute("type",f),d.appendChild(e),b.parentNode.appendChild(d)):b.innerHtml="Unrecognised Plugin"}var d,e,f,h=b.ownerDocument,g;if(f=b.getAttributeNS(A,"href"))try{g=a.getPart(f),g.onchange=function(a){c(a.url,a.mimetype)},g.load()}catch(k){runtime.log("slight problem: "+k)}else runtime.log("using MP4 data fallback"),f=r(b),c(f,"video/mp4")}function v(a){var b=a.getElementsByTagName("head")[0],
c;"undefined"!==String(typeof webodf_css)?(c=a.createElementNS(b.namespaceURI,"style"),c.setAttribute("media","screen, print, handheld, projection"),c.appendChild(a.createTextNode(webodf_css))):(c=a.createElementNS(b.namespaceURI,"link"),a="webodf.css",runtime.currentDirectory&&(a=runtime.currentDirectory()+"/../"+a),c.setAttribute("href",a),c.setAttribute("rel","stylesheet"));c.setAttribute("type","text/css");b.appendChild(c);return c}function y(a){var b=a.getElementsByTagName("head")[0],c=a.createElementNS(b.namespaceURI,
"style"),d="";c.setAttribute("type","text/css");c.setAttribute("media","screen, print, handheld, projection");odf.Namespaces.forEachPrefix(function(a,b){d+="@namespace "+a+" url("+b+");\n"});d+="@namespace webodfhelper url(urn:webodf:names:helper);\n";c.appendChild(a.createTextNode(d));b.appendChild(c);return c}var x=odf.Namespaces.drawns,u=odf.Namespaces.fons,s=odf.Namespaces.officens,C=odf.Namespaces.stylens,z=odf.Namespaces.svgns,E=odf.Namespaces.tablens,N=odf.Namespaces.textns,A=odf.Namespaces.xlinkns,
M=odf.Namespaces.xmlns,D=odf.Namespaces.presentationns,O=runtime.getWindow(),$=new xmldom.XPath,ja=new odf.OdfUtils,S=new core.DomUtils;odf.OdfCanvas=function(m){function r(a,b,c){function d(a,b,c,e){B.addToQueue(function(){h(a,b,c,e)})}var e,f;e=b.getElementsByTagNameNS(x,"image");for(b=0;b<e.length;b+=1)f=e.item(b),d("image"+String(b),a,f,c)}function u(a,b){function c(a,b){B.addToQueue(function(){w(a,b)})}var d,e,f;e=b.getElementsByTagNameNS(x,"plugin");for(d=0;d<e.length;d+=1)f=e.item(d),c(a,f)}
function A(){U.firstChild&&(1<W?(U.style.MozTransformOrigin="center top",U.style.WebkitTransformOrigin="center top",U.style.OTransformOrigin="center top",U.style.msTransformOrigin="center top"):(U.style.MozTransformOrigin="left top",U.style.WebkitTransformOrigin="left top",U.style.OTransformOrigin="left top",U.style.msTransformOrigin="left top"),U.style.WebkitTransform="scale("+W+")",U.style.MozTransform="scale("+W+")",U.style.OTransform="scale("+W+")",U.style.msTransform="scale("+W+")",m.style.width=
Math.round(W*U.offsetWidth)+"px",m.style.height=Math.round(W*U.offsetHeight)+"px")}function z(a){function b(a){return d===a.getAttributeNS(s,"name")}var c=S.getElementsByTagNameNS(a,s,"annotation");a=S.getElementsByTagNameNS(a,s,"annotation-end");var d,e;for(e=0;e<c.length;e+=1)d=c[e].getAttributeNS(s,"name"),ea.addAnnotation({node:c[e],end:a.filter(b)[0]||null});ea.rerenderAnnotations()}function V(a){L?(Q.parentNode||(U.appendChild(Q),A()),ea&&ea.forgetAnnotations(),ea=new gui.AnnotationViewManager(K,
a.body,Q),z(a.body)):Q.parentNode&&(U.removeChild(Q),ea.forgetAnnotations(),A())}function H(c){function f(){q(m);m.style.display="inline-block";var h=P.rootElement;m.ownerDocument.importNode(h,!0);ba.setOdfContainer(P);var g=P,l=F;(new odf.FontLoader).loadFonts(g,l.sheet);b(P,ba,ga);l=P;g=G.sheet;q(m);U=R.createElementNS(m.namespaceURI,"div");U.style.display="inline-block";U.style.background="white";U.appendChild(h);m.appendChild(U);Q=R.createElementNS(m.namespaceURI,"div");Q.id="annotationsPane";
fa=R.createElementNS(m.namespaceURI,"div");fa.id="shadowContent";fa.style.position="absolute";fa.style.top=0;fa.style.left=0;l.getContentElement().appendChild(fa);var v=h.body,w,y,z;y=[];for(w=v.firstChild;w&&w!==v;)if(w.namespaceURI===x&&(y[y.length]=w),w.firstChild)w=w.firstChild;else{for(;w&&w!==v&&!w.nextSibling;)w=w.parentNode;w&&w.nextSibling&&(w=w.nextSibling)}for(z=0;z<y.length;z+=1)w=y[z],d("frame"+String(z),w,g);y=$.getODFElementsWithXPath(v,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.resolvePrefix);
for(w=0;w<y.length;w+=1)v=y[w],v.setAttributeNS&&v.setAttributeNS("urn:webodf:names:helper","containsparagraphanchor",!0);var v=fa,S,B,J;J=0;var K,I;y=l.rootElement.ownerDocument;if((w=h.body.firstElementChild)&&w.namespaceURI===s&&("presentation"===w.localName||"drawing"===w.localName))for(w=w.firstElementChild;w;){z=w.getAttributeNS(x,"master-page-name");if(z){S=l.rootElement.masterStyles.getElementsByTagNameNS(C,"master-page");B=null;J=void 0;for(J=0;J<S.length;J+=1)if(S[J].getAttributeNS(C,"name")===
z){B=S[J];break}z=B}else z=null;if(z){S=w.getAttributeNS("urn:webodf:names:helper","styleid");B=y.createElementNS(x,"draw:page");I=z.firstElementChild;for(K=0;I;)"true"!==I.getAttributeNS(D,"placeholder")&&(J=I.cloneNode(!0),B.appendChild(J),d(S+"_"+K,J,g)),I=I.nextElementSibling,K+=1;I=K=J=void 0;var L=B.getElementsByTagNameNS(x,"frame");for(J=0;J<L.length;J+=1)K=L[J],(I=K.getAttributeNS(D,"class"))&&!/^(date-time|footer|header|page-number')$/.test(I)&&K.parentNode.removeChild(K);v.appendChild(B);
J=String(v.getElementsByTagNameNS(x,"page").length);e(B,N,"page-number",J);e(B,D,"header",a(l,w,"header"));e(B,D,"footer",a(l,w,"footer"));d(S,B,g);B.setAttributeNS(x,"draw:master-page-name",z.getAttributeNS(C,"name"))}w=w.nextElementSibling}w=h.body.getElementsByTagNameNS(E,"table-cell");for(v=0;v<w.length;v+=1)y=w.item(v),y.hasAttributeNS(E,"number-columns-spanned")&&y.setAttribute("colspan",y.getAttributeNS(E,"number-columns-spanned")),y.hasAttributeNS(E,"number-rows-spanned")&&y.setAttribute("rowspan",
y.getAttributeNS(E,"number-rows-spanned"));p(h.body);k(h.body);n(h.body);t(h.body);r(l,h.body,g);u(l,h.body);y=h.body;v={};w={};var H;z=O.document.getElementsByTagNameNS(N,"list-style");for(l=0;l<z.length;l+=1)J=z.item(l),(K=J.getAttributeNS(C,"name"))&&(w[K]=J);y=y.getElementsByTagNameNS(N,"list");for(l=0;l<y.length;l+=1)if(J=y.item(l),z=J.getAttributeNS(M,"id")){S=J.getAttributeNS(N,"continue-list");J.setAttribute("id",z);B="text|list#"+z+" > text|list-item > *:first-child:before {";if(K=J.getAttributeNS(N,
"style-name"))J=w[K],H=ja.getFirstNonWhitespaceChild(J),J=void 0,H&&("list-level-style-number"===H.localName?(J=H.getAttributeNS(C,"num-format"),K=H.getAttributeNS(C,"num-suffix"),I="",I={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"},L=void 0,L=H.getAttributeNS(C,"num-prefix")||"",L=I.hasOwnProperty(J)?L+(" counter(list, "+I[J]+")"):J?L+("'"+J+"';"):L+" ''",K&&(L+=" '"+K+"'"),J=I="content: "+L+";"):"list-level-style-image"===H.localName?J="content: none;":"list-level-style-bullet"===
H.localName&&(J="content: '"+H.getAttributeNS(N,"bullet-char")+"';")),H=J;if(S){for(J=v[S];J;)S=J,J=v[S];B+="counter-increment:"+S+";";H?(H=H.replace("list",S),B+=H):B+="content:counter("+S+");"}else S="",H?(H=H.replace("list",z),B+=H):B+="content: counter("+z+");",B+="counter-increment:"+z+";",g.insertRule("text|list#"+z+" {counter-reset:"+z+"}",g.cssRules.length);B+="}";v[z]=S;B&&g.insertRule(B,g.cssRules.length)}U.insertBefore(fa,U.firstChild);A();V(h);if(!c&&(h=[P],ia.hasOwnProperty("statereadychange")))for(g=
ia.statereadychange,H=0;H<g.length;H+=1)g[H].apply(null,h)}P.state===odf.OdfContainer.DONE?f():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),runtime.setTimeout(function na(){P.state===odf.OdfContainer.DONE?f():(runtime.log("will be back later..."),runtime.setTimeout(na,500))},100))}function I(a){B.clearQueue();m.innerHTML="loading "+a;m.removeAttribute("style");P=new odf.OdfContainer(a,function(a){P=a;H(!1)})}runtime.assert(null!==m&&void 0!==m,"odf.OdfCanvas constructor needs DOM element");
runtime.assert(null!==m.ownerDocument&&void 0!==m.ownerDocument,"odf.OdfCanvas constructor needs DOM");var K=this,R=m.ownerDocument,P,ba=new odf.Formatting,ka=new l(m),da,U,Q,L=!1,ea,la,F,ga,G,fa,W=1,ia={},B=new f;this.refreshCSS=function(){b(P,ba,ga);A()};this.refreshSize=function(){A()};this.odfContainer=function(){return P};this.slidevisibilitycss=function(){return da.css};this.setOdfContainer=function(a,b){P=a;H(!0===b)};this.load=this.load=I;this.save=function(a){P.save(a)};this.addListener=
function(a,b){switch(a){case "selectionchange":ka.addListener(a,b);break;case "click":c(m,a,b);break;default:var d=ia[a];void 0===d&&(d=ia[a]=[]);b&&-1===d.indexOf(b)&&d.push(b)}};this.getFormatting=function(){return ba};this.getAnnotationManager=function(){return ea};this.refreshAnnotations=function(){V(P.rootElement)};this.rerenderAnnotations=function(){ea&&ea.rerenderAnnotations()};this.getSizer=function(){return U};this.enableAnnotations=function(a){a!==L&&(L=a,P&&V(P.rootElement))};this.addAnnotation=
function(a){ea&&ea.addAnnotation(a)};this.forgetAnnotations=function(){ea&&ea.forgetAnnotations()};this.setZoomLevel=function(a){W=a;A()};this.getZoomLevel=function(){return W};this.fitToContainingElement=function(a,b){var c=m.offsetHeight/W;W=a/(m.offsetWidth/W);b/c<W&&(W=b/c);A()};this.fitToWidth=function(a){W=a/(m.offsetWidth/W);A()};this.fitSmart=function(a,b){var c,d;c=m.offsetWidth/W;d=m.offsetHeight/W;c=a/c;void 0!==b&&b/d<c&&(c=b/d);W=Math.min(1,c);A()};this.fitToHeight=function(a){W=a/(m.offsetHeight/
W);A()};this.showFirstPage=function(){da.showFirstPage()};this.showNextPage=function(){da.showNextPage()};this.showPreviousPage=function(){da.showPreviousPage()};this.showPage=function(a){da.showPage(a);A()};this.getElement=function(){return m};this.addCssForFrameWithImage=function(a){var b=a.getAttributeNS(x,"name");d(b,a,G.sheet);h(b+"img",P,a.firstChild,G.sheet)};this.destroy=function(a){var b=R.getElementsByTagName("head")[0];Q&&Q.parentNode&&Q.parentNode.removeChild(Q);U&&m.removeChild(U);b.removeChild(la);
b.removeChild(F);b.removeChild(ga);b.removeChild(G);ka.destroy(function(b){b?a(b):da.destroy(a)})};la=v(R);da=new g(y(R));F=y(R);ga=y(R);G=y(R)};return odf.OdfCanvas}();
runtime.loadClass("odf.OdfCanvas");
odf.CommandLineTools=function(){this.roundTrip=function(f,g,c){return new odf.OdfContainer(f,function(m){if(m.state===odf.OdfContainer.INVALID)return c("Document "+f+" is invalid.");m.state===odf.OdfContainer.DONE?m.saveAs(g,function(f){c(f)}):c("Document was not completely loaded.")})};this.render=function(f,g,c){for(g=g.getElementsByTagName("body")[0];g.firstChild;)g.removeChild(g.firstChild);g=new odf.OdfCanvas(g);g.addListener("statereadychange",function(f){c(f)});g.load(f)}};
ops.Server=function(){};ops.Server.prototype.connect=function(f,g){};ops.Server.prototype.networkStatus=function(){};ops.Server.prototype.login=function(f,g,c,m){};ops.Server.prototype.joinSession=function(f,g,c,m){};ops.Server.prototype.leaveSession=function(f,g,c,m){};ops.Server.prototype.getGenesisUrl=function(f){};
ops.Operation=function(){};ops.Operation.prototype.init=function(f){};ops.Operation.prototype.execute=function(f){};ops.Operation.prototype.spec=function(){};
ops.OpAddCursor=function(){var f,g;this.init=function(c){f=c.memberid;g=c.timestamp};this.execute=function(c){var g=c.getCursor(f);if(g)return!1;g=new ops.OdtCursor(f,c);c.addCursor(g);c.emit(ops.OdtDocument.signalCursorAdded,g);return!0};this.spec=function(){return{optype:"AddCursor",memberid:f,timestamp:g}}};
runtime.loadClass("core.DomUtils");runtime.loadClass("odf.Namespaces");runtime.loadClass("odf.OdfUtils");
gui.StyleHelper=function(f){function g(b,a,c){var d=!0,f;for(f=0;f<b.length&&!(d=b[f]["style:text-properties"],d=!d||d[a]!==c);f+=1);return!d}function c(b,a,c){b=l.getParagraphElements(b);for(var d={},g=!1,h,m;0<b.length;){(h=b[0].getAttributeNS(q,"style-name"))?d[h]||(m=f.getStyleElement(h,"paragraph"),d[h]=!0):g?m=void 0:(g=!0,m=f.getDefaultStyleElement("paragraph"));if(m&&(h=f.getInheritedStyleAttributes(m,!0),(h=h["style:paragraph-properties"])&&-1===c.indexOf(h[a])))return!1;b.pop()}return!0}
var m=new core.DomUtils,l=new odf.OdfUtils,q=odf.Namespaces.textns;this.getAppliedStyles=function(b){var a;b.collapsed?(a=b.startContainer,a.hasChildNodes()&&b.startOffset<a.childNodes.length&&(a=a.childNodes[b.startOffset]),b=[a]):b=l.getTextNodes(b,!0);return f.getAppliedStyles(b)};this.applyStyle=function(b,a,c){var d=m.splitBoundaries(a),g=l.getTextNodes(a,!1);f.applyStyle(b,g,{startContainer:a.startContainer,startOffset:a.startOffset,endContainer:a.endContainer,endOffset:a.endOffset},c);d.forEach(m.normalizeTextNodes)};
this.isBold=function(b){return g(b,"fo:font-weight","bold")};this.isItalic=function(b){return g(b,"fo:font-style","italic")};this.hasUnderline=function(b){return g(b,"style:text-underline-style","solid")};this.hasStrikeThrough=function(b){return g(b,"style:text-line-through-style","solid")};this.isAlignedLeft=function(b){return c(b,"fo:text-align",["left","start"])};this.isAlignedCenter=function(b){return c(b,"fo:text-align",["center"])};this.isAlignedRight=function(b){return c(b,"fo:text-align",
["right","end"])};this.isAlignedJustified=function(b){return c(b,"fo:text-align",["justify"])}};
runtime.loadClass("gui.StyleHelper");runtime.loadClass("odf.OdfUtils");
ops.OpApplyDirectStyling=function(){function f(a){var b=0<=l?m+l:m,c=a.getIteratorAtPosition(0<=l?m:m+l),b=l?a.getIteratorAtPosition(b):c;a=a.getDOM().createRange();a.setStart(c.container(),c.unfilteredDomOffset());a.setEnd(b.container(),b.unfilteredDomOffset());return a}var g,c,m,l,q,b=new odf.OdfUtils;this.init=function(a){g=a.memberid;c=a.timestamp;m=parseInt(a.position,10);l=parseInt(a.length,10);q=a.setProperties};this.execute=function(a){var e=f(a),d=b.getImpactedParagraphs(e);(new gui.StyleHelper(a.getFormatting())).applyStyle(g,
e,q);e.detach();a.getOdfCanvas().refreshCSS();a.fixCursorPositions();d.forEach(function(b){a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:b,memberId:g,timeStamp:c})});a.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"ApplyDirectStyling",memberid:g,timestamp:c,position:m,length:l,setProperties:q}}};
ops.OpRemoveCursor=function(){var f,g;this.init=function(c){f=c.memberid;g=c.timestamp};this.execute=function(c){return c.removeCursor(f)?!0:!1};this.spec=function(){return{optype:"RemoveCursor",memberid:f,timestamp:g}}};
ops.OpMoveCursor=function(){var f,g,c,m,l;this.init=function(q){f=q.memberid;g=q.timestamp;c=q.position;m=q.length||0;l=q.selectionType||ops.OdtCursor.RangeSelection};this.execute=function(g){var b=g.getCursor(f),a=g.getCursorPosition(f),e=g.getPositionFilter(),d=c-a;if(!b)return!1;a=b.getStepCounter();d=a.countSteps(d,e);b.move(d);m&&(e=a.countSteps(m,e),b.move(e,!0));b.setSelectionType(l);g.emit(ops.OdtDocument.signalCursorMoved,b);return!0};this.spec=function(){return{optype:"MoveCursor",memberid:f,
timestamp:g,position:c,length:m,selectionType:l}}};
ops.OpSetBlob=function(){var f,g,c,m,l;this.init=function(q){f=q.memberid;g=q.timestamp;c=q.filename;m=q.mimetype;l=q.content};this.execute=function(f){f.getOdfCanvas().odfContainer().setBlob(c,m,l);return!0};this.spec=function(){return{optype:"SetBlob",memberid:f,timestamp:g,filename:c,mimetype:m,content:l}}};
ops.OpRemoveBlob=function(){var f,g,c;this.init=function(m){f=m.memberid;g=m.timestamp;c=m.filename};this.execute=function(f){f.getOdfCanvas().odfContainer().removeBlob(c);return!0};this.spec=function(){return{optype:"RemoveBlob",memberid:f,timestamp:g,filename:c}}};
ops.OpInsertImage=function(){var f,g,c,m,l,q,b,a,e=odf.Namespaces.drawns,d=odf.Namespaces.svgns,r=odf.Namespaces.textns,h=odf.Namespaces.xlinkns;this.init=function(d){f=d.memberid;g=d.timestamp;c=d.position;m=d.filename;l=d.frameWidth;q=d.frameHeight;b=d.frameStyleName;a=d.frameName};this.execute=function(p){var k=p.getOdfCanvas(),n=p.getPositionInTextNode(c,f),t,w;if(!n)return!1;t=n.textNode;w=p.getParagraphElement(t);var n=n.offset!==t.length?t.splitText(n.offset):t.nextSibling,v=p.getDOM(),y=v.createElementNS(e,
"draw:image"),v=v.createElementNS(e,"draw:frame");y.setAttributeNS(h,"xlink:href",m);y.setAttributeNS(h,"xlink:type","simple");y.setAttributeNS(h,"xlink:show","embed");y.setAttributeNS(h,"xlink:actuate","onLoad");v.setAttributeNS(e,"draw:style-name",b);v.setAttributeNS(e,"draw:name",a);v.setAttributeNS(r,"text:anchor-type","as-char");v.setAttributeNS(d,"svg:width",l);v.setAttributeNS(d,"svg:height",q);v.appendChild(y);t.parentNode.insertBefore(v,n);0===t.length&&t.parentNode.removeChild(t);k.addCssForFrameWithImage(v);
k.refreshCSS();p.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:w,memberId:f,timeStamp:g});k.rerenderAnnotations();return!0};this.spec=function(){return{optype:"InsertImage",memberid:f,timestamp:g,filename:m,position:c,frameWidth:l,frameHeight:q,frameStyleName:b,frameName:a}}};
ops.OpInsertTable=function(){function f(a,b){var c;if(1===d.length)c=d[0];else if(3===d.length)switch(a){case 0:c=d[0];break;case m-1:c=d[2];break;default:c=d[1]}else c=d[a];if(1===c.length)return c[0];if(3===c.length)switch(b){case 0:return c[0];case l-1:return c[2];default:return c[1]}return c[b]}var g,c,m,l,q,b,a,e,d;this.init=function(f){g=f.memberid;c=f.timestamp;q=f.position;m=f.initialRows;l=f.initialColumns;b=f.tableName;a=f.tableStyleName;e=f.tableColumnStyleName;d=f.tableCellStyleMatrix};
this.execute=function(d){var h=d.getPositionInTextNode(q),p=d.getRootNode();if(h){var k=d.getDOM(),n=k.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),t=k.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column"),w,v,y,x;a&&n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",a);b&&n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",b);t.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0",
"table:number-columns-repeated",l);e&&t.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",e);n.appendChild(t);for(y=0;y<m;y+=1){t=k.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row");for(x=0;x<l;x+=1)w=k.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(v=f(y,x))&&w.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",v),v=k.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0",
"text:p"),w.appendChild(v),t.appendChild(w);n.appendChild(t)}h=d.getParagraphElement(h.textNode);p.insertBefore(n,h.nextSibling);d.getOdfCanvas().refreshSize();d.emit(ops.OdtDocument.signalTableAdded,{tableElement:n,memberId:g,timeStamp:c});d.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertTable",memberid:g,timestamp:c,position:q,initialRows:m,initialColumns:l,tableName:b,tableStyleName:a,tableColumnStyleName:e,tableCellStyleMatrix:d}}};
ops.OpInsertText=function(){var f,g,c,m;this.init=function(l){f=l.memberid;g=l.timestamp;c=l.position;m=l.text};this.execute=function(l){var q,b,a,e=null,d=l.getDOM(),r,h=0,p,k;l.upgradeWhitespacesAtPosition(c);if(q=l.getPositionInTextNode(c,f)){b=q.textNode;e=b.nextSibling;a=b.parentNode;r=l.getParagraphElement(b);for(k=0;k<m.length;k+=1)if(" "===m[k]&&(0===k||" "===m[k-1])||"\t"===m[k])0===h?(q.offset!==b.length&&(e=b.splitText(q.offset)),0<k&&b.appendData(m.substring(0,k))):h<k&&(h=m.substring(h,
k),a.insertBefore(d.createTextNode(h),e)),h=k+1,p=" "===m[k]?"text:s":"text:tab",p=d.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0",p),p.appendChild(d.createTextNode(m[k])),a.insertBefore(p,e);0===h?b.insertData(q.offset,m):h<m.length&&(q=m.substring(h),a.insertBefore(d.createTextNode(q),e));a=b.parentNode;e=b.nextSibling;a.removeChild(b);a.insertBefore(b,e);0===b.length&&b.parentNode.removeChild(b);0<c&&(l.downgradeWhitespacesAtPosition(c-1),1<c&&l.downgradeWhitespacesAtPosition(c-
2));l.downgradeWhitespacesAtPosition(c);l.downgradeWhitespacesAtPosition(c+m.length);l.getOdfCanvas().refreshSize();l.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:r,memberId:f,timeStamp:g});l.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertText",memberid:f,timestamp:g,position:c,text:m}}};
runtime.loadClass("odf.Namespaces");runtime.loadClass("odf.OdfUtils");runtime.loadClass("core.DomUtils");
ops.OpRemoveText=function(){function f(c){function e(a){return d.hasOwnProperty(a.namespaceURI)||"br"===a.localName&&b.isLineBreak(a.parentNode)||a.nodeType===Node.TEXT_NODE&&d.hasOwnProperty(a.parentNode.namespaceURI)}function f(a){if(b.isCharacterElement(a))return!1;if(a.nodeType===Node.TEXT_NODE)return 0===a.textContent.length;for(a=a.firstChild;a;){if(d.hasOwnProperty(a.namespaceURI)||!f(a))return!1;a=a.nextSibling}return!0}function g(d){var l;d.nodeType===Node.TEXT_NODE?(l=d.parentNode,l.removeChild(d)):
l=a.removeUnwantedNodes(d,e);return!b.isParagraph(l)&&l!==c&&f(l)?g(l):l}this.isEmpty=f;this.mergeChildrenIntoParent=g}function g(b){var c=b.getPositionFilter(),d,f,g,m,w=q,v=b.getDOM().createRange();b=b.getIteratorAtPosition(l);d=b.container();for(f=b.unfilteredDomOffset();w&&b.nextPosition();)g=b.container(),m=b.unfilteredDomOffset(),c.acceptPosition(b)===e&&(w-=1);v.setStart(d,f);v.setEnd(g,m);a.splitBoundaries(v);return v}var c,m,l,q,b,a,e=core.PositionFilter.FilterResult.FILTER_ACCEPT,d={};this.init=
function(e){runtime.assert(0<=e.length,"OpRemoveText only supports positive lengths");c=e.memberid;m=e.timestamp;l=parseInt(e.position,10);q=parseInt(e.length,10);b=new odf.OdfUtils;a=new core.DomUtils;d[odf.Namespaces.dbns]=!0;d[odf.Namespaces.dcns]=!0;d[odf.Namespaces.dr3dns]=!0;d[odf.Namespaces.drawns]=!0;d[odf.Namespaces.chartns]=!0;d[odf.Namespaces.formns]=!0;d[odf.Namespaces.numberns]=!0;d[odf.Namespaces.officens]=!0;d[odf.Namespaces.presentationns]=!0;d[odf.Namespaces.stylens]=!0;d[odf.Namespaces.svgns]=
!0;d[odf.Namespaces.tablens]=!0;d[odf.Namespaces.textns]=!0};this.execute=function(a){var d,e,k,n,t=a.getCursor(c),w=new f(a.getRootNode());a.upgradeWhitespacesAtPosition(l);a.upgradeWhitespacesAtPosition(l+q);e=g(a);d=a.getParagraphElement(e.startContainer);k=b.getTextElements(e,!0);n=b.getParagraphElements(e);e.detach();k.forEach(function(a){w.mergeChildrenIntoParent(a)});e=n.reduce(function(a,b){var c,d=!1,e=a,f=b,g,h=null;w.isEmpty(a)&&(d=!0,b.parentNode!==a.parentNode&&(g=b.parentNode,a.parentNode.insertBefore(b,
a.nextSibling)),f=a,e=b,h=e.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo")[0]||e.firstChild);for(;f.hasChildNodes();)c=d?f.lastChild:f.firstChild,f.removeChild(c),"editinfo"!==c.localName&&e.insertBefore(c,h);g&&w.isEmpty(g)&&w.mergeChildrenIntoParent(g);w.mergeChildrenIntoParent(f);return e});a.downgradeWhitespacesAtPosition(l);a.fixCursorPositions();a.getOdfCanvas().refreshSize();a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:e||d,memberId:c,timeStamp:m});t&&(t.resetSelectionType(),
a.emit(ops.OdtDocument.signalCursorMoved,t));a.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveText",memberid:c,timestamp:m,position:l,length:q}}};
ops.OpSplitParagraph=function(){var f,g,c,m;this.init=function(l){f=l.memberid;g=l.timestamp;c=l.position;m=new odf.OdfUtils};this.execute=function(l){var q,b,a,e,d,r,h;l.upgradeWhitespacesAtPosition(c);q=l.getPositionInTextNode(c,f);if(!q)return!1;b=l.getParagraphElement(q.textNode);if(!b)return!1;a=m.isListItem(b.parentNode)?b.parentNode:b;0===q.offset?(h=q.textNode.previousSibling,r=null):(h=q.textNode,r=q.offset>=q.textNode.length?null:q.textNode.splitText(q.offset));for(e=q.textNode;e!==a;)if(e=
e.parentNode,d=e.cloneNode(!1),h){for(r&&d.appendChild(r);h.nextSibling;)d.appendChild(h.nextSibling);e.parentNode.insertBefore(d,e.nextSibling);h=e;r=d}else e.parentNode.insertBefore(d,e),h=d,r=e;m.isListItem(r)&&(r=r.childNodes[0]);0===q.textNode.length&&q.textNode.parentNode.removeChild(q.textNode);l.fixCursorPositions();l.getOdfCanvas().refreshSize();l.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:b,memberId:f,timeStamp:g});l.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:r,
memberId:f,timeStamp:g});l.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"SplitParagraph",memberid:f,timestamp:g,position:c}}};
ops.OpSetParagraphStyle=function(){var f,g,c,m;this.init=function(l){f=l.memberid;g=l.timestamp;c=l.position;m=l.styleName};this.execute=function(l){var q;q=l.getIteratorAtPosition(c);return(q=l.getParagraphElement(q.container()))?(""!==m?q.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",m):q.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),l.getOdfCanvas().refreshSize(),l.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:q,
timeStamp:g,memberId:f}),l.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"SetParagraphStyle",memberid:f,timestamp:g,position:c,styleName:m}}};
runtime.loadClass("odf.Namespaces");
ops.OpUpdateParagraphStyle=function(){function f(a,b){var c,f,g=b?b.split(","):[];for(c=0;c<g.length;c+=1)f=g[c].split(":"),a.removeAttributeNS(odf.Namespaces.resolvePrefix(f[0]),f[1])}var g,c,m,l,q,b=odf.Namespaces.stylens;this.init=function(a){g=a.memberid;c=a.timestamp;m=a.styleName;l=a.setProperties;q=a.removedProperties};this.execute=function(a){var c=a.getFormatting(),d,g,h;return(d=""!==m?a.getParagraphStyleElement(m):c.getDefaultStyleElement("paragraph"))?(g=d.getElementsByTagNameNS(b,"paragraph-properties")[0],
h=d.getElementsByTagNameNS(b,"text-properties")[0],l&&c.updateStyle(d,l),q&&(q["style:paragraph-properties"]&&(f(g,q["style:paragraph-properties"].attributes),0===g.attributes.length&&d.removeChild(g)),q["style:text-properties"]&&(f(h,q["style:text-properties"].attributes),0===h.attributes.length&&d.removeChild(h)),f(d,q.attributes)),a.getOdfCanvas().refreshCSS(),a.emit(ops.OdtDocument.signalParagraphStyleModified,m),a.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"UpdateParagraphStyle",
memberid:g,timestamp:c,styleName:m,setProperties:l,removedProperties:q}}};
runtime.loadClass("odf.Namespaces");
ops.OpAddStyle=function(){var f,g,c,m,l,q,b=odf.Namespaces.stylens;this.init=function(a){f=a.memberid;g=a.timestamp;c=a.styleName;m=a.styleFamily;l="true"===a.isAutomaticStyle||!0===a.isAutomaticStyle;q=a.setProperties};this.execute=function(a){var e=a.getOdfCanvas().odfContainer(),d=a.getFormatting(),f=a.getDOM().createElementNS(b,"style:style");if(!f)return!1;q&&d.updateStyle(f,q);f.setAttributeNS(b,"style:family",m);f.setAttributeNS(b,"style:name",c);l?e.rootElement.automaticStyles.appendChild(f):e.rootElement.styles.appendChild(f);
a.getOdfCanvas().refreshCSS();l||a.emit(ops.OdtDocument.signalCommonStyleCreated,{name:c,family:m});return!0};this.spec=function(){return{optype:"AddStyle",memberid:f,timestamp:g,styleName:c,styleFamily:m,isAutomaticStyle:l,setProperties:q}}};
ops.OpRemoveStyle=function(){var f,g,c,m;this.init=function(l){f=l.memberid;g=l.timestamp;c=l.styleName;m=l.styleFamily};this.execute=function(f){var g=f.getStyleElement(c,m);if(!g)return!1;g.parentNode.removeChild(g);f.getOdfCanvas().refreshCSS();f.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:c,family:m});return!0};this.spec=function(){return{optype:"RemoveStyle",memberid:f,timestamp:g,styleName:c,styleFamily:m}}};
ops.OpAddAnnotation=function(){function f(b,a,c){var d=b.getPositionInTextNode(c,g);d&&(b=d.textNode,c=b.parentNode,d.offset!==b.length&&b.splitText(d.offset),c.insertBefore(a,b.nextSibling),0===b.length&&c.removeChild(b))}var g,c,m,l,q;this.init=function(b){g=b.memberid;c=parseInt(b.timestamp,10);m=parseInt(b.position,10);l=parseInt(b.length,10)||0;q=b.name};this.execute=function(b){var a={},e=b.getPositionFilter(),d=b.getCursor(g),r=b.getCursorPosition(g),r=m-r-1,h=new Date(c),p,k,n,t,w;w=b.getDOM();
p=w.createElementNS(odf.Namespaces.officens,"office:annotation");p.setAttributeNS(odf.Namespaces.officens,"office:name",q);k=w.createElementNS(odf.Namespaces.dcns,"dc:creator");k.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g);n=w.createElementNS(odf.Namespaces.dcns,"dc:date");n.appendChild(w.createTextNode(h.toISOString()));h=w.createElementNS(odf.Namespaces.textns,"text:list");t=w.createElementNS(odf.Namespaces.textns,"text:list-item");w=w.createElementNS(odf.Namespaces.textns,
"text:p");t.appendChild(w);h.appendChild(t);p.appendChild(k);p.appendChild(n);p.appendChild(h);a.node=p;if(!a.node)return!1;if(l){p=b.getDOM().createElementNS(odf.Namespaces.officens,"office:annotation-end");p.setAttributeNS(odf.Namespaces.officens,"office:name",q);a.end=p;if(!a.end)return!1;f(b,a.end,m+l)}f(b,a.node,m);d&&(e=d.getStepCounter().countSteps(r,e),d.move(e),d.resetSelectionType(),b.emit(ops.OdtDocument.signalCursorMoved,d));b.getOdfCanvas().addAnnotation(a);b.fixCursorPositions();return!0};
this.spec=function(){return{optype:"AddAnnotation",memberid:g,timestamp:c,position:m,length:l,name:q}}};
runtime.loadClass("odf.Namespaces");runtime.loadClass("core.DomUtils");
ops.OpRemoveAnnotation=function(){var f,g,c,m,l;this.init=function(q){f=q.memberid;g=q.timestamp;c=parseInt(q.position,10);m=parseInt(q.length,10);l=new core.DomUtils};this.execute=function(f){for(var b=f.getIteratorAtPosition(c).container(),a,e=null,d=null;b.namespaceURI!==odf.Namespaces.officens||"annotation"!==b.localName;)b=b.parentNode;if(null===b)return!1;e=b;(a=e.getAttributeNS(odf.Namespaces.officens,"name"))&&(d=l.getElementsByTagNameNS(f.getRootNode(),odf.Namespaces.officens,"annotation-end").filter(function(b){return a===
b.getAttributeNS(odf.Namespaces.officens,"name")})[0]||null);f.getOdfCanvas().forgetAnnotations();for(b=l.getElementsByTagNameNS(e,"urn:webodf:names:cursor","cursor");b.length;)e.parentNode.insertBefore(b.pop(),e);e.parentNode.removeChild(e);d&&d.parentNode.removeChild(d);f.fixCursorPositions();f.getOdfCanvas().refreshAnnotations();return!0};this.spec=function(){return{optype:"RemoveAnnotation",memberid:f,timestamp:g,position:c,length:m}}};
runtime.loadClass("ops.OpAddCursor");runtime.loadClass("ops.OpApplyDirectStyling");runtime.loadClass("ops.OpRemoveCursor");runtime.loadClass("ops.OpMoveCursor");runtime.loadClass("ops.OpSetBlob");runtime.loadClass("ops.OpRemoveBlob");runtime.loadClass("ops.OpInsertImage");runtime.loadClass("ops.OpInsertTable");runtime.loadClass("ops.OpInsertText");runtime.loadClass("ops.OpRemoveText");runtime.loadClass("ops.OpSplitParagraph");runtime.loadClass("ops.OpSetParagraphStyle");runtime.loadClass("ops.OpUpdateParagraphStyle");
runtime.loadClass("ops.OpAddStyle");runtime.loadClass("ops.OpRemoveStyle");runtime.loadClass("ops.OpAddAnnotation");runtime.loadClass("ops.OpRemoveAnnotation");
ops.OperationFactory=function(){function f(c){return function(){return new c}}var g;this.register=function(c,f){g[c]=f};this.create=function(c){var f=null,l=g[c.optype];l&&(f=l(c),f.init(c));return f};g={AddCursor:f(ops.OpAddCursor),ApplyDirectStyling:f(ops.OpApplyDirectStyling),SetBlob:f(ops.OpSetBlob),RemoveBlob:f(ops.OpRemoveBlob),InsertImage:f(ops.OpInsertImage),InsertTable:f(ops.OpInsertTable),InsertText:f(ops.OpInsertText),RemoveText:f(ops.OpRemoveText),SplitParagraph:f(ops.OpSplitParagraph),
SetParagraphStyle:f(ops.OpSetParagraphStyle),UpdateParagraphStyle:f(ops.OpUpdateParagraphStyle),AddStyle:f(ops.OpAddStyle),RemoveStyle:f(ops.OpRemoveStyle),MoveCursor:f(ops.OpMoveCursor),RemoveCursor:f(ops.OpRemoveCursor),AddAnnotation:f(ops.OpAddAnnotation),RemoveAnnotation:f(ops.OpRemoveAnnotation)}};
runtime.loadClass("core.Cursor");runtime.loadClass("core.DomUtils");runtime.loadClass("core.PositionIterator");runtime.loadClass("core.PositionFilter");runtime.loadClass("core.LoopWatchDog");runtime.loadClass("odf.OdfUtils");
gui.SelectionMover=function(f,g){function c(){v.setUnfilteredPosition(f.getNode(),0);return v}function m(a,b){var c,d=null;a&&(c=b?a[a.length-1]:a[0]);c&&(d={top:c.top,left:b?c.right:c.left,bottom:c.bottom});return d}function l(a,b,c,d){var e=a.nodeType;c.setStart(a,b);c.collapse(!d);d=m(c.getClientRects(),!0===d);!d&&0<b&&(c.setStart(a,b-1),c.setEnd(a,b),d=m(c.getClientRects(),!0));d||(e===Node.ELEMENT_NODE&&a.childNodes[b-1]?d=l(a,b-1,c,!0):a.nodeType===Node.TEXT_NODE&&0<b?d=l(a,b-1,c,!0):a.previousSibling?
d=l(a.previousSibling,a.previousSibling.nodeType===Node.TEXT_NODE?a.previousSibling.textContent.length:a.previousSibling.childNodes.length,c,!0):a.parentNode&&a.parentNode!==g?d=l(a.parentNode,0,c,!1):(c.selectNode(g),d=m(c.getClientRects(),!1)));runtime.assert(Boolean(d),"No visible rectangle found");return d}function q(a,b,d){var e=a,h=c(),k,n=g.ownerDocument.createRange(),m=f.getSelectedRange()?f.getSelectedRange().cloneRange():g.ownerDocument.createRange(),p;for(k=l(h.container(),h.unfilteredDomOffset(),
n);0<e&&d();)e-=1;b?(b=h.container(),h=h.unfilteredDomOffset(),-1===m.comparePoint(b,h)?(m.setStart(b,h),p=!1):m.setEnd(b,h)):(m.setStart(h.container(),h.unfilteredDomOffset()),m.collapse(!0));f.setSelectedRange(m,p);h=c();m=l(h.container(),h.unfilteredDomOffset(),n);if(m.top===k.top||void 0===y)y=m.left;runtime.clearTimeout(x);x=runtime.setTimeout(function(){y=void 0},2E3);n.detach();return a-e}function b(a){var b=c();return a.acceptPosition(b)===u&&(b.setUnfilteredPosition(f.getAnchorNode(),0),
a.acceptPosition(b)===u)?!0:!1}function a(a,b,c){for(var d=new core.LoopWatchDog(1E3),e=0,f=0,g=0<=b?1:-1,h=0<=b?a.nextPosition:a.previousPosition;0!==b&&h();)d.check(),f+=g,c.acceptPosition(a)===u&&(b-=g,e+=f,f=0);return e}function e(a,b,d){for(var e=c(),f=new core.LoopWatchDog(1E3),g=0,h=0;0<a&&e.nextPosition();)f.check(),d.acceptPosition(e)===u&&(g+=1,b.acceptPosition(e)===u&&(h+=g,g=0,a-=1));return h}function d(a,b,d){for(var e=c(),f=new core.LoopWatchDog(1E3),g=0,h=0;0<a&&e.previousPosition();)f.check(),
d.acceptPosition(e)===u&&(g+=1,b.acceptPosition(e)===u&&(h+=g,g=0,a-=1));return h}function r(b,d){var e=c();return a(e,b,d)}function h(b,d,e){var f=c(),g=t.getParagraphElement(f.getCurrentNode()),h=0;f.setUnfilteredPosition(b,d);e.acceptPosition(f)!==u&&(h=a(f,-1,e),0===h||g&&g!==t.getParagraphElement(f.getCurrentNode()))&&(f.setUnfilteredPosition(b,d),h=a(f,1,e));return h}function p(a,b){var d=c(),e=0,f=0,h=0>a?-1:1;for(a=Math.abs(a);0<a;){for(var k=b,m=h,n=d,p=n.container(),q=0,t=null,r=void 0,
w=10,v=void 0,x=0,Y=void 0,V=void 0,H=void 0,v=void 0,I=g.ownerDocument.createRange(),K=new core.LoopWatchDog(1E3),v=l(p,n.unfilteredDomOffset(),I),Y=v.top,V=void 0===y?v.left:y,H=Y;!0===(0>m?n.previousPosition():n.nextPosition());)if(K.check(),k.acceptPosition(n)===u&&(q+=1,p=n.container(),v=l(p,n.unfilteredDomOffset(),I),v.top!==Y)){if(v.top!==H&&H!==Y)break;H=v.top;v=Math.abs(V-v.left);if(null===t||v<w)t=p,r=n.unfilteredDomOffset(),w=v,x=q}null!==t?(n.setUnfilteredPosition(t,r),q=x):q=0;I.detach();
e+=q;if(0===e)break;f+=e;a-=1}return f*h}function k(a,b){var d,e,f,h,k=c(),n=t.getParagraphElement(k.getCurrentNode()),m=0,p=g.ownerDocument.createRange();0>a?(d=k.previousPosition,e=-1):(d=k.nextPosition,e=1);for(f=l(k.container(),k.unfilteredDomOffset(),p);d.call(k);)if(b.acceptPosition(k)===u){if(t.getParagraphElement(k.getCurrentNode())!==n)break;h=l(k.container(),k.unfilteredDomOffset(),p);if(h.bottom!==f.bottom&&(f=h.top>=f.top&&h.bottom<f.bottom||h.top<=f.top&&h.bottom>f.bottom,!f))break;m+=
e;f=h}p.detach();return m}function n(a,b,d){runtime.assert(null!==a,"SelectionMover.countStepsToPosition called with element===null");var e=c(),f=e.container(),g=e.unfilteredDomOffset(),h=0,k=new core.LoopWatchDog(1E3);for(e.setUnfilteredPosition(a,b);d.acceptPosition(e)!==u&&e.previousPosition();)k.check();a=e.container();runtime.assert(Boolean(a),"SelectionMover.countStepsToPosition: positionIterator.container() returned null");b=e.unfilteredDomOffset();for(e.setUnfilteredPosition(f,g);d.acceptPosition(e)!==
u&&e.previousPosition();)k.check();f=w.comparePoints(a,b,e.container(),e.unfilteredDomOffset());if(0>f)for(;e.nextPosition()&&(k.check(),d.acceptPosition(e)===u&&(h+=1),e.container()!==a||e.unfilteredDomOffset()!==b););else if(0<f)for(;e.previousPosition()&&(k.check(),d.acceptPosition(e)!==u||(h-=1,e.container()!==a||e.unfilteredDomOffset()!==b)););return h}var t,w,v,y,x,u=core.PositionFilter.FilterResult.FILTER_ACCEPT;this.movePointForward=function(a,b){return q(a,b||!1,v.nextPosition)};this.movePointBackward=
function(a,b){return q(a,b||!1,v.previousPosition)};this.getStepCounter=function(){return{countSteps:r,convertForwardStepsBetweenFilters:e,convertBackwardStepsBetweenFilters:d,countLinesSteps:p,countStepsToLineBoundary:k,countStepsToPosition:n,isPositionWalkable:b,countPositionsToNearestStep:h}};(function(){t=new odf.OdfUtils;w=new core.DomUtils;v=gui.SelectionMover.createPositionIterator(g);var a=g.ownerDocument.createRange();a.setStart(v.container(),v.unfilteredDomOffset());a.collapse(!0);f.setSelectedRange(a)})()};
gui.SelectionMover.createPositionIterator=function(f){var g=new function(){this.acceptNode=function(c){return"urn:webodf:names:cursor"===c.namespaceURI||"urn:webodf:names:editinfo"===c.namespaceURI?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};return new core.PositionIterator(f,5,g,!1)};(function(){return gui.SelectionMover})();
runtime.loadClass("core.Cursor");runtime.loadClass("gui.SelectionMover");
ops.OdtCursor=function(f,g){var c=this,m={},l,q,b;this.removeFromOdtDocument=function(){b.remove()};this.move=function(a,b){var d=0;0<a?d=q.movePointForward(a,b):0>=a&&(d=-q.movePointBackward(-a,b));c.handleUpdate();return d};this.handleUpdate=function(){};this.getStepCounter=function(){return q.getStepCounter()};this.getMemberId=function(){return f};this.getNode=function(){return b.getNode()};this.getAnchorNode=function(){return b.getAnchorNode()};this.getSelectedRange=function(){return b.getSelectedRange()};
this.setSelectedRange=function(a,c){b.setSelectedRange(a,c)};this.hasForwardSelection=function(){return b.hasForwardSelection()};this.getOdtDocument=function(){return g};this.getSelectionType=function(){return l};this.setSelectionType=function(a){m.hasOwnProperty(a)?l=a:runtime.log("Invalid selection type: "+a)};this.resetSelectionType=function(){c.setSelectionType(ops.OdtCursor.RangeSelection)};b=new core.Cursor(g.getDOM(),f);q=new gui.SelectionMover(b,g.getRootNode());m[ops.OdtCursor.RangeSelection]=
!0;m[ops.OdtCursor.RegionSelection]=!0;c.resetSelectionType()};ops.OdtCursor.RangeSelection="Range";ops.OdtCursor.RegionSelection="Region";(function(){return ops.OdtCursor})();
ops.EditInfo=function(f,g){function c(){var c=[],b;for(b in l)l.hasOwnProperty(b)&&c.push({memberid:b,time:l[b].time});c.sort(function(a,b){return a.time-b.time});return c}var m,l={};this.getNode=function(){return m};this.getOdtDocument=function(){return g};this.getEdits=function(){return l};this.getSortedEdits=function(){return c()};this.addEdit=function(c,b){l[c]={time:b}};this.clearEdits=function(){l={}};this.destroy=function(c){f.parentNode&&f.removeChild(m);c()};m=g.getDOM().createElementNS("urn:webodf:names:editinfo",
"editinfo");f.insertBefore(m,f.firstChild)};
runtime.loadClass("gui.SelectionMover");gui.ShadowCursor=function(f){var g=f.getDOM().createRange(),c=!0;this.removeFromOdtDocument=function(){};this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId};this.getSelectedRange=function(){return g};this.setSelectedRange=function(f,l){g=f;c=!1!==l};this.hasForwardSelection=function(){return c};this.getOdtDocument=function(){return f};g.setStart(f.getRootNode(),0)};gui.ShadowCursor.ShadowCursorMemberId="";(function(){return gui.ShadowCursor})();
gui.Avatar=function(f,g){var c=this,m,l,q;this.setColor=function(b){l.style.borderColor=b};this.setImageUrl=function(b){c.isVisible()?l.src=b:q=b};this.isVisible=function(){return"block"===m.style.display};this.show=function(){q&&(l.src=q,q=void 0);m.style.display="block"};this.hide=function(){m.style.display="none"};this.markAsFocussed=function(b){m.className=b?"active":""};this.destroy=function(b){f.removeChild(m);b()};(function(){var b=f.ownerDocument,a=b.documentElement.namespaceURI;m=b.createElementNS(a,
"div");l=b.createElementNS(a,"img");l.width=64;l.height=64;m.appendChild(l);m.style.width="64px";m.style.height="70px";m.style.position="absolute";m.style.top="-80px";m.style.left="-34px";m.style.display=g?"block":"none";f.appendChild(m)})()};
runtime.loadClass("core.DomUtils");runtime.loadClass("gui.Avatar");runtime.loadClass("ops.OdtCursor");
gui.Caret=function(f,g,c){function m(a){r&&e.parentNode&&(!h||a)&&(a&&void 0!==p&&runtime.clearTimeout(p),h=!0,b.style.opacity=a||"0"===b.style.opacity?"1":"0",p=runtime.setTimeout(function(){h=!1;m(!1)},500))}function l(a,b){var c=a.getBoundingClientRect(),d=0,e=0;c&&b&&(d=Math.max(c.top,b.top),e=Math.min(c.bottom,b.bottom));return e-d}function q(){var a,c=f.getSelectedRange().cloneRange();a=f.getNode();var e,g;a.previousSibling&&(g=a.previousSibling.nodeType===Node.TEXT_NODE?a.previousSibling.textContent.length:
a.previousSibling.childNodes.length,c.setStart(a.previousSibling,0<g?g-1:0),c.setEnd(a.previousSibling,g),g=(e=c.getClientRects())&&e[e.length-1]);a.nextSibling&&(c.setStart(a.nextSibling,0),c.setEnd(a.nextSibling,0<(a.nextSibling.nodeType===Node.TEXT_NODE?a.nextSibling.textContent.length:a.nextSibling.childNodes.length)?1:0),(c=(e=c.getClientRects())&&e[0])&&(!g||l(a,c)>l(a,g))&&(g=c));a=g;c=f.getOdtDocument().getOdfCanvas().getZoomLevel();d&&f.getSelectionType()===ops.OdtCursor.RangeSelection?b.style.visibility=
"visible":b.style.visibility="hidden";a?(b.style.top="0",g=b.ownerDocument.createRange(),g.selectNode(b),e=g.getBoundingClientRect(),g.detach(),8>a.height&&(a={top:a.top-(8-a.height)/2,height:8}),b.style.height=k.adaptRangeDifferenceToZoomLevel(a.height,c)+"px",b.style.top=k.adaptRangeDifferenceToZoomLevel(a.top-e.top,c)+"px"):(b.style.height="1em",b.style.top="5%")}var b,a,e,d=!0,r=!1,h=!1,p,k=new core.DomUtils;this.handleUpdate=q;this.refreshCursorBlinking=function(){c||f.getSelectedRange().collapsed?
(r=!0,m(!0)):(r=!1,b.style.opacity="0")};this.setFocus=function(){r=!0;a.markAsFocussed(!0);m(!0)};this.removeFocus=function(){r=!1;a.markAsFocussed(!1);b.style.opacity="1"};this.show=function(){d=!0;q();a.markAsFocussed(!0)};this.hide=function(){d=!1;q();a.markAsFocussed(!1)};this.setAvatarImageUrl=function(b){a.setImageUrl(b)};this.setColor=function(c){b.style.borderColor=c;a.setColor(c)};this.getCursor=function(){return f};this.getFocusElement=function(){return b};this.toggleHandleVisibility=function(){a.isVisible()?
a.hide():a.show()};this.showHandle=function(){a.show()};this.hideHandle=function(){a.hide()};this.ensureVisible=function(){var a,c,d,e,g=f.getOdtDocument().getOdfCanvas().getElement().parentNode,h;d=g.offsetWidth-g.clientWidth+5;e=g.offsetHeight-g.clientHeight+5;h=b.getBoundingClientRect();a=h.left-d;c=h.top-e;d=h.right+d;e=h.bottom+e;h=g.getBoundingClientRect();c<h.top?g.scrollTop-=h.top-c:e>h.bottom&&(g.scrollTop+=e-h.bottom);a<h.left?g.scrollLeft-=h.left-a:d>h.right&&(g.scrollLeft+=d-h.right);
q()};this.destroy=function(c){a.destroy(function(a){a?c(a):(e.removeChild(b),c())})};(function(){var c=f.getOdtDocument().getDOM();b=c.createElementNS(c.documentElement.namespaceURI,"span");b.style.top="5%";e=f.getNode();e.appendChild(b);a=new gui.Avatar(e,g);q()})()};
runtime.loadClass("odf.Namespaces");runtime.loadClass("xmldom.LSSerializer");runtime.loadClass("odf.OdfNodeFilter");runtime.loadClass("odf.TextSerializer");
gui.Clipboard=function(){var f,g,c;this.setDataFromRange=function(c,l){var q=!0,b,a=c.clipboardData;b=runtime.getWindow();var e=l.startContainer.ownerDocument;!a&&b&&(a=b.clipboardData);a?(e=e.createElement("span"),e.appendChild(l.cloneContents()),b=a.setData("text/plain",g.writeToString(e)),q=q&&b,b=a.setData("text/html",f.writeToString(e,odf.Namespaces.namespaceMap)),q=q&&b,c.preventDefault()):q=!1;return q};f=new xmldom.LSSerializer;g=new odf.TextSerializer;c=new odf.OdfNodeFilter;f.filter=c;g.filter=
c};
runtime.loadClass("core.EventNotifier");runtime.loadClass("core.Utils");runtime.loadClass("ops.OpApplyDirectStyling");runtime.loadClass("gui.StyleHelper");
gui.DirectTextStyler=function(f,g){function c(a,b){for(var c=0,d=b[c];d&&a;)a=a[d],c+=1,d=b[c];return b.length===c?a:void 0}function m(a,b){var d=c(a[0],b);return a.every(function(a){return d===c(a,b)})?d:void 0}function l(){var a=u.getCursor(g),a=(a=a&&a.getSelectedRange())&&s.getAppliedStyles(a)||[];a[0]&&z&&(a[0]=x.mergeObjects(a[0],z));return a}function q(){function a(b,d,e){b!==d&&(void 0===c&&(c={}),c[e]=d);return d}var b,c;E=l();N=a(N,E?s.isBold(E):!1,"isBold");A=a(A,E?s.isItalic(E):!1,"isItalic");
M=a(M,E?s.hasUnderline(E):!1,"hasUnderline");D=a(D,E?s.hasStrikeThrough(E):!1,"hasStrikeThrough");b=E&&m(E,["style:text-properties","fo:font-size"]);O=a(O,b&&parseFloat(b),"fontSize");$=a($,E&&m(E,["style:text-properties","style:font-name"]),"fontName");c&&C.emit(gui.DirectTextStyler.textStylingChanged,c)}function b(a){a.getMemberId()===g&&q()}function a(a){a===g&&q()}function e(a){a.getMemberId()===g&&q()}function d(){q()}function r(a){var b=u.getCursor(g);b&&u.getParagraphElement(b.getNode())===
a.paragraphElement&&q()}function h(a,b){var c=u.getCursor(g);if(!c)return!1;c=s.getAppliedStyles(c.getSelectedRange());b(!a(c));return!0}function p(a){var b=u.getCursorSelection(g),c={"style:text-properties":a};0!==b.length?(a=new ops.OpApplyDirectStyling,a.init({memberid:g,position:b.position,length:b.length,setProperties:c}),f.enqueue([a])):(z=x.mergeObjects(z||{},c),q())}function k(a,b){var c={};c[a]=b;p(c)}function n(a){a=a.spec();z&&a.memberid===g&&"SplitParagraph"!==a.optype&&(z=null,q())}function t(a){k("fo:font-weight",
a?"bold":"normal")}function w(a){k("fo:font-style",a?"italic":"normal")}function v(a){k("style:text-underline-style",a?"solid":"none")}function y(a){k("style:text-line-through-style",a?"solid":"none")}var x=new core.Utils,u=f.getOdtDocument(),s=new gui.StyleHelper(u.getFormatting()),C=new core.EventNotifier([gui.DirectTextStyler.textStylingChanged]),z,E=[],N=!1,A=!1,M=!1,D=!1,O,$;this.formatTextSelection=p;this.createCursorStyleOp=function(a,b){var c=null;z&&(c=new ops.OpApplyDirectStyling,c.init({memberid:g,
position:a,length:b,setProperties:z}),z=null,q());return c};this.setBold=t;this.setItalic=w;this.setHasUnderline=v;this.setHasStrikethrough=y;this.setFontSize=function(a){k("fo:font-size",a+"pt")};this.setFontName=function(a){k("style:font-name",a)};this.getAppliedStyles=function(){return E};this.toggleBold=h.bind(this,s.isBold,t);this.toggleItalic=h.bind(this,s.isItalic,w);this.toggleUnderline=h.bind(this,s.hasUnderline,v);this.toggleStrikethrough=h.bind(this,s.hasStrikeThrough,y);this.isBold=function(){return N};
this.isItalic=function(){return A};this.hasUnderline=function(){return M};this.hasStrikeThrough=function(){return D};this.fontSize=function(){return O};this.fontName=function(){return $};this.subscribe=function(a,b){C.subscribe(a,b)};this.unsubscribe=function(a,b){C.unsubscribe(a,b)};this.destroy=function(c){u.unsubscribe(ops.OdtDocument.signalCursorAdded,b);u.unsubscribe(ops.OdtDocument.signalCursorRemoved,a);u.unsubscribe(ops.OdtDocument.signalCursorMoved,e);u.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,
d);u.unsubscribe(ops.OdtDocument.signalParagraphChanged,r);u.unsubscribe(ops.OdtDocument.signalOperationExecuted,n);c()};u.subscribe(ops.OdtDocument.signalCursorAdded,b);u.subscribe(ops.OdtDocument.signalCursorRemoved,a);u.subscribe(ops.OdtDocument.signalCursorMoved,e);u.subscribe(ops.OdtDocument.signalParagraphStyleModified,d);u.subscribe(ops.OdtDocument.signalParagraphChanged,r);u.subscribe(ops.OdtDocument.signalOperationExecuted,n);q()};gui.DirectTextStyler.textStylingChanged="textStyling/changed";
(function(){return gui.DirectTextStyler})();
runtime.loadClass("core.EventNotifier");runtime.loadClass("core.Utils");runtime.loadClass("odf.OdfUtils");runtime.loadClass("ops.OpAddStyle");runtime.loadClass("ops.OpSetParagraphStyle");runtime.loadClass("gui.StyleHelper");
gui.DirectParagraphStyler=function(f,g,c){function m(){function a(b,d,e){b!==d&&(void 0===c&&(c={}),c[e]=d);return d}var b=k.getCursor(g),b=b&&b.getSelectedRange(),c;y=a(y,b?w.isAlignedLeft(b):!1,"isAlignedLeft");x=a(x,b?w.isAlignedCenter(b):!1,"isAlignedCenter");u=a(u,b?w.isAlignedRight(b):!1,"isAlignedRight");s=a(s,b?w.isAlignedJustified(b):!1,"isAlignedJustified");c&&v.emit(gui.DirectParagraphStyler.paragraphStylingChanged,c)}function l(a){a.getMemberId()===g&&m()}function q(a){a===g&&m()}function b(a){a.getMemberId()===
g&&m()}function a(){m()}function e(a){var b=k.getCursor(g);b&&k.getParagraphElement(b.getNode())===a.paragraphElement&&m()}function d(a){var b=k.getCursor(g).getSelectedRange(),d=k.getCursorPosition(g),b=t.getParagraphElements(b),e=k.getFormatting();b.forEach(function(b){var h=d+k.getDistanceFromCursor(g,b,0),l=b.getAttributeNS(odf.Namespaces.textns,"style-name");b=c.generateStyleName();var m,h=h+1;l&&(m=e.createDerivedStyleObject(l,"paragraph",{}));m=a(m||{});l=new ops.OpAddStyle;l.init({memberid:g,
styleName:b,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:m});m=new ops.OpSetParagraphStyle;m.init({memberid:g,styleName:b,position:h});f.enqueue([l,m])})}function r(a){d(function(b){return n.mergeObjects(b,a)})}function h(a){r({"style:paragraph-properties":{"fo:text-align":a}})}function p(a,b){var c=k.getFormatting().getDefaultTabStopDistance(),d=b["style:paragraph-properties"],d=(d=d&&d["fo:margin-left"])&&t.parseLength(d);return n.mergeObjects(b,{"style:paragraph-properties":{"fo:margin-left":d&&
d.unit===c.unit?d.value+a*c.value+d.unit:a*c.value+c.unit}})}var k=f.getOdtDocument(),n=new core.Utils,t=new odf.OdfUtils,w=new gui.StyleHelper(k.getFormatting()),v=new core.EventNotifier([gui.DirectParagraphStyler.paragraphStylingChanged]),y,x,u,s;this.isAlignedLeft=function(){return y};this.isAlignedCenter=function(){return x};this.isAlignedRight=function(){return u};this.isAlignedJustified=function(){return s};this.alignParagraphLeft=function(){h("left");return!0};this.alignParagraphCenter=function(){h("center");
return!0};this.alignParagraphRight=function(){h("right");return!0};this.alignParagraphJustified=function(){h("justify");return!0};this.indent=function(){d(p.bind(null,1));return!0};this.outdent=function(){d(p.bind(null,-1));return!0};this.subscribe=function(a,b){v.subscribe(a,b)};this.unsubscribe=function(a,b){v.unsubscribe(a,b)};this.destroy=function(c){k.unsubscribe(ops.OdtDocument.signalCursorAdded,l);k.unsubscribe(ops.OdtDocument.signalCursorRemoved,q);k.unsubscribe(ops.OdtDocument.signalCursorMoved,
b);k.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,a);k.unsubscribe(ops.OdtDocument.signalParagraphChanged,e);c()};k.subscribe(ops.OdtDocument.signalCursorAdded,l);k.subscribe(ops.OdtDocument.signalCursorRemoved,q);k.subscribe(ops.OdtDocument.signalCursorMoved,b);k.subscribe(ops.OdtDocument.signalParagraphStyleModified,a);k.subscribe(ops.OdtDocument.signalParagraphChanged,e);m()};gui.DirectParagraphStyler.paragraphStylingChanged="paragraphStyling/changed";(function(){return gui.DirectParagraphStyler})();
gui.KeyboardHandler=function(){function f(c,f){f||(f=g.None);return c+":"+f}var g=gui.KeyboardHandler.Modifier,c=null,m={};this.setDefault=function(f){c=f};this.bind=function(c,g,b){c=f(c,g);runtime.assert(!1===m.hasOwnProperty(c),"tried to overwrite the callback handler of key combo: "+c);m[c]=b};this.unbind=function(c,g){var b=f(c,g);delete m[b]};this.reset=function(){c=null;m={}};this.handleEvent=function(l){var q=l.keyCode,b=g.None;l.metaKey&&(b|=g.Meta);l.ctrlKey&&(b|=g.Ctrl);l.altKey&&(b|=g.Alt);
l.shiftKey&&(b|=g.Shift);q=f(q,b);q=m[q];b=!1;q?b=q():null!==c&&(b=c(l));b&&(l.preventDefault?l.preventDefault():l.returnValue=!1)}};gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12};gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90};(function(){return gui.KeyboardHandler})();
runtime.loadClass("odf.Namespaces");runtime.loadClass("odf.ObjectNameGenerator");
gui.ImageManager=function(f,g,c){var m={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},l=odf.Namespaces.textns,q=f.getOdtDocument(),b=q.getFormatting(),a={};this.insertImage=function(e,d,r,h){var p;runtime.assert(0<r&&0<h,"Both width and height of the image should be greater than 0px.");p=q.getParagraphElement(q.getCursor(g).getNode()).getAttributeNS(l,"style-name");a.hasOwnProperty(p)||(a[p]=b.getContentSize(p,"paragraph"));p=a[p];r*=0.0264583333333334;h*=0.0264583333333334;var k=1,n=
1;r>p.width&&(k=p.width/r);h>p.height&&(n=p.height/h);k=Math.min(k,n);p=r*k;r=h*k;n=q.getOdfCanvas().odfContainer().rootElement.styles;h=e.toLowerCase();var k=m.hasOwnProperty(h)?m[h]:null,t;h=[];runtime.assert(null!==k,"Image type is not supported: "+e);k="Pictures/"+c.generateImageName()+k;t=new ops.OpSetBlob;t.init({memberid:g,filename:k,mimetype:e,content:d});h.push(t);b.getStyleElement("Graphics","graphic",[n])||(e=new ops.OpAddStyle,e.init({memberid:g,styleName:"Graphics",styleFamily:"graphic",
isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph","svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),h.push(e));e=c.generateStyleName();d=new ops.OpAddStyle;d.init({memberid:g,styleName:e,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics",
"style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline","style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}});
h.push(d);t=new ops.OpInsertImage;t.init({memberid:g,position:q.getCursorPosition(g),filename:k,frameWidth:p+"cm",frameHeight:r+"cm",frameStyleName:e,frameName:c.generateFrameName()});h.push(t);f.enqueue(h)}};
runtime.loadClass("odf.Namespaces");
gui.ImageSelector=function(f){function g(){var b=f.getSizer(),a,c;a=l.createElement("div");a.id="imageSelector";a.style.borderWidth="1px";b.appendChild(a);m.forEach(function(b){c=l.createElement("div");c.className=b;a.appendChild(c)});return a}var c=odf.Namespaces.svgns,m="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),l=f.getElement().ownerDocument,q=!1;this.select=function(b){var a,e,d=l.getElementById("imageSelector");d||(d=g());q=!0;a=d.parentNode;
e=b.getBoundingClientRect();var m=a.getBoundingClientRect(),h=f.getZoomLevel();a=(e.left-m.left)/h-1;e=(e.top-m.top)/h-1;d.style.display="block";d.style.left=a+"px";d.style.top=e+"px";d.style.width=b.getAttributeNS(c,"width");d.style.height=b.getAttributeNS(c,"height")};this.clearSelection=function(){var b;q&&(b=l.getElementById("imageSelector"))&&(b.style.display="none");q=!1};this.isSelectorElement=function(b){var a=l.getElementById("imageSelector");return a?b===a||b.parentNode===a:!1}};
gui.TextManipulator=function(f,g,c){function m(b){var a=new ops.OpRemoveText;a.init({memberid:g,position:b.position,length:b.length});return a}function l(b){0>b.length&&(b.position+=b.length,b.length=-b.length);return b}var q=f.getOdtDocument();this.enqueueParagraphSplittingOps=function(){var b=l(q.getCursorSelection(g)),a,c=[];0<b.length&&(a=m(b),c.push(a));a=new ops.OpSplitParagraph;a.init({memberid:g,position:b.position});c.push(a);f.enqueue(c);return!0};this.removeTextByBackspaceKey=function(){var b=
l(q.getCursorSelection(g)),a=null;0===b.length?0<b.position&&q.getPositionInTextNode(b.position-1)&&(a=new ops.OpRemoveText,a.init({memberid:g,position:b.position-1,length:1}),f.enqueue([a])):(a=m(b),f.enqueue([a]));return null!==a};this.removeTextByDeleteKey=function(){var b=l(q.getCursorSelection(g)),a=null;0===b.length?q.getPositionInTextNode(b.position+1)&&(a=new ops.OpRemoveText,a.init({memberid:g,position:b.position,length:1}),f.enqueue([a])):(a=m(b),f.enqueue([a]));return null!==a};this.removeCurrentSelection=
function(){var b=l(q.getCursorSelection(g));0!==b.length&&(b=m(b),f.enqueue([b]));return!0};this.insertText=function(b){var a=l(q.getCursorSelection(g)),e,d=[];0<a.length&&(e=m(a),d.push(e));e=new ops.OpInsertText;e.init({memberid:g,position:a.position,text:b});d.push(e);c&&(b=c(a.position,b.length))&&d.push(b);f.enqueue(d)}};(function(){return gui.TextManipulator})();
runtime.loadClass("core.EventNotifier");runtime.loadClass("core.PositionFilter");runtime.loadClass("ops.OpAddAnnotation");runtime.loadClass("ops.OpRemoveAnnotation");runtime.loadClass("gui.SelectionMover");
gui.AnnotationManager=function(f,g){function c(){var a=b.getCursor(g),a=a&&a.getNode(),c;if(c=a){a:{for(c=b.getRootNode();a&&a!==c;){if(a.namespaceURI===r&&"annotation"===a.localName){a=!0;break a}a=a.parentNode}a=!1}c=!a}a=c;a!==e&&(e=a,d.emit(gui.AnnotationManager.annotatableChanged,e))}function m(a){a.getMemberId()===g&&c()}function l(a){a===g&&c()}function q(a){a.getMemberId()===g&&c()}var b=f.getOdtDocument(),a=b.getPositionFilter(),e=!1,d=new core.EventNotifier([gui.AnnotationManager.annotatableChanged]),
r=odf.Namespaces.officens,h=core.PositionFilter.FilterResult.FILTER_ACCEPT;this.isAnnotatable=function(){return e};this.addAnnotation=function(){var a=new ops.OpAddAnnotation,c=b.getCursorSelection(g),d=c.length,c=c.position;e&&(c=0<=d?c:c+d,d=Math.abs(d),a.init({memberid:g,position:c,length:d,name:g+Date.now()}),f.enqueue([a]))};this.removeAnnotation=function(c){var d,e;d=0;e=gui.SelectionMover.createPositionIterator(b.getRootNode());for(var l=new core.LoopWatchDog(1E3),m=!1;e.nextPosition();)if(l.check(),
m=Boolean(c.compareDocumentPosition(e.container())&Node.DOCUMENT_POSITION_CONTAINED_BY),a.acceptPosition(e)===h){if(m)break;d+=1}e=0;l=gui.SelectionMover.createPositionIterator(b.getRootNode());m=!1;l.setUnfilteredPosition(c,0);do{m=Boolean(c.compareDocumentPosition(l.container())&Node.DOCUMENT_POSITION_CONTAINED_BY);if(!m&&c!==l.container())break;a.acceptPosition(l)===h&&(e+=1)}while(l.nextPosition());c=new ops.OpRemoveAnnotation;c.init({memberid:g,position:d,length:e});e=new ops.OpMoveCursor;e.init({memberid:g,
position:d-1,length:0});f.enqueue([c,e])};this.subscribe=function(a,b){d.subscribe(a,b)};this.unsubscribe=function(a,b){d.unsubscribe(a,b)};this.destroy=function(a){b.unsubscribe(ops.OdtDocument.signalCursorAdded,m);b.unsubscribe(ops.OdtDocument.signalCursorRemoved,l);b.unsubscribe(ops.OdtDocument.signalCursorMoved,q);a()};b.subscribe(ops.OdtDocument.signalCursorAdded,m);b.subscribe(ops.OdtDocument.signalCursorRemoved,l);b.subscribe(ops.OdtDocument.signalCursorMoved,q);c()};
gui.AnnotationManager.annotatableChanged="annotatable/changed";(function(){return gui.AnnotationManager})();
gui.EventManager=function(f){function g(a){var b=a.scrollX,c=a.scrollY;this.restore=function(){a.scrollX===b&&a.scrollY===c||a.scrollTo(b,c)}}function c(a){var b=a.scrollTop,c=a.scrollLeft;this.restore=function(){if(a.scrollTop!==b||a.scrollLeft!==c)a.scrollTop=b,a.scrollLeft=c}}function m(){return f.getDOM().activeElement===l}var l=f.getOdfCanvas().getElement(),q=runtime.getWindow(),b={beforecut:!0,beforepaste:!0},a={mousedown:!0,mouseup:!0};this.subscribe=function(c,d){var f=l;a[c]&&q&&(f=q);var g=
"on"+c,m=!1;f.attachEvent&&(m=f.attachEvent(g,d));!m&&f.addEventListener&&(f.addEventListener(c,d,!1),m=!0);m&&!b[c]||!f.hasOwnProperty(g)||(f[g]=d)};this.unsubscribe=function(b,c){var f=l;a[b]&&q&&(f=q);var g="on"+b;f.detachEvent&&f.detachEvent(g,c);f.removeEventListener&&f.removeEventListener(b,c,!1);f[g]===c&&(f[g]=null)};this.hasFocus=m;this.focus=function(){var a;if(!m()){for(a=l;a&&!a.scrollTop&&!a.scrollLeft;)a=a.parentNode;a=a?new c(a):q?new g(q):null;l.focus();a&&a.restore()}}};
runtime.loadClass("core.DomUtils");runtime.loadClass("odf.OdfUtils");runtime.loadClass("odf.ObjectNameGenerator");runtime.loadClass("ops.OdtCursor");runtime.loadClass("ops.OpAddCursor");runtime.loadClass("ops.OpRemoveCursor");runtime.loadClass("gui.Clipboard");runtime.loadClass("gui.DirectTextStyler");runtime.loadClass("gui.DirectParagraphStyler");runtime.loadClass("gui.KeyboardHandler");runtime.loadClass("gui.ImageManager");runtime.loadClass("gui.ImageSelector");runtime.loadClass("gui.TextManipulator");
runtime.loadClass("gui.AnnotationManager");runtime.loadClass("gui.EventManager");
gui.SessionController=function(){var f=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(g,c,m,l){function q(a){a.preventDefault?a.preventDefault():a.returnValue=!1}function b(a,b,d){var e=new ops.OpMoveCursor;e.init({memberid:c,position:a,length:b||0,selectionType:d});return e}function a(a){var b=G.getOdfCanvas().getElement(),c=G.getRootNode(),d=0;b.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_PRECEDING||(a=gui.SelectionMover.createPositionIterator(c),a.moveToEnd(),
c=a.container(),d=a.unfilteredDomOffset());return{node:c,offset:d}}function e(a){a=G.getDistanceFromCursor(c,a,0);var d=null!==a?a+1:null,e;if(d||a)e=G.getCursorPosition(c),a=b(e+a,d-a,ops.OdtCursor.RegionSelection),g.enqueue([a]);X.focus()}function d(d,e){var f,h,k,m;h=G.getOdfCanvas().getElement();f=e.detail;if(d){if(!d.anchorNode&&!d.focusNode){k=e.clientX;m=e.clientY;var l=G.getDOM();l.caretRangeFromPoint?(k=l.caretRangeFromPoint(k,m),k={container:k.startContainer,offset:k.startOffset}):l.caretPositionFromPoint?
(k=l.caretPositionFromPoint(k,m),k={container:k.offsetNode,offset:k.offset}):k=null;if(!k)return;d.anchorNode=k.container;d.anchorOffset=k.offset;d.focusNode=d.anchorNode;d.focusOffset=d.anchorOffset}runtime.assert(null!==d.anchorNode&&null!==d.focusNode,"anchorNode or focusNode is null");k=fa.containsNode(h,d.anchorNode);h=fa.containsNode(h,d.focusNode);if(k||h){k||(k=a(d.anchorNode),d.anchorNode=k.node,d.anchorOffset=k.offset);h||(k=a(d.focusNode),d.focusNode=k.node,d.focusOffset=k.offset);if(2===
f){var l=/[A-Za-z0-9]/,n=gui.SelectionMover.createPositionIterator(G.getRootNode()),q=0<fa.comparePoints(d.anchorNode,d.anchorOffset,d.focusNode,d.focusOffset),p;q?(k=d.anchorNode,m=d.anchorOffset,f=d.focusNode,h=d.focusOffset):(k=d.focusNode,m=d.focusOffset,f=d.anchorNode,h=d.anchorOffset);for(n.setUnfilteredPosition(k,m);n.previousPosition();){p=n.getCurrentNode();if(p.nodeType===Node.TEXT_NODE){if(p=p.data[n.unfilteredDomOffset()],!l.test(p))break}else if(!W.isTextSpan(p))break;k=n.container();
m=n.unfilteredDomOffset()}n.setUnfilteredPosition(f,h);do if(p=n.getCurrentNode(),p.nodeType===Node.TEXT_NODE){if(p=p.data[n.unfilteredDomOffset()],!l.test(p))break}else if(!W.isTextSpan(p))break;while(n.nextPosition());f=n.container();h=n.unfilteredDomOffset();q?(d.anchorNode=k,d.anchorOffset=m,d.focusNode=f,d.focusOffset=h):(d.focusNode=k,d.focusOffset=m,d.anchorNode=f,d.anchorOffset=h)}else 3===f&&(f=G.getParagraphElement(d.anchorNode),h=G.getParagraphElement(d.focusNode),f&&(d.anchorNode=f,d.anchorOffset=
0),h&&(d.focusNode=h,d.focusOffset=h.childNodes.length));f=G.getDistanceFromCursor(c,d.anchorNode,d.anchorOffset);if((h=d.focusNode===d.anchorNode&&d.focusOffset===d.anchorOffset?f:G.getDistanceFromCursor(c,d.focusNode,d.focusOffset))||f)k=G.getCursorPosition(c),f=b(k+f,h-f,ops.OdtCursor.RangeSelection),g.enqueue([f]);X.focus()}}}function r(a){var d=G.getCursorSelection(c),e=G.getCursor(c).getStepCounter();0!==a&&(a=0<a?e.convertForwardStepsBetweenFilters(a,ma,sa):-e.convertBackwardStepsBetweenFilters(-a,
ma,sa),a=d.length+a,g.enqueue([b(d.position,a)]))}function h(a){var d=G.getCursorPosition(c),e=G.getCursor(c).getStepCounter();0!==a&&(a=0<a?e.convertForwardStepsBetweenFilters(a,ma,sa):-e.convertBackwardStepsBetweenFilters(-a,ma,sa),g.enqueue([b(d+a,0)]))}function p(){h(-1);return!0}function k(){h(1);return!0}function n(){r(-1);return!0}function t(){r(1);return!0}function w(a,b){var d=G.getParagraphElement(G.getCursor(c).getNode());runtime.assert(Boolean(d),"SessionController: Cursor outside paragraph");
d=G.getCursor(c).getStepCounter().countLinesSteps(a,ma);b?r(d):h(d)}function v(){w(-1,!1);return!0}function y(){w(1,!1);return!0}function x(){w(-1,!0);return!0}function u(){w(1,!0);return!0}function s(a,b){var d=G.getCursor(c).getStepCounter().countStepsToLineBoundary(a,ma);b?r(d):h(d)}function C(){s(-1,!1);return!0}function z(){s(1,!1);return!0}function E(){s(-1,!0);return!0}function N(){s(1,!0);return!0}function A(){var a=G.getParagraphElement(G.getCursor(c).getNode()),b,d;runtime.assert(Boolean(a),
"SessionController: Cursor outside paragraph");d=G.getDistanceFromCursor(c,a,0);b=gui.SelectionMover.createPositionIterator(G.getRootNode());for(b.setUnfilteredPosition(a,0);0===d&&b.previousPosition();)a=b.getCurrentNode(),W.isParagraph(a)&&(d=G.getDistanceFromCursor(c,a,0));r(d);return!0}function M(){var a=G.getParagraphElement(G.getCursor(c).getNode()),b,d;runtime.assert(Boolean(a),"SessionController: Cursor outside paragraph");b=gui.SelectionMover.createPositionIterator(G.getRootNode());b.moveToEndOfNode(a);
for(d=G.getDistanceFromCursor(c,b.container(),b.unfilteredDomOffset());0===d&&b.nextPosition();)a=b.getCurrentNode(),W.isParagraph(a)&&(b.moveToEndOfNode(a),d=G.getDistanceFromCursor(c,b.container(),b.unfilteredDomOffset()));r(d);return!0}function D(a,b){var d=gui.SelectionMover.createPositionIterator(G.getRootNode());0<a&&d.moveToEnd();d=G.getDistanceFromCursor(c,d.container(),d.unfilteredDomOffset());b?r(d):h(d)}function O(){D(-1,!1);return!0}function $(){D(1,!1);return!0}function ja(){D(-1,!0);
return!0}function S(){D(1,!0);return!0}function qa(){var a=gui.SelectionMover.createPositionIterator(G.getRootNode()),d;d=-G.getDistanceFromCursor(c,a.container(),a.unfilteredDomOffset());a.moveToEnd();d+=G.getDistanceFromCursor(c,a.container(),a.unfilteredDomOffset());g.enqueue([b(0,d)]);return!0}function aa(){var a=G.getCursor(c),b=ga.getSelection(),d;a?(ta.clearSelection(),a.getSelectionType()===ops.OdtCursor.RegionSelection&&(d=W.getImageElements(a.getSelectedRange())[0])&&ta.select(d.parentNode),
X.hasFocus()&&(d=a.getSelectedRange(),b.extend?a.hasForwardSelection()?(b.collapse(d.startContainer,d.startOffset),b.extend(d.endContainer,d.endOffset)):(b.collapse(d.endContainer,d.endOffset),b.extend(d.startContainer,d.startOffset)):(b.removeAllRanges(),b.addRange(d.cloneRange())))):ta.clearSelection()}function ha(){runtime.setTimeout(aa,0)}function T(a){var b=G.getCursor(c);b.getSelectedRange().collapsed||(ia.setDataFromRange(a,b.getSelectedRange())?oa.removeCurrentSelection():runtime.log("Cut operation failed"))}
function Y(){return!1!==G.getCursor(c).getSelectedRange().collapsed}function V(a){var b=G.getCursor(c);b.getSelectedRange().collapsed||ia.setDataFromRange(a,b.getSelectedRange())||runtime.log("Cut operation failed")}function H(a){var b;ga.clipboardData&&ga.clipboardData.getData?b=ga.clipboardData.getData("Text"):a.clipboardData&&a.clipboardData.getData&&(b=a.clipboardData.getData("text/plain"));b&&(oa.insertText(b),a.preventDefault?a.preventDefault():a.returnValue=!1)}function I(){return!1}function K(a){if(ca)ca.onOperationExecuted(a)}
function R(a){G.emit(ops.OdtDocument.signalUndoStackChanged,a)}function P(){return ca?(ca.moveBackward(1),aa(),!0):!1}function ba(){return ca?(ca.moveForward(1),aa(),!0):!1}function ka(a){if(na=(a=a.target||a.srcElement)&&fa.containsNode(G.getOdfCanvas().getElement(),a))ua=!1,va=G.createRootFilter(a)}function da(a){var b=a.getSelectedRange();return a.hasForwardSelection()?{anchorNode:b.startContainer,anchorOffset:b.startOffset,focusNode:b.endContainer,focusOffset:b.endOffset}:{anchorNode:b.endContainer,
anchorOffset:b.endOffset,focusNode:b.startContainer,focusOffset:b.startOffset}}function U(a){var b=a.target||a.srcElement,c={detail:a.detail,clientX:a.clientX,clientY:a.clientY,target:b};W.isImage(b)&&W.isCharacterFrame(b.parentNode)?e(b.parentNode):na&&!ta.isSelectorElement(b)&&(ua?d(da(m),a):runtime.setTimeout(function(){var a;a=(a=ga.getSelection())?{anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}:null;d(a,c)},0));ua=na=!1}function Q(a){U(a)}
function L(a){var b=a.target||a.srcElement,c=null;"annotationRemoveButton"===b.className?(c=fa.getElementsByTagNameNS(b.parentNode,odf.Namespaces.officens,"annotation")[0],pa.removeAnnotation(c)):U(a)}function ea(){var a=ga.getSelection(),b;na&&0<a.rangeCount&&(ua=!0,ta.clearSelection(),wa.setUnfilteredPosition(a.focusNode,a.focusOffset),va.acceptPosition(wa)===f&&(b=a.getRangeAt(0).cloneRange(),a=a.anchorNode===b.startContainer&&a.anchorOffset===b.startOffset,m.setSelectedRange(b,a),G.emit(ops.OdtDocument.signalCursorMoved,
m)))}function la(a){return function(){a();return!0}}function F(a){return function(b){return G.getCursor(c).getSelectionType()===ops.OdtCursor.RangeSelection?a(b):!0}}var ga=runtime.getWindow(),G=g.getOdtDocument(),fa=new core.DomUtils,W=new odf.OdfUtils,ia=new gui.Clipboard,B=new gui.KeyboardHandler,ra=new gui.KeyboardHandler,ma=new core.PositionFilterChain,sa=G.getPositionFilter(),na=!1,ya=new odf.ObjectNameGenerator(G.getOdfCanvas().odfContainer(),c),ua=!1,va=null,ca=null,X=new gui.EventManager(G),
pa=new gui.AnnotationManager(g,c),Z=l&&l.directStylingEnabled?new gui.DirectTextStyler(g,c):null,J=l&&l.directStylingEnabled?new gui.DirectParagraphStyler(g,c,ya):null,oa=new gui.TextManipulator(g,c,Z&&Z.createCursorStyleOp),za=new gui.ImageManager(g,c,ya),ta=new gui.ImageSelector(G.getOdfCanvas()),wa=gui.SelectionMover.createPositionIterator(G.getRootNode());runtime.assert(null!==ga,"Expected to be run in an environment which has a global window, like a browser.");ma.addFilter("BaseFilter",sa);ma.addFilter("RootFilter",
G.createRootFilter(c));this.startEditing=function(){var a;G.getOdfCanvas().getElement().classList.add("virtualSelections");X.subscribe("keydown",B.handleEvent);X.subscribe("keypress",ra.handleEvent);X.subscribe("keyup",q);X.subscribe("beforecut",Y);X.subscribe("cut",T);X.subscribe("copy",V);X.subscribe("beforepaste",I);X.subscribe("paste",H);X.subscribe("mousedown",ka);X.subscribe("mousemove",ea);X.subscribe("mouseup",L);X.subscribe("contextmenu",Q);X.subscribe("focus",ha);G.subscribe(ops.OdtDocument.signalOperationExecuted,
aa);G.subscribe(ops.OdtDocument.signalOperationExecuted,K);a=new ops.OpAddCursor;a.init({memberid:c});g.enqueue([a]);ca&&ca.saveInitialState()};this.endEditing=function(){var a;a=new ops.OpRemoveCursor;a.init({memberid:c});g.enqueue([a]);ca&&ca.resetInitialState();G.unsubscribe(ops.OdtDocument.signalOperationExecuted,K);G.unsubscribe(ops.OdtDocument.signalOperationExecuted,aa);X.unsubscribe("keydown",B.handleEvent);X.unsubscribe("keypress",ra.handleEvent);X.unsubscribe("keyup",q);X.unsubscribe("cut",
T);X.unsubscribe("beforecut",Y);X.unsubscribe("copy",V);X.unsubscribe("paste",H);X.unsubscribe("beforepaste",I);X.unsubscribe("mousedown",ka);X.unsubscribe("mouseup",L);X.unsubscribe("contextmenu",Q);X.unsubscribe("focus",ha);G.getOdfCanvas().getElement().classList.remove("virtualSelections")};this.getInputMemberId=function(){return c};this.getSession=function(){return g};this.setUndoManager=function(a){ca&&ca.unsubscribe(gui.UndoManager.signalUndoStackChanged,R);if(ca=a)ca.setOdtDocument(G),ca.setPlaybackFunction(function(a){a.execute(G)}),
ca.subscribe(gui.UndoManager.signalUndoStackChanged,R)};this.getUndoManager=function(){return ca};this.getAnnotationManager=function(){return pa};this.getDirectTextStyler=function(){return Z};this.getDirectParagraphStyler=function(){return J};this.getImageManager=function(){return za};this.getTextManipulator=function(){return oa};this.getEventManager=function(){return X};this.getKeyboardHandlers=function(){return{keydown:B,keypress:ra}};this.destroy=function(a){var b=J?J.destroy:function(a){a()};
(Z?Z.destroy:function(a){a()})(function(c){c?a(c):b(a)})};(function(){var a=-1!==ga.navigator.appVersion.toLowerCase().indexOf("mac"),b=gui.KeyboardHandler.Modifier,c=gui.KeyboardHandler.KeyCode;B.bind(c.Tab,b.None,F(function(){oa.insertText("\t");return!0}));B.bind(c.Left,b.None,F(p));B.bind(c.Right,b.None,F(k));B.bind(c.Up,b.None,F(v));B.bind(c.Down,b.None,F(y));B.bind(c.Backspace,b.None,la(oa.removeTextByBackspaceKey));B.bind(c.Delete,b.None,oa.removeTextByDeleteKey);B.bind(c.Left,b.Shift,F(n));
B.bind(c.Right,b.Shift,F(t));B.bind(c.Up,b.Shift,F(x));B.bind(c.Down,b.Shift,F(u));B.bind(c.Home,b.None,F(C));B.bind(c.End,b.None,F(z));B.bind(c.Home,b.Ctrl,F(O));B.bind(c.End,b.Ctrl,F($));B.bind(c.Home,b.Shift,F(E));B.bind(c.End,b.Shift,F(N));B.bind(c.Up,b.CtrlShift,F(A));B.bind(c.Down,b.CtrlShift,F(M));B.bind(c.Home,b.CtrlShift,F(ja));B.bind(c.End,b.CtrlShift,F(S));a?(B.bind(c.Clear,b.None,oa.removeCurrentSelection),B.bind(c.Left,b.Meta,F(C)),B.bind(c.Right,b.Meta,F(z)),B.bind(c.Home,b.Meta,F(O)),
B.bind(c.End,b.Meta,F($)),B.bind(c.Left,b.MetaShift,F(E)),B.bind(c.Right,b.MetaShift,F(N)),B.bind(c.Up,b.AltShift,F(A)),B.bind(c.Down,b.AltShift,F(M)),B.bind(c.Up,b.MetaShift,F(ja)),B.bind(c.Down,b.MetaShift,F(S)),B.bind(c.A,b.Meta,F(qa)),Z&&(B.bind(c.B,b.Meta,F(Z.toggleBold)),B.bind(c.I,b.Meta,F(Z.toggleItalic)),B.bind(c.U,b.Meta,F(Z.toggleUnderline))),J&&(B.bind(c.L,b.MetaShift,F(J.alignParagraphLeft)),B.bind(c.E,b.MetaShift,F(J.alignParagraphCenter)),B.bind(c.R,b.MetaShift,F(J.alignParagraphRight)),
B.bind(c.J,b.MetaShift,F(J.alignParagraphJustified))),pa&&B.bind(c.C,b.MetaShift,pa.addAnnotation),B.bind(c.Z,b.Meta,P),B.bind(c.Z,b.MetaShift,ba)):(B.bind(c.A,b.Ctrl,F(qa)),Z&&(B.bind(c.B,b.Ctrl,F(Z.toggleBold)),B.bind(c.I,b.Ctrl,F(Z.toggleItalic)),B.bind(c.U,b.Ctrl,F(Z.toggleUnderline))),J&&(B.bind(c.L,b.CtrlShift,F(J.alignParagraphLeft)),B.bind(c.E,b.CtrlShift,F(J.alignParagraphCenter)),B.bind(c.R,b.CtrlShift,F(J.alignParagraphRight)),B.bind(c.J,b.CtrlShift,F(J.alignParagraphJustified))),pa&&B.bind(c.C,
b.CtrlAlt,pa.addAnnotation),B.bind(c.Z,b.Ctrl,P),B.bind(c.Z,b.CtrlShift,ba));ra.setDefault(F(function(a){var b;b=null===a.which||void 0===a.which?String.fromCharCode(a.keyCode):0!==a.which&&0!==a.charCode?String.fromCharCode(a.which):null;return!b||a.altKey||a.ctrlKey||a.metaKey?!1:(oa.insertText(b),!0)}));ra.bind(c.Enter,b.None,F(oa.enqueueParagraphSplittingOps))})()};return gui.SessionController}();
ops.MemberModel=function(){};ops.MemberModel.prototype.getMemberDetailsAndUpdates=function(f,g){};ops.MemberModel.prototype.unsubscribeMemberDetailsUpdates=function(f,g){};ops.MemberModel.prototype.close=function(f){};
ops.TrivialMemberModel=function(){this.getMemberDetailsAndUpdates=function(f,g){g(f,{memberid:f,fullname:"Unknown Author",color:"black",imageurl:"avatar-joe.png"})};this.unsubscribeMemberDetailsUpdates=function(f,g){};this.close=function(f){f()}};
ops.OperationRouter=function(){};ops.OperationRouter.prototype.setOperationFactory=function(f){};ops.OperationRouter.prototype.setPlaybackFunction=function(f){};ops.OperationRouter.prototype.push=function(f){};ops.OperationRouter.prototype.close=function(f){};
ops.TrivialOperationRouter=function(){var f,g;this.setOperationFactory=function(c){f=c};this.setPlaybackFunction=function(c){g=c};this.push=function(c){c.forEach(function(c){c=c.spec();c.timestamp=(new Date).getTime();c=f.create(c);g(c)})};this.close=function(c){c()}};
gui.EditInfoHandle=function(f){var g=[],c,m=f.ownerDocument,l=m.documentElement.namespaceURI;this.setEdits=function(f){g=f;var b,a,e,d;c.innerHTML="";for(f=0;f<g.length;f+=1)b=m.createElementNS(l,"div"),b.className="editInfo",a=m.createElementNS(l,"span"),a.className="editInfoColor",a.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[f].memberid),e=m.createElementNS(l,"span"),e.className="editInfoAuthor",e.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[f].memberid),
d=m.createElementNS(l,"span"),d.className="editInfoTime",d.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[f].memberid),d.innerHTML=g[f].time,b.appendChild(a),b.appendChild(e),b.appendChild(d),c.appendChild(b)};this.show=function(){c.style.display="block"};this.hide=function(){c.style.display="none"};this.destroy=function(g){f.removeChild(c);g()};c=m.createElementNS(l,"div");c.setAttribute("class","editInfoHandle");c.style.display="none";f.appendChild(c)};
runtime.loadClass("ops.EditInfo");runtime.loadClass("gui.EditInfoHandle");
gui.EditInfoMarker=function(f,g){function c(a,c){return runtime.setTimeout(function(){b.style.opacity=a},c)}var m=this,l,q,b,a,e;this.addEdit=function(d,g){var h=Date.now()-g;f.addEdit(d,g);q.setEdits(f.getSortedEdits());b.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",d);a&&runtime.clearTimeout(a);e&&runtime.clearTimeout(e);1E4>h?(c(1,0),a=c(0.5,1E4-h),e=c(0.2,2E4-h)):1E4<=h&&2E4>h?(c(0.5,0),e=c(0.2,2E4-h)):c(0.2,0)};this.getEdits=function(){return f.getEdits()};this.clearEdits=function(){f.clearEdits();
q.setEdits([]);b.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&b.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")};this.getEditInfo=function(){return f};this.show=function(){b.style.display="block"};this.hide=function(){m.hideHandle();b.style.display="none"};this.showHandle=function(){q.show()};this.hideHandle=function(){q.hide()};this.destroy=function(a){l.removeChild(b);q.destroy(function(b){b?a(b):f.destroy(a)})};(function(){var a=f.getOdtDocument().getDOM();
b=a.createElementNS(a.documentElement.namespaceURI,"div");b.setAttribute("class","editInfoMarker");b.onmouseover=function(){m.showHandle()};b.onmouseout=function(){m.hideHandle()};l=f.getNode();l.appendChild(b);q=new gui.EditInfoHandle(l);g||m.hide()})()};
runtime.loadClass("gui.Caret");runtime.loadClass("ops.TrivialMemberModel");runtime.loadClass("ops.EditInfo");runtime.loadClass("gui.EditInfoMarker");gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0};
gui.SessionView=function(){return function(f,g,c,m,l){function q(a,b,c){function d(b,c,e){c=b+'[editinfo|memberid="'+a+'"]'+e+c;a:{var f=t.firstChild;for(b=b+'[editinfo|memberid="'+a+'"]'+e+"{";f;){if(f.nodeType===Node.TEXT_NODE&&0===f.data.indexOf(b)){b=f;break a}f=f.nextSibling}b=null}b?b.data=c:t.appendChild(document.createTextNode(c))}d("div.editInfoMarker","{ background-color: "+c+"; }","");d("span.editInfoColor","{ background-color: "+c+"; }","");d("span.editInfoAuthor",'{ content: "'+b+'"; }',
":before");d("dc|creator",'{ content: "'+b+'"; display: none;}',":before");d("dc|creator","{ background-color: "+c+"; }","");d("div.selectionOverlay","{ background-color: "+c+";}","")}function b(a){var b,c;for(c in v)v.hasOwnProperty(c)&&(b=v[c],a?b.show():b.hide())}function a(a){m.getCarets().forEach(function(b){a?b.showHandle():b.hideHandle()})}function e(a,b){var c=m.getCaret(a);b?(c&&(c.setAvatarImageUrl(b.imageurl),c.setColor(b.color)),q(a,b.fullname,b.color),g===a&&q("",b.fullname,b.color)):
runtime.log('MemberModel sent undefined data for member "'+a+'".')}function d(a){var b=a.getMemberId(),d=c.getMemberModel();m.registerCursor(a,x,u);l.registerCursor(a,!0);e(b,null);d.getMemberDetailsAndUpdates(b,e);runtime.log("+++ View here +++ eagerly created an Caret for '"+b+"'! +++")}function r(a){a=a.getMemberId();var b=l.getSelectionView(g),c=l.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),d=m.getCaret(g);a===g?(c.hide(),b.show(),d&&d.show()):a===gui.ShadowCursor.ShadowCursorMemberId&&
(c.show(),b.hide(),d&&d.hide())}function h(a){var b=!1,d;for(d in v)if(v.hasOwnProperty(d)&&v[d].getEditInfo().getEdits().hasOwnProperty(a)){b=!0;break}l.removeSelectionView(a);b||c.getMemberModel().unsubscribeMemberDetailsUpdates(a,e)}function p(a){var b=a.paragraphElement,d=a.memberId;a=a.timeStamp;var e,f="",g=b.getElementsByTagNameNS(w,"editinfo")[0];g?(f=g.getAttributeNS(w,"id"),e=v[f]):(f=Math.random().toString(),e=new ops.EditInfo(b,c.getOdtDocument()),e=new gui.EditInfoMarker(e,y),g=b.getElementsByTagNameNS(w,
"editinfo")[0],g.setAttributeNS(w,"id",f),v[f]=e);e.addEdit(d,new Date(a))}function k(){C=!0}function n(){s=runtime.getWindow().setInterval(function(){C&&(l.rerenderSelectionViews(),C=!1)},200)}var t,w="urn:webodf:names:editinfo",v={},y=void 0!==f.editInfoMarkersInitiallyVisible?Boolean(f.editInfoMarkersInitiallyVisible):!0,x=void 0!==f.caretAvatarsInitiallyVisible?Boolean(f.caretAvatarsInitiallyVisible):!0,u=void 0!==f.caretBlinksOnRangeSelect?Boolean(f.caretBlinksOnRangeSelect):!0,s,C=!1;this.showEditInfoMarkers=
function(){y||(y=!0,b(y))};this.hideEditInfoMarkers=function(){y&&(y=!1,b(y))};this.showCaretAvatars=function(){x||(x=!0,a(x))};this.hideCaretAvatars=function(){x&&(x=!1,a(x))};this.getSession=function(){return c};this.getCaret=function(a){return m.getCaret(a)};this.destroy=function(a){var b=c.getOdtDocument(),f=c.getMemberModel(),g=Object.keys(v).map(function(a){return v[a]});b.unsubscribe(ops.OdtDocument.signalCursorAdded,d);b.unsubscribe(ops.OdtDocument.signalCursorRemoved,h);b.unsubscribe(ops.OdtDocument.signalParagraphChanged,
p);b.unsubscribe(ops.OdtDocument.signalCursorMoved,r);b.unsubscribe(ops.OdtDocument.signalParagraphChanged,k);b.unsubscribe(ops.OdtDocument.signalTableAdded,k);b.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,k);runtime.getWindow().clearInterval(s);m.getCarets().forEach(function(a){f.unsubscribeMemberDetailsUpdates(a.getCursor().getMemberId(),e)});t.parentNode.removeChild(t);(function D(b,c){c?a(c):b<g.length?g[b].destroy(function(a){D(b+1,a)}):a()})(0,void 0)};(function(){var a=c.getOdtDocument(),
b=document.getElementsByTagName("head")[0];a.subscribe(ops.OdtDocument.signalCursorAdded,d);a.subscribe(ops.OdtDocument.signalCursorRemoved,h);a.subscribe(ops.OdtDocument.signalParagraphChanged,p);a.subscribe(ops.OdtDocument.signalCursorMoved,r);n();a.subscribe(ops.OdtDocument.signalParagraphChanged,k);a.subscribe(ops.OdtDocument.signalTableAdded,k);a.subscribe(ops.OdtDocument.signalParagraphStyleModified,k);t=document.createElementNS(b.namespaceURI,"style");t.type="text/css";t.media="screen, print, handheld, projection";
t.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);"));t.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);"));b.appendChild(t)})()}}();
runtime.loadClass("gui.Caret");
gui.CaretManager=function(f){function g(a){return p.hasOwnProperty(a)?p[a]:null}function c(){return Object.keys(p).map(function(a){return p[a]})}function m(a){a===f.getInputMemberId()&&f.getSession().getOdtDocument().getOdfCanvas().getElement().removeAttribute("tabindex");delete p[a]}function l(a){a=a.getMemberId();a===f.getInputMemberId()&&(a=g(a))&&a.refreshCursorBlinking()}function q(){var a=g(f.getInputMemberId());n=!1;a&&a.ensureVisible()}function b(){var a=g(f.getInputMemberId());a&&(a.handleUpdate(),
n||(n=!0,runtime.setTimeout(q,50)))}function a(a){a.memberId===f.getInputMemberId()&&b()}function e(){var a=g(f.getInputMemberId());a&&a.setFocus()}function d(){var a=g(f.getInputMemberId());a&&a.removeFocus()}function r(){var a=g(f.getInputMemberId());a&&a.show()}function h(){var a=g(f.getInputMemberId());a&&a.hide()}var p={},k=runtime.getWindow(),n=!1;this.registerCursor=function(a,c,d){var e=a.getMemberId();c=new gui.Caret(a,c,d);p[e]=c;e===f.getInputMemberId()?(runtime.log("Starting to track input on new cursor of "+
e),a.handleUpdate=b,f.getSession().getOdtDocument().getOdfCanvas().getElement().setAttribute("tabindex",-1),f.getEventManager().focus()):a.handleUpdate=c.handleUpdate;return c};this.getCaret=g;this.getCarets=c;this.destroy=function(b){var g=f.getSession().getOdtDocument(),n=f.getEventManager(),q=c();g.unsubscribe(ops.OdtDocument.signalParagraphChanged,a);g.unsubscribe(ops.OdtDocument.signalCursorMoved,l);g.unsubscribe(ops.OdtDocument.signalCursorRemoved,m);n.unsubscribe("focus",e);n.unsubscribe("blur",
d);k.removeEventListener("focus",r,!1);k.removeEventListener("blur",h,!1);(function u(a,c){c?b(c):a<q.length?q[a].destroy(function(b){u(a+1,b)}):b()})(0,void 0);p={}};(function(){var b=f.getSession().getOdtDocument(),c=f.getEventManager();b.subscribe(ops.OdtDocument.signalParagraphChanged,a);b.subscribe(ops.OdtDocument.signalCursorMoved,l);b.subscribe(ops.OdtDocument.signalCursorRemoved,m);c.subscribe("focus",e);c.subscribe("blur",d);k.addEventListener("focus",r,!1);k.addEventListener("blur",h,!1)})()};
gui.UndoManager=function(){};gui.UndoManager.prototype.subscribe=function(f,g){};gui.UndoManager.prototype.unsubscribe=function(f,g){};gui.UndoManager.prototype.setOdtDocument=function(f){};gui.UndoManager.prototype.saveInitialState=function(){};gui.UndoManager.prototype.resetInitialState=function(){};gui.UndoManager.prototype.setPlaybackFunction=function(f){};gui.UndoManager.prototype.hasUndoStates=function(){};gui.UndoManager.prototype.hasRedoStates=function(){};
gui.UndoManager.prototype.moveForward=function(f){};gui.UndoManager.prototype.moveBackward=function(f){};gui.UndoManager.prototype.onOperationExecuted=function(f){};gui.UndoManager.signalUndoStackChanged="undoStackChanged";gui.UndoManager.signalUndoStateCreated="undoStateCreated";gui.UndoManager.signalUndoStateModified="undoStateModified";(function(){return gui.UndoManager})();
gui.UndoStateRules=function(){function f(c){return c.spec().optype}function g(c){switch(f(c)){case "MoveCursor":case "AddCursor":case "RemoveCursor":return!1;default:return!0}}this.getOpType=f;this.isEditOperation=g;this.isPartOfOperationSet=function(c,m){if(g(c)){if(0===m.length)return!0;var l;if(l=g(m[m.length-1]))a:{l=m.filter(g);var q=f(c),b;b:switch(q){case "RemoveText":case "InsertText":b=!0;break b;default:b=!1}if(b&&q===f(l[0])){if(1===l.length){l=!0;break a}q=l[l.length-2].spec().position;
l=l[l.length-1].spec().position;b=c.spec().position;if(l===b-(l-q)){l=!0;break a}}l=!1}return l}return!0}};
runtime.loadClass("core.DomUtils");runtime.loadClass("gui.UndoManager");runtime.loadClass("gui.UndoStateRules");
gui.TrivialUndoManager=function(f){function g(){t.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:b.hasUndoStates(),redoAvailable:b.hasRedoStates()})}function c(){p!==d&&p!==k[k.length-1]&&k.push(p)}function m(b){var c=b.previousSibling||b.nextSibling;b.parentNode.removeChild(b);a.normalizeTextNodes(c)}function l(a){return Object.keys(a).map(function(b){return a[b]})}function q(a){function b(a){var g=a.spec();if(e[g.memberid])switch(g.optype){case "AddCursor":c[g.memberid]||(c[g.memberid]=
a,delete e[g.memberid],f-=1);break;case "MoveCursor":d[g.memberid]||(d[g.memberid]=a)}}var c={},d={},e={},f,g=a.pop();h.getCursors().forEach(function(a){e[a.getMemberId()]=!0});for(f=Object.keys(e).length;g&&0<f;)g.reverse(),g.forEach(b),g=a.pop();return l(c).concat(l(d))}var b=this,a=new core.DomUtils,e,d=[],r,h,p=[],k=[],n=[],t=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.TrivialUndoManager.signalDocumentRootReplaced]),
w=f||new gui.UndoStateRules;this.subscribe=function(a,b){t.subscribe(a,b)};this.unsubscribe=function(a,b){t.unsubscribe(a,b)};this.hasUndoStates=function(){return 0<k.length};this.hasRedoStates=function(){return 0<n.length};this.setOdtDocument=function(a){h=a};this.resetInitialState=function(){k.length=0;n.length=0;d.length=0;p.length=0;e=null;g()};this.saveInitialState=function(){var b=h.getOdfCanvas().odfContainer(),f=h.getOdfCanvas().getAnnotationManager();f&&f.forgetAnnotations();e=b.rootElement.cloneNode(!0);
h.getOdfCanvas().refreshAnnotations();b=e;a.getElementsByTagNameNS(b,"urn:webodf:names:cursor","cursor").forEach(m);a.getElementsByTagNameNS(b,"urn:webodf:names:cursor","anchor").forEach(m);c();k.unshift(d);p=d=q(k);k.length=0;n.length=0;g()};this.setPlaybackFunction=function(a){r=a};this.onOperationExecuted=function(a){n.length=0;w.isEditOperation(a)&&p===d||!w.isPartOfOperationSet(a,p)?(c(),p=[a],k.push(p),t.emit(gui.UndoManager.signalUndoStateCreated,{operations:p}),g()):(p.push(a),t.emit(gui.UndoManager.signalUndoStateModified,
{operations:p}))};this.moveForward=function(a){for(var b=0,c;a&&n.length;)c=n.pop(),k.push(c),c.forEach(r),a-=1,b+=1;b&&(p=k[k.length-1],g());return b};this.moveBackward=function(a){for(var b=h.getOdfCanvas(),c=b.odfContainer(),f=0;a&&k.length;)n.push(k.pop()),a-=1,f+=1;f&&(c.setRootElement(e.cloneNode(!0)),b.setOdfContainer(c,!0),t.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),h.getCursors().forEach(function(a){h.removeCursor(a.getMemberId())}),d.forEach(r),k.forEach(function(a){a.forEach(r)}),
b.refreshCSS(),p=k[k.length-1]||d,g());return f}};gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced";(function(){return gui.TrivialUndoManager})();
runtime.loadClass("core.DomUtils");runtime.loadClass("odf.OdfUtils");runtime.loadClass("odf.OdfNodeFilter");runtime.loadClass("gui.SelectionMover");
gui.SelectionView=function(f){function g(a){if(z&&a.nodeType===Node.ELEMENT_NODE)return a.getBoundingClientRect();s.selectNode(a);return s.getBoundingClientRect()}function c(a,b){a.style.left=b.left+"px";a.style.top=b.top+"px";a.style.width=b.width+"px";a.style.height=b.height+"px"}function m(a){u=a;t.style.display=w.style.display=v.style.display=!0===a?"block":"none"}function l(a){var b=g(k),c=p.getOdfCanvas().getZoomLevel(),d={};d.top=x.adaptRangeDifferenceToZoomLevel(a.top-b.top,c);d.left=x.adaptRangeDifferenceToZoomLevel(a.left-
b.left,c);d.bottom=x.adaptRangeDifferenceToZoomLevel(a.bottom-b.top,c);d.right=x.adaptRangeDifferenceToZoomLevel(a.right-b.left,c);d.width=x.adaptRangeDifferenceToZoomLevel(a.width,c);d.height=x.adaptRangeDifferenceToZoomLevel(a.height,c);return d}function q(a){var b=y.getTextNodes(a,!0),c=n.createRange(),d=n.createRange(),e=n.createRange();if(!b.length)return null;var f;a:{f=a.startContainer.nodeType===Node.TEXT_NODE?a.startOffset:0;var g=0,h=b[g];c.setStart(h,f);for(c.setEnd(h,f);!Boolean(c.getClientRects()[0]);)if(f<
h.length)f+=1,c.setEnd(h,f);else if(b[g])h=b[g],g+=1,f=0,c.setStart(h,f),c.setEnd(h,f);else{f=!1;break a}f=!0}if(!f)return null;a:{a=a.endContainer.nodeType===Node.TEXT_NODE?a.endOffset:b[b.length-1].length;f=b.length-1;g=b[f];d.setStart(g,a);for(d.setEnd(g,a);!Boolean(d.getClientRects()[0]);)if(0<a)a-=1,d.setStart(g,a);else if(b[f])g=b[f],f-=1,a=g.length,d.setStart(g,a),d.setEnd(g,a);else{b=!1;break a}b=!0}if(!b)return null;e.setStart(c.startContainer,c.startOffset);e.setEnd(d.endContainer,d.endOffset);
return{firstRange:c,lastRange:d,fillerRange:e}}function b(a,b){var c={};c.top=Math.min(a.top,b.top);c.left=Math.min(a.left,b.left);c.right=Math.max(a.right,b.right);c.bottom=Math.max(a.bottom,b.bottom);c.width=c.right-c.left;c.height=c.bottom-c.top;return c}function a(a,c){c&&0<c.width&&0<c.height&&(a=a?b(a,c):c);return a}function e(b){function c(a){C.setUnfilteredPosition(a,0);return u.acceptNode(a)===E&&w.acceptPosition(C)===E?E:N}function d(a){var b=null;c(a)===E&&(b=g(a));return b}var e=b.commonAncestorContainer,
f=b.startContainer,h=b.endContainer,k=b.startOffset,l=b.endOffset,m,q,r=null,t,s=n.createRange(),w,u=new odf.OdfNodeFilter,v;if(f===e||h===e)return s=b.cloneRange(),r=s.getBoundingClientRect(),s.detach(),r;for(b=f;b.parentNode!==e;)b=b.parentNode;for(q=h;q.parentNode!==e;)q=q.parentNode;w=p.createRootFilter(f);for(e=b.nextSibling;e&&e!==q;)t=d(e),r=a(r,t),e=e.nextSibling;if(y.isParagraph(b))r=a(r,g(b));else for(v=n.createTreeWalker(b,NodeFilter.SHOW_TEXT,c),e=v.currentNode=f;e&&e!==h;)s.setStart(e,
k),s.setEnd(e,e.length),t=s.getBoundingClientRect(),r=a(r,t),m=e,k=0,e=v.nextNode();m||(m=f);if(y.isParagraph(q))r=a(r,g(b));else for(v=n.createTreeWalker(q,NodeFilter.SHOW_TEXT,c),e=v.currentNode=h;e&&e!==m;)if(s.setStart(e,0),s.setEnd(e,l),t=s.getBoundingClientRect(),r=a(r,t),e=v.previousNode())l=e.length;return r}function d(a,b){var c=a.getClientRects()[0],d={width:0};d.top=c.top;d.bottom=c.bottom;d.height=c.height;d.left=d.right=b?c.right:c.left;return d}function r(a){a=a.cloneRange();var f=q(a),
g,h,k,n,p;a.collapsed||!f?m(!1):(m(!0),g=f.firstRange,h=f.lastRange,f=f.fillerRange,k=l(d(g,!0)),p=l(d(h,!0)),n=(n=e(f))?l(n):b(k,p),c(t,{left:k.left,top:k.top,width:Math.max(0,n.width-(k.left-n.left)),height:k.height}),p.top===k.top||p.bottom===k.bottom?w.style.display=v.style.display="none":(c(v,{left:n.left,top:p.top,width:Math.max(0,p.right-n.left),height:p.height}),c(w,{left:n.left,top:k.top+k.height,width:Math.max(0,parseFloat(t.style.left)+parseFloat(t.style.width)-parseFloat(v.style.left)),
height:Math.max(0,p.top-k.bottom)})),g.detach(),h.detach(),f.detach());a.detach()}function h(a){a===f&&r(f.getSelectedRange())}var p=f.getOdtDocument(),k=p.getRootNode().parentNode.parentNode,n=p.getDOM(),t=n.createElement("div"),w=n.createElement("div"),v=n.createElement("div"),y=new odf.OdfUtils,x=new core.DomUtils,u=!0,s=n.createRange(),C=gui.SelectionMover.createPositionIterator(p.getRootNode()),z=x.areRangeRectanglesTransformed(n),E=NodeFilter.FILTER_ACCEPT,N=NodeFilter.FILTER_REJECT;this.rerender=
function(){r(f.getSelectedRange())};this.show=function(){m(!0);r(f.getSelectedRange())};this.hide=function(){m(!1)};this.visible=function(){return u};this.destroy=function(a){k.removeChild(t);k.removeChild(w);k.removeChild(v);f.getOdtDocument().unsubscribe(ops.OdtDocument.signalCursorMoved,h);a()};(function(){var a=f.getMemberId();k.appendChild(t);k.appendChild(w);k.appendChild(v);t.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",a);w.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",
a);v.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",a);t.className=w.className=v.className="selectionOverlay";f.getOdtDocument().subscribe(ops.OdtDocument.signalCursorMoved,h)})()};
runtime.loadClass("gui.SelectionView");
gui.SelectionViewManager=function(){function f(){return Object.keys(g).map(function(c){return g[c]})}var g={};this.getSelectionView=function(c){return g.hasOwnProperty(c)?g[c]:null};this.getSelectionViews=f;this.removeSelectionView=function(c){g.hasOwnProperty(c)&&(g[c].destroy(function(){}),delete g[c])};this.hideSelectionView=function(c){g.hasOwnProperty(c)&&g[c].hide()};this.showSelectionView=function(c){g.hasOwnProperty(c)&&g[c].show()};this.rerenderSelectionViews=function(){Object.keys(g).forEach(function(c){g[c].visible()&&
g[c].rerender()})};this.registerCursor=function(c,f){var l=c.getMemberId(),q=new gui.SelectionView(c);f?q.show():q.hide();return g[l]=q};this.destroy=function(c){var g=f();(function q(b,a){a?c(a):b<g.length?g[b].destroy(function(a){q(b+1,a)}):c()})(0,void 0)}};
runtime.loadClass("core.EventNotifier");runtime.loadClass("core.DomUtils");runtime.loadClass("odf.OdfUtils");runtime.loadClass("odf.Namespaces");runtime.loadClass("gui.SelectionMover");runtime.loadClass("core.PositionFilterChain");
ops.OdtDocument=function(f){function g(){var a=f.odfContainer().getContentElement(),b=a&&a.localName;runtime.assert("text"===b,"Unsupported content element type '"+b+"'for OdtDocument");return a}function c(a){function b(a){for(;a&&!(a.namespaceURI===odf.Namespaces.officens&&"text"===a.localName||a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName);)a=a.parentNode;return a}this.acceptPosition=function(c){c=c.container();var d;d="string"===typeof a?r[a].getNode():a;return b(c)===b(d)?
p:k}}function m(a){var b=gui.SelectionMover.createPositionIterator(g());for(a+=1;0<a&&b.nextPosition();)n.acceptPosition(b)===p&&(a-=1);return b}function l(a){return e.getParagraphElement(a)}function q(a,b){return f.getFormatting().getStyleElement(a,b)}function b(a){return q(a,"paragraph")}var a=this,e,d,r={},h=new core.EventNotifier([ops.OdtDocument.signalCursorAdded,ops.OdtDocument.signalCursorRemoved,ops.OdtDocument.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,
ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationExecuted,ops.OdtDocument.signalUndoStackChanged]),p=core.PositionFilter.FilterResult.FILTER_ACCEPT,k=core.PositionFilter.FilterResult.FILTER_REJECT,n;this.getIteratorAtPosition=m;this.getStyleElement=q;this.upgradeWhitespacesAtPosition=function(a){a=m(a);var b,c,d;a.previousPosition();a.previousPosition();for(d=-1;1>=d;d+=1){b=a.container();c=a.unfilteredDomOffset();
if(b.nodeType===Node.TEXT_NODE&&" "===b.data[c]&&e.isSignificantWhitespace(b,c)){runtime.assert(" "===b.data[c],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");var f=b.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s");f.appendChild(b.ownerDocument.createTextNode(" "));b.deleteData(c,1);0<c&&(b=b.splitText(c));b.parentNode.insertBefore(f,b);b=f;a.moveToEndOfNode(b)}a.nextPosition()}};this.downgradeWhitespacesAtPosition=function(a){var b=m(a),c;a=b.container();
for(b=b.unfilteredDomOffset();!e.isCharacterElement(a)&&a.childNodes[b];)a=a.childNodes[b],b=0;a.nodeType===Node.TEXT_NODE&&(a=a.parentNode);e.isDowngradableSpaceElement(a)&&(b=a.firstChild,c=a.lastChild,d.mergeIntoParent(a),c!==b&&d.normalizeTextNodes(c),d.normalizeTextNodes(b))};this.getParagraphStyleElement=b;this.getParagraphElement=l;this.getParagraphStyleAttributes=function(a){return(a=b(a))?f.getFormatting().getInheritedStyleAttributes(a):null};this.getPositionInTextNode=function(b,c){var d=
gui.SelectionMover.createPositionIterator(g()),e=null,f,h=0,k=null,k=b;runtime.assert(0<=b,"position must be >= 0");n.acceptPosition(d)===p?(f=d.container(),f.nodeType===Node.TEXT_NODE&&(e=f,h=0)):b+=1;for(;0<b||null===e;){if(!d.nextPosition())return null;if(n.acceptPosition(d)===p)if(b-=1,f=d.container(),f.nodeType===Node.TEXT_NODE)f!==e?(e=f,h=d.unfilteredDomOffset()):h+=1;else if(null!==e){if(0===b){h=e.length;break}e=null}else if(0===b){e=g().ownerDocument.createTextNode("");f.insertBefore(e,
d.rightNode());h=0;break}}if(null===e)return null;if(c&&r[c]&&a.getCursorPosition(c)===k){for(k=r[c].getNode();0===h&&k.nextSibling&&"cursor"===k.nextSibling.localName;)k.parentNode.insertBefore(k,k.nextSibling.nextSibling);0<e.length&&(e=g().ownerDocument.createTextNode(""),h=0,k.parentNode.insertBefore(e,k.nextSibling));for(;0===h&&e.previousSibling&&"cursor"===e.previousSibling.localName&&(f=e.previousSibling,0<e.length&&(e=g().ownerDocument.createTextNode("")),f.parentNode.insertBefore(e,f),k!==
f););}for(;e.previousSibling&&e.previousSibling.nodeType===Node.TEXT_NODE;)e.previousSibling.appendData(e.data),h=e.previousSibling.length,e=e.previousSibling,e.parentNode.removeChild(e.nextSibling);return{textNode:e,offset:h}};this.fixCursorPositions=function(){var b=new core.PositionFilterChain;b.addFilter("BaseFilter",n);Object.keys(r).forEach(function(c){var d=r[c],e=d.getStepCounter(),f,g,h=!1;b.addFilter("RootFilter",a.createRootFilter(c));c=e.countStepsToPosition(d.getAnchorNode(),0,b);e.isPositionWalkable(b)?
0===c&&(h=!0,d.move(0)):(h=!0,f=e.countPositionsToNearestStep(d.getNode(),0,b),g=e.countPositionsToNearestStep(d.getAnchorNode(),0,b),d.move(f),0!==c&&(0<g&&(c+=1),0<f&&(c-=1),e=e.countSteps(c,b),d.move(e),d.move(-e,!0)));h&&a.emit(ops.OdtDocument.signalCursorMoved,d);b.removeFilter("RootFilter")})};this.getWalkableParagraphLength=function(a){var b=m(0),c=0;b.setUnfilteredPosition(a,0);do{if(l(b.container())!==a)break;n.acceptPosition(b)===p&&(c+=1)}while(b.nextPosition());return c};this.getDistanceFromCursor=
function(a,b,c){a=r[a];var d=0;runtime.assert(null!==b&&void 0!==b,"OdtDocument.getDistanceFromCursor called without node");a&&(a=a.getStepCounter().countStepsToPosition,d=a(b,c,n));return d};this.getCursorPosition=function(b){return-a.getDistanceFromCursor(b,g(),0)};this.getCursorSelection=function(a){var b;a=r[a];var c=0;b=0;a&&(b=a.getStepCounter().countStepsToPosition,c=-b(g(),0,n),b=b(a.getAnchorNode(),0,n));return{position:c+b,length:-b}};this.getPositionFilter=function(){return n};this.getOdfCanvas=
function(){return f};this.getRootNode=g;this.getDOM=function(){return g().ownerDocument};this.getCursor=function(a){return r[a]};this.getCursors=function(){var a=[],b;for(b in r)r.hasOwnProperty(b)&&a.push(r[b]);return a};this.addCursor=function(a){runtime.assert(Boolean(a),"OdtDocument::addCursor without cursor");var b=a.getStepCounter().countSteps(1,n),c=a.getMemberId();runtime.assert("string"===typeof c,"OdtDocument::addCursor has cursor without memberid");runtime.assert(!r[c],"OdtDocument::addCursor is adding a duplicate cursor with memberid "+
c);a.move(b);r[c]=a};this.removeCursor=function(b){var c=r[b];return c?(c.removeFromOdtDocument(),delete r[b],a.emit(ops.OdtDocument.signalCursorRemoved,b),!0):!1};this.getMetaData=function(a){for(var b=f.odfContainer().rootElement.firstChild;b&&"meta"!==b.localName;)b=b.nextSibling;for(b=b&&b.firstChild;b&&b.localName!==a;)b=b.nextSibling;for(b=b&&b.firstChild;b&&b.nodeType!==Node.TEXT_NODE;)b=b.nextSibling;return b?b.data:null};this.getFormatting=function(){return f.getFormatting()};this.emit=function(a,
b){h.emit(a,b)};this.subscribe=function(a,b){h.subscribe(a,b)};this.unsubscribe=function(a,b){h.unsubscribe(a,b)};this.createRootFilter=function(a){return new c(a)};this.close=function(a){a()};this.destroy=function(a){a()};n=new function(){function a(b,c,d){var f,g;if(c&&(f=e.lookLeftForCharacter(c),1===f||2===f&&(e.scanRightForAnyCharacter(d)||e.scanRightForAnyCharacter(e.nextNode(b)))))return p;f=null===c&&e.isParagraph(b);g=e.lookRightForCharacter(d);if(f)return g?p:e.scanRightForAnyCharacter(d)?
k:p;if(!g)return k;c=c||e.previousNode(b);return e.scanLeftForAnyCharacter(c)?k:p}this.acceptPosition=function(b){var c=b.container(),d=c.nodeType,f,h,l;if(d!==Node.ELEMENT_NODE&&d!==Node.TEXT_NODE)return k;if(d===Node.TEXT_NODE){if(!e.isGroupingElement(c.parentNode)||e.isWithinTrackedChanges(c.parentNode,g()))return k;d=b.unfilteredDomOffset();f=c.data;runtime.assert(d!==f.length,"Unexpected offset.");if(0<d){b=f.substr(d-1,1);if(!e.isODFWhitespace(b))return p;if(1<d)if(b=f.substr(d-2,1),!e.isODFWhitespace(b))h=
p;else{if(!e.isODFWhitespace(f.substr(0,d)))return k}else l=e.previousNode(c),e.scanLeftForNonWhitespace(l)&&(h=p);if(h===p)return e.isTrailingWhitespace(c,d)?k:p;h=f.substr(d,1);return e.isODFWhitespace(h)?k:e.scanLeftForAnyCharacter(e.previousNode(c))?k:p}l=b.leftNode();h=c;c=c.parentNode;h=a(c,l,h)}else!e.isGroupingElement(c)||e.isWithinTrackedChanges(c,g())?h=k:(l=b.leftNode(),h=b.rightNode(),h=a(c,l,h));return h}};e=new odf.OdfUtils;d=new core.DomUtils};ops.OdtDocument.signalCursorAdded="cursor/added";
ops.OdtDocument.signalCursorRemoved="cursor/removed";ops.OdtDocument.signalCursorMoved="cursor/moved";ops.OdtDocument.signalParagraphChanged="paragraph/changed";ops.OdtDocument.signalTableAdded="table/added";ops.OdtDocument.signalCommonStyleCreated="style/created";ops.OdtDocument.signalCommonStyleDeleted="style/deleted";ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified";ops.OdtDocument.signalOperationExecuted="operation/executed";ops.OdtDocument.signalUndoStackChanged="undo/changed";
(function(){return ops.OdtDocument})();
runtime.loadClass("ops.TrivialMemberModel");runtime.loadClass("ops.TrivialOperationRouter");runtime.loadClass("ops.OperationFactory");runtime.loadClass("ops.OdtDocument");
ops.Session=function(f){var g=new ops.OperationFactory,c=new ops.OdtDocument(f),m=new ops.TrivialMemberModel,l=null;this.setMemberModel=function(c){m=c};this.setOperationFactory=function(c){g=c;l&&l.setOperationFactory(g)};this.setOperationRouter=function(f){l=f;f.setPlaybackFunction(function(b){b.execute(c);c.emit(ops.OdtDocument.signalOperationExecuted,b)});f.setOperationFactory(g)};this.getMemberModel=function(){return m};this.getOperationFactory=function(){return g};this.getOdtDocument=function(){return c};
this.enqueue=function(c){l.push(c)};this.close=function(f){l.close(function(b){b?f(b):m.close(function(a){a?f(a):c.close(f)})})};this.destroy=function(f){c.destroy(f)};this.setOperationRouter(new ops.TrivialOperationRouter)};
var webodf_css="@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);\n@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);\n@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);\n@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);\n@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);\n@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);\n@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);\n@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);\n@namespace webodfhelper url(urn:webodf:names:helper);\n@namespace cursor url(urn:webodf:names:cursor);\n@namespace editinfo url(urn:webodf:names:editinfo);\n@namespace annotation url(urn:webodf:names:annotation);\n@namespace dc url(http://purl.org/dc/elements/1.1/);\n\noffice|document > *, office|document-content > * {\n  display: none;\n}\noffice|body, office|document {\n  display: inline-block;\n  position: relative;\n}\n\ntext|p, text|h {\n  display: block;\n  padding: 0;\n  margin: 0;\n  line-height: normal;\n  position: relative;\n  min-height: 1.3em; /* prevent empty paragraphs and headings from collapsing if they are empty */\n}\n*[webodfhelper|containsparagraphanchor] {\n  position: relative;\n}\ntext|s {\n    white-space: pre;\n}\ntext|tab {\n  display: inline;\n  white-space: pre;\n}\ntext|tracked-changes {\n  /*Consumers that do not support change tracking, should ignore changes.*/\n  display: none;\n}\noffice|binary-data {\n  display: none;\n}\noffice|text {\n  display: block;\n  text-align: left;\n  overflow: visible;\n  word-wrap: break-word;\n}\n\noffice|text::selection {\n  /** Let's not draw selection highlight that overflows into the office|text\n   * node when selecting content across several paragraphs\n   */\n  background: transparent;\n}\n\n.virtualSelections office|document *::selection {\n  background: transparent;\n}\n.virtualSelections office|document *::-moz-selection {\n  background: transparent;\n}\n\noffice|text * draw|text-box {\n/** only for text documents */\n    display: block;\n    border: 1px solid #d3d3d3;\n}\noffice|spreadsheet {\n  display: block;\n  border-collapse: collapse;\n  empty-cells: show;\n  font-family: sans-serif;\n  font-size: 10pt;\n  text-align: left;\n  page-break-inside: avoid;\n  overflow: hidden;\n}\noffice|presentation {\n  display: inline-block;\n  text-align: left;\n}\n#shadowContent {\n  display: inline-block;\n  text-align: left;\n}\ndraw|page {\n  display: block;\n  position: relative;\n  overflow: hidden;\n}\npresentation|notes, presentation|footer-decl, presentation|date-time-decl {\n    display: none;\n}\n@media print {\n  draw|page {\n    border: 1pt solid black;\n    page-break-inside: avoid;\n  }\n  presentation|notes {\n    /*TODO*/\n  }\n}\noffice|spreadsheet text|p {\n  border: 0px;\n  padding: 1px;\n  margin: 0px;\n}\noffice|spreadsheet table|table {\n  margin: 3px;\n}\noffice|spreadsheet table|table:after {\n  /* show sheet name the end of the sheet */\n  /*content: attr(table|name);*/ /* gives parsing error in opera */\n}\noffice|spreadsheet table|table-row {\n  counter-increment: row;\n}\noffice|spreadsheet table|table-row:before {\n  width: 3em;\n  background: #cccccc;\n  border: 1px solid black;\n  text-align: center;\n  content: counter(row);\n  display: table-cell;\n}\noffice|spreadsheet table|table-cell {\n  border: 1px solid #cccccc;\n}\ntable|table {\n  display: table;\n}\ndraw|frame table|table {\n  width: 100%;\n  height: 100%;\n  background: white;\n}\ntable|table-header-rows {\n  display: table-header-group;\n}\ntable|table-row {\n  display: table-row;\n}\ntable|table-column {\n  display: table-column;\n}\ntable|table-cell {\n  width: 0.889in;\n  display: table-cell;\n  word-break: break-all; /* prevent long words from extending out the table cell */\n}\ndraw|frame {\n  display: block;\n}\ndraw|image {\n  display: block;\n  width: 100%;\n  height: 100%;\n  top: 0px;\n  left: 0px;\n  background-repeat: no-repeat;\n  background-size: 100% 100%;\n  -moz-background-size: 100% 100%;\n}\n/* only show the first image in frame */\ndraw|frame > draw|image:nth-of-type(n+2) {\n  display: none;\n}\ntext|list:before {\n    display: none;\n    content:\"\";\n}\ntext|list {\n    counter-reset: list;\n}\ntext|list-item {\n    display: block;\n}\ntext|number {\n    display:none;\n}\n\ntext|a {\n    color: blue;\n    text-decoration: underline;\n    cursor: pointer;\n}\ntext|note-citation {\n    vertical-align: super;\n    font-size: smaller;\n}\ntext|note-body {\n    display: none;\n}\ntext|note:hover text|note-citation {\n    background: #dddddd;\n}\ntext|note:hover text|note-body {\n    display: block;\n    left:1em;\n    max-width: 80%;\n    position: absolute;\n    background: #ffffaa;\n}\nsvg|title, svg|desc {\n    display: none;\n}\nvideo {\n    width: 100%;\n    height: 100%\n}\n\n/* below set up the cursor */\ncursor|cursor {\n    display: inline;\n    width: 0px;\n    height: 1em;\n    /* making the position relative enables the avatar to use\n       the cursor as reference for its absolute position */\n    position: relative;\n    z-index: 1;\n}\ncursor|cursor > span {\n    /* IMPORTANT: when changing these values ensure DEFAULT_CARET_TOP and DEFAULT_CARET_HEIGHT\n        in Caret.js remain in sync */\n    display: inline;\n    position: absolute;\n    top: 5%; /* push down the caret; 0px can do the job, 5% looks better, 10% is a bit over */\n    height: 1em;\n    border-left: 2px solid black;\n    outline: none;\n}\n\ncursor|cursor > div {\n    padding: 3px;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n    border: none !important;\n    border-radius: 5px;\n    opacity: 0.3;\n}\n\ncursor|cursor > div > img {\n    border-radius: 5px;\n}\n\ncursor|cursor > div.active {\n    opacity: 0.8;\n}\n\ncursor|cursor > div:after {\n    content: ' ';\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: black transparent transparent transparent;\n\n    top: 100%;\n    left: 43%;\n}\n\n\n.editInfoMarker {\n    position: absolute;\n    width: 10px;\n    height: 100%;\n    left: -20px;\n    opacity: 0.8;\n    top: 0;\n    border-radius: 5px;\n    background-color: transparent;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n}\n.editInfoMarker:hover {\n    box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);\n}\n\n.editInfoHandle {\n    position: absolute;\n    background-color: black;\n    padding: 5px;\n    border-radius: 5px;\n    opacity: 0.8;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n    bottom: 100%;\n    margin-bottom: 10px;\n    z-index: 3;\n    left: -25px;\n}\n.editInfoHandle:after {\n    content: ' ';\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: black transparent transparent transparent;\n\n    top: 100%;\n    left: 5px;\n}\n.editInfo {\n    font-family: sans-serif;\n    font-weight: normal;\n    font-style: normal;\n    text-decoration: none;\n    color: white;\n    width: 100%;\n    height: 12pt;\n}\n.editInfoColor {\n    float: left;\n    width: 10pt;\n    height: 10pt;\n    border: 1px solid white;\n}\n.editInfoAuthor {\n    float: left;\n    margin-left: 5pt;\n    font-size: 10pt;\n    text-align: left;\n    height: 12pt;\n    line-height: 12pt;\n}\n.editInfoTime {\n    float: right;\n    margin-left: 30pt;\n    font-size: 8pt;\n    font-style: italic;\n    color: yellow;\n    height: 12pt;\n    line-height: 12pt;\n}\n\n.annotationWrapper {\n    display: inline;\n    position: relative;\n}\n\n.annotationRemoveButton:before {\n    content: '\u00d7';\n    color: white;\n    padding: 5px;\n    line-height: 1em;\n}\n\n.annotationRemoveButton {\n    width: 20px;\n    height: 20px;\n    border-radius: 10px;\n    background-color: black;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n    position: absolute;\n    top: -10px;\n    left: -10px;\n    z-index: 3;\n    text-align: center;\n    font-family: sans-serif;\n    font-style: normal;\n    font-weight: normal;\n    text-decoration: none;\n    font-size: 15px;\n}\n.annotationRemoveButton:hover {\n    cursor: pointer;\n    box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);\n}\n\n.annotationNote {\n    width: 4cm;\n    position: absolute;\n    display: inline;\n    z-index: 10;\n}\n.annotationNote > office|annotation {\n    display: block;\n    text-align: left;\n}\n\n.annotationConnector {\n    position: absolute;\n    display: inline;\n    z-index: 2;\n    border-top: 1px dashed brown;\n}\n.annotationConnector.angular {\n    -moz-transform-origin: left top;\n    -webkit-transform-origin: left top;\n    -ms-transform-origin: left top;\n    transform-origin: left top;\n}\n.annotationConnector.horizontal {\n    left: 0;\n}\n.annotationConnector.horizontal:before {\n    content: '';\n    display: inline;\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: brown transparent transparent transparent;\n    top: -1px;\n    left: -5px;\n}\n\noffice|annotation {\n    width: 100%;\n    height: 100%;\n    display: none;\n    background: rgb(198, 238, 184);\n    background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    box-shadow: 0 3px 4px -3px #ccc;\n}\n\noffice|annotation > dc|creator {\n    display: block;\n    font-size: 10pt;\n    font-weight: normal;\n    font-style: normal;\n    font-family: sans-serif;\n    color: white;\n    background-color: brown;\n    padding: 4px;\n}\noffice|annotation > dc|date {\n    display: block;\n    font-size: 10pt;\n    font-weight: normal;\n    font-style: normal;\n    font-family: sans-serif;\n    border: 4px solid transparent;\n}\noffice|annotation > text|list {\n    display: block;\n    padding: 5px;\n}\n\n/* This is very temporary CSS. This must go once\n * we start bundling webodf-default ODF styles for annotations.\n */\noffice|annotation text|p {\n    font-size: 10pt;\n    color: black;\n    font-weight: normal;\n    font-style: normal;\n    text-decoration: none;\n    font-family: sans-serif;\n}\n\ndc|*::selection {\n    background: transparent;\n}\ndc|*::-moz-selection {\n    background: transparent;\n}\n\n#annotationsPane {\n    background-color: #EAEAEA;\n    width: 4cm;\n    height: 100%;\n    display: none;\n    position: absolute;\n    outline: 1px solid #ccc;\n}\n\n.annotationHighlight {\n    background-color: yellow;\n    position: relative;\n}\n\n.selectionOverlay {\n    position: absolute;\n    z-index: 15;\n    opacity: 0.2;\n    pointer-events: none;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n}\n\n#imageSelector {\n    display: none;\n    position: absolute;\n    border-style: solid;\n    border-color: black;\n}\n\n#imageSelector > div {\n    width: 5px;\n    height: 5px;\n    display: block;\n    position: absolute;\n    border: 1px solid black;\n    background-color: #ffffff;\n}\n\n#imageSelector > .topLeft {\n    top: -4px;\n    left: -4px;\n}\n\n#imageSelector > .topRight {\n    top: -4px;\n    right: -4px;\n}\n\n#imageSelector > .bottomRight {\n    right: -4px;\n    bottom: -4px;\n}\n\n#imageSelector > .bottomLeft {\n    bottom: -4px;\n    left: -4px;\n}\n\n#imageSelector > .topMiddle {\n    top: -4px;\n    left: 50%;\n    margin-left: -2.5px; /* half of the width defined in #imageSelector > div */\n}\n\n#imageSelector > .rightMiddle {\n    top: 50%;\n    right: -4px;\n    margin-top: -2.5px; /* half of the height defined in #imageSelector > div */\n}\n\n#imageSelector > .bottomMiddle {\n    bottom: -4px;\n    left: 50%;\n    margin-left: -2.5px; /* half of the width defined in #imageSelector > div */\n}\n\n#imageSelector > .leftMiddle {\n    top: 50%;\n    left: -4px;\n    margin-top: -2.5px; /* half of the height defined in #imageSelector > div */\n}\n";
